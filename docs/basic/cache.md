---
nav:
  title: ðŸ’Š åŸºç¡€
title: ç¼“å­˜åœ¨æ€§èƒ½ä¼˜åŒ–æ–¹é¢çš„åº”ç”¨
order: 1
---

æˆ‘ä»¬å¯ä»¥å°†ç¼“å­˜åˆ’åˆ†ä¸º**èµ„æºç¼“å­˜**ä¸Ž**æ•°æ®ç¼“å­˜**ä¸¤å¤§ç±»ã€‚

**èµ„æºç¼“å­˜**ï¼šç”¨äºŽå°†é™æ€èµ„æºæŒ‰ç…§æˆ‘ä»¬æ‰€æœŸæœ›çš„è§„åˆ™å­˜å‚¨åœ¨æœ¬åœ°ï¼Œç”¨æˆ·è®¿é—®ç½‘é¡µæ—¶å¦‚æžœç›¸å…³èµ„æºæœªå‘ç”Ÿæ”¹å˜ï¼Œåˆ™å¯ä»¥ç›´æŽ¥ä»Žæœ¬åœ°æ‹¿å–èµ„æºæ¸²æŸ“ç½‘é¡µã€‚æ‰€ä»¥èµ„æºç¼“å­˜çš„ç­–ç•¥å…¶å®žå°±æ˜¯ç”¨äºŽç¡®å®šèµ„æºæ˜¯å¦å·²ç»å‘ç”Ÿäº†æ›´æ–°ã€‚

**æ•°æ®ç¼“å­˜**ï¼šç”¨äºŽå°†å¸¸ä½¿ç”¨æ•°æ®å­˜å‚¨åœ¨æœ¬åœ°ï¼Œä¾‹å¦‚ç”¨æˆ·ç™»å½•æ€ä¿¡æ¯ã€ä¸å¸¸å˜åŠ¨ä¸”ä¸æ¶‰åŠæ•°æ®å®‰å…¨é—®é¢˜çš„æ•°æ®ç­‰ã€‚æ•°æ®ç¼“å­˜çš„æ–¹æ¡ˆæœ‰å¾ˆå¤šï¼Œä¾‹å¦‚ï¼šcookieã€localstorageã€indexedDB ç­‰ã€‚

## èµ„æºç¼“å­˜

èµ„æºç¼“å­˜ç”¨äºŽç¼“å­˜é™æ€èµ„æºï¼Œä¸Šé¢å·²ç»æåˆ°ã€‚è‰¯å¥½çš„ç¼“å­˜ç­–ç•¥å¯ä»¥å‡å°‘èµ„æºé‡å¤åŠ è½½è¿›è€Œæé«˜ç½‘é¡µçš„æ•´ä½“åŠ è½½é€Ÿåº¦ã€‚

é€šå¸¸æµè§ˆå™¨ç¼“å­˜ç­–ç•¥åˆ†ä¸ºä¸¤ç§ï¼šå¼ºç¼“å­˜å’Œåå•†ç¼“å­˜ï¼Œå½“ç„¶è¿˜åŒ…æ‹¬ service workerã€‚

- æµè§ˆå™¨åœ¨èµ„æºåŠ è½½æ—¶ï¼Œæ ¹æ®è¯·æ±‚å¤´ä¸­çš„ `expires` å’Œ `cache-control` å€¼æ¥åˆ¤æ–­æ˜¯å¦å‘½ä¸­å¼ºç¼“å­˜ï¼Œå‘½ä¸­åˆ™ç›´æŽ¥ä»Žæœ¬åœ°ç¼“å­˜ä¸­è¯»å–èµ„æºï¼Œè¿™ä¸€è¿‡ç¨‹ä¸éœ€è¯·æ±‚æœåŠ¡å™¨ï¼›
- å¦‚æžœæœªå‘½ä¸­å¼ºç¼“å­˜ï¼Œæµè§ˆå™¨åˆ™ä¼šå‘é€è¯·æ±‚åˆ°æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨é€šè¿‡ `last-modified` å’Œ `etag` å€¼æ¥éªŒè¯èµ„æºæ˜¯å¦å‘½ä¸­åå•†ç¼“å­˜ï¼Œè‹¥å‘½ä¸­ï¼Œåˆ™æœåŠ¡å™¨ä¼šå°†è¿™ä¸ªè¯·æ±‚è¿”å›žï¼Œä½†æ˜¯ä¸ä¼šè¿”å›žè¿™ä¸ªèµ„æºçš„æ•°æ®ï¼Œæµè§ˆå™¨æŽ¥æ”¶åˆ°è¯¥è¯·æ±‚å“åº”åŽä¾ç„¶ä»Žæœ¬åœ°ç¼“å­˜ä¸­è¯»å–èµ„æºï¼›
- è‹¥**å¼ºç¼“å­˜**å’Œ**ç­–ç•¥ç¼“å­˜**éƒ½æœªå‘½ä¸­ï¼Œé‚£ä¹ˆæµè§ˆå™¨å°†è¯·æ±‚æœåŠ¡å™¨èŽ·å¾—èµ„æºå¹¶åŠ è½½ã€‚

**å¼ºç¼“å­˜**å’Œ**ç­–ç•¥ç¼“å­˜**å¦‚æžœå‘½ä¸­ï¼Œéƒ½æ˜¯ç›´æŽ¥ä»Žå®¢æˆ·ç«¯ç¼“å­˜åŠ è½½å¯¹åº”èµ„æºã€‚ä½†ä¸åŒç‚¹æ˜¯ï¼š**å¼ºç¼“å­˜**è‡ªæ¯”è¾ƒå¼€å§‹è‡³ç¼“å­˜å‘½ä¸­ä¸ä¼šè¯·æ±‚æœåŠ¡ç«¯ï¼Œè€Œ**ç­–ç•¥ç¼“å­˜**çš„æ˜¯å¦ä½¿ç”¨æœ¬åœ°ç¼“å­˜è¿™ä¸€å†³å®šæ˜¯éœ€è¦æœåŠ¡ç«¯å‚ä¸Žçš„ï¼Œæ¢è¨€ä¹‹ç­–ç•¥ç¼“å­˜éœ€è¦è¯·æ±‚æœåŠ¡ç«¯æ¥å®Œæˆçš„ã€‚

### å¼ºç¼“å­˜

å¼ºç¼“å­˜é€šè¿‡ `Expires` å’Œ `Cache-Control` å“åº”å¤´å®žçŽ°ã€‚ä¸¤è€…è¯¦ç»†è¯´æ˜Žå¦‚ä¸‹ï¼š

#### Expire

ä¸­æ–‡é‡Šä¹‰ä¸ºï¼šåˆ°æœŸï¼Œè¡¨ç¤ºç¼“å­˜çš„è¿‡æœŸæ—¶é—´ã€‚**expire** æ˜¯ HTTP 1.0 æå‡ºçš„ï¼Œå®ƒæè¿°çš„æ˜¯ä¸€ä¸ªç»å¯¹æ—¶é—´ï¼Œè¯¥æ—¶é—´ç”±æœåŠ¡ç«¯è¿”å›žã€‚å› ä¸º **expire** å€¼æ˜¯ä¸€ä¸ªå›ºå®šæ—¶é—´ï¼Œå› æ­¤ä¼šå—æœ¬åœ°æ—¶é—´çš„å½±å“ï¼Œå¦‚æžœåœ¨ç¼“å­˜æœŸé—´æˆ‘ä»¬ä¿®æ”¹äº†æœ¬åœ°æ—¶é—´ï¼Œå¯èƒ½ä¼šå¯¼è‡´ç¼“å­˜å¤±æ•ˆã€‚

é€šå¸¸è¡¨ç¤ºå¦‚ä¸‹ï¼š

```
Expires: Wed, 11 May 2018 07:20:00 GMT
```

#### Cache-Control

ä¸­æ–‡é‡Šä¹‰ä¸ºï¼šç¼“å­˜æŽ§åˆ¶ã€‚**cache-control** æ˜¯ HTTP 1.1 æå‡ºçš„ï¼Œå®ƒæè¿°çš„æ˜¯ä¸€ä¸ªç›¸å¯¹æ—¶é—´ï¼Œè¯¥ç›¸å¯¹æ—¶é—´ç”±æœåŠ¡ç«¯è¿”å›žã€‚

è¡¨ç¤ºå¦‚ä¸‹ï¼š

```
Cache-Control: max-age=315360000
```

è¯¥å±žæ€§è¿˜åŒ…æ‹¬è®¿é—®æ€§åŠç¼“å­˜æ–¹å¼è®¾ç½®ï¼Œåˆ—ä¸¾å¦‚ä¸‹ï¼š

- **no-cache** å­˜å‚¨åœ¨æœ¬åœ°ç¼“å­˜å–ä¸­ï¼Œåªæ˜¯åœ¨ä¸ŽæœåŠ¡å™¨è¿›è¡Œæ–°é²œåº¦å†éªŒè¯ä¹‹å‰ï¼Œç¼“å­˜æ— æ³•ä½¿ç”¨ã€‚
- **no-store** ä¸ç¼“å­˜èµ„æºåˆ°æœ¬åœ°
- **public** å¯è¢«æ‰€æœ‰ç”¨æˆ·ç¼“å­˜ï¼Œå¤šç”¨æˆ·è¿›è¡Œå…±äº«ï¼ŒåŒ…æ‹¬ç»ˆç«¯æˆ– CDN ç­‰ä¸­é—´ä»£ç†æœåŠ¡å™¨
- **private** ä»…èƒ½è¢«æµè§ˆå™¨å®¢æˆ·ç«¯ç¼“å­˜ï¼Œå±žäºŽç§æœ‰ç¼“å­˜ï¼Œä¸å…è®¸ä¸­é—´ä»£ç†æœåŠ¡å™¨ç¼“å­˜ç›¸å…³èµ„æº

ç¼“å­˜ä¸Žä½¿ç”¨ç¼“å­˜æµç¨‹è¯´æ˜Žå¦‚ä¸‹ï¼š

![](https://user-images.githubusercontent.com/25027560/38223493-c7ec919e-371d-11e8-8d72-8c6b0e4935a8.png)

### åå•†ç¼“å­˜

æµè§ˆå™¨åŠ è½½èµ„æºæ—¶ï¼Œè‹¥å¼ºç¼“å­˜æœªå‘½ä¸­ï¼Œå°†å‘é€èµ„æºè¯·æ±‚è‡³æœåŠ¡å™¨ã€‚è‹¥åå•†ç¼“å­˜å‘½ä¸­ï¼Œè¯·æ±‚å“åº”è¿”å›ž 304 çŠ¶æ€ç ã€‚

åå•†ç¼“å­˜ä¸»è¦ä½¿ç”¨åˆ°ä¸¤å¯¹è¯·æ±‚å“åº”å¤´å­—æ®µï¼Œåˆ†åˆ«æ˜¯ï¼š

- Last-Modified å’Œ If-Modified-Since
- Etag å’Œ If-None-Match

#### Last-Modified ä¸Ž If-Modified-Since

**Last-Modified** ç”±ä¸Šä¸€æ¬¡è¯·æ±‚çš„å“åº”å¤´è¿”å›žï¼Œä¸”è¯¥å€¼ä¼šåœ¨æœ¬æ¬¡è¯·æ±‚ä¸­ï¼Œé€šè¿‡è¯·æ±‚å¤´ **If-Modified-Since** ä¼ é€’ç»™æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯é€šè¿‡ If-Modified-Since ä¸Žèµ„æºçš„ä¿®æ”¹æ—¶é—´è¿›è¡Œå¯¹æ¯”ï¼Œè‹¥åœ¨æ­¤æ—¥æœŸåŽèµ„æºæœ‰æ›´æ–°ï¼Œåˆ™å°†æ–°çš„èµ„æºå‘é€ç»™å®¢æˆ·ç«¯ã€‚

ä¸è¿‡ï¼Œé€šè¿‡æ–‡ä»¶çš„ä¿®æ”¹æ—¶é—´æ¥åˆ¤æ–­èµ„æºæ˜¯å¦æ›´æ–°æ˜¯ä¸æ˜Žæ™ºçš„ï¼Œå› ä¸ºå¾ˆå¤šæ—¶å€™æ–‡ä»¶æ›´æ–°æ—¶é—´å˜äº†ï¼Œä½†æ–‡ä»¶å†…å®¹æœªå‘ç”Ÿæ›´æ”¹ã€‚

è¿™æ ·ä¸€æ¥ï¼Œå°±å‡ºçŽ°äº† **ETag** ä¸Ž **If-None-Match**ã€‚

#### ETag ä¸Ž If-None-Match

ä¸åŒäºŽ **Last-Modified**ï¼ŒEtag é€šè¿‡è®¡ç®—æ–‡ä»¶æŒ‡çº¹ï¼Œä¸Žè¯·æ±‚ä¼ é€’è¿‡æ¥çš„ **If-None-Match** è¿›è¡Œå¯¹æ¯”ï¼Œè‹¥å€¼ä¸ç­‰ï¼Œåˆ™å°†æ–°çš„èµ„æºå‘é€ç»™å®¢æˆ·ç«¯ã€‚

å€¼å¾—ä¸€æçš„æ˜¯ï¼Œé€šå¸¸ä¸ºäº†å‡è½»æœåŠ¡å™¨åŽ‹åŠ›ï¼Œå¹¶ä¸ä¼šå®Œæ•´è®¡ç®—æ–‡ä»¶ hash å€¼ä½œä¸º Etagï¼Œå¹¶ä¸”æœ‰äº›æ—¶å€™ Etag çš„è¡¨çŽ°ä¼šé€€åŒ–ä¸º Last-Modified ï¼ˆå½“æŒ‡çº¹è®¡ç®—ä¸ºæ–‡ä»¶æ›´æ–°æ—¶é—´æ—¶ï¼‰ã€‚é‚£ä¸ºä»€ä¹ˆæˆ‘ä»¬é€šå¸¸è¿˜æ˜¯è¦é€‰ç”¨ Etag å‘¢ï¼ŸåŽŸå› æœ‰ä¸€ä¸‹å‡ ç‚¹ï¼š

- æ–‡ä»¶ä¹Ÿè®¸ä¼šå‘ç”Ÿå‘¨æœŸæ€§çš„æ›´æ”¹ï¼Œä½†å†…å®¹å¹¶æ— å˜åŒ–ï¼Œè¿™æ—¶æˆ‘ä»¬å¸Œæœ›å®¢æˆ·ç«¯è®¤ä¸ºè¿™ä¸ªæ–‡ä»¶æ˜¯æœªå˜çš„ï¼›
- æ–‡ä»¶ä¿®æ”¹é¢‘ç¹ï¼Œæ¯”å¦‚åœ¨ç§’ä»¥å†…çš„æ—¶é—´è¿›è¡Œä¿®æ”¹ï¼Œç”±äºŽ If-Modified-Since èƒ½è¯»å–åˆ°çš„æ—¶é—´ç²¾åº¦ä¸º sï¼Œå› æ­¤è¿™ç§åœºæ™¯ä¸‹ If-Modified-Since æ— æ³•æ­£å¸¸ä½¿ç”¨ï¼›
- æŸäº›æœåŠ¡å™¨ä¸èƒ½ç²¾ç¡®èŽ·å¾—æ–‡ä»¶çš„æœ€åŽä¿®æ”¹æ—¶é—´ã€‚

![](https://user-images.githubusercontent.com/25027560/38223505-d8ab53da-371d-11e8-9263-79814b6971a5.png)

> ðŸ’¡ ETag çš„ä¼˜å…ˆçº§æ¯” Last-Modified æ›´é«˜ï¼

#### çŠ¶æ€ç 

- 200ï¼šå¼ºç¼“å­˜ Expires / Cache-Control å¤±æ•ˆæ—¶ï¼Œè¿”å›žæ–°èµ„æºæ–‡ä»¶
- 200ï¼ˆfrom disk cacheï¼‰Expires / Cache-Control ä¸¤è€…éƒ½å­˜åœ¨ä¸”æœ‰æ•ˆï¼ŒCache-Control ä¼˜å…ˆ Expires æ—¶ï¼Œæµè§ˆå™¨ä»Žæœ¬åœ°èŽ·å–èµ„æºæˆåŠŸã€‚
- 200ï¼ˆfrom memory cacheï¼‰
- 304ï¼ˆNot Modifiedï¼‰åå•†ç¼“å­˜ Last-modified / Etag æœ‰æ•ˆï¼Œåˆ™æœåŠ¡ç«¯è¿”å›žè¯¥çŠ¶æ€ç ã€‚

### å¦‚ä½•ç¼“å­˜

ç¼“å­˜å¯ç”¨çš„é¡ºåºå¯åˆ—ä¸¾å¦‚ä¸‹ï¼š

1. Cache-Control â€”â€” è¯·æ±‚æœåŠ¡å™¨ä¹‹å‰
2. Expires â€”â€” è¯·æ±‚æœåŠ¡å™¨ä¹‹å‰
3. If-None-Match (Etag) â€”â€” è¯·æ±‚æœåŠ¡å™¨
4. If-Modified-Since (Last-Modified) â€”â€” è¯·æ±‚æœåŠ¡å™¨

éœ€è¦æ³¨æ„çš„æ˜¯åå•†ç¼“å­˜éœ€è¦é…åˆå¼ºç¼“å­˜ä½¿ç”¨ï¼Œå¦‚æžœä¸å¯ç”¨å¼ºç¼“å­˜é‚£ä¹ˆåå•†ç¼“å­˜å°±å¤±åŽ»äº†æ„ä¹‰ã€‚å¤§éƒ¨åˆ† web æœåŠ¡å™¨éƒ½é»˜è®¤å¼€å¯äº†åå•†ç¼“å­˜ï¼Œè€Œä¸”æ˜¯åŒæ—¶å¯ç”¨ï¼ˆLast-Modifiedã€If-Modified-Sinceï¼‰å’Œï¼ˆETagã€If-None-Matchï¼‰ã€‚ä½†å½“æˆ‘ä»¬çš„ç³»ç»Ÿé€‰ç”¨åˆ†å¸ƒå¼éƒ¨ç½²æ—¶ï¼Œåˆ™éœ€è¦æ³¨æ„ä»¥ä¸‹é—®é¢˜ï¼š

- åˆ†å¸ƒå¼ç³»ç»Ÿé‡Œå¤šå°æœºå™¨é—´æ–‡ä»¶çš„ Last-Modified å¿…é¡»ä¿æŒå®Œå…¨ä¸€è‡´ï¼Œå¦åˆ™åœ¨è¯·æ±‚è´Ÿè½½å‡è¡¡åˆ°ä¸åŒæœºå™¨æ—¶ï¼Œä¼šå¯¼è‡´æ¯”å¯¹å¤±è´¥çš„æƒ…å†µï¼›
- åˆ†å¸ƒå¼ç³»ç»Ÿå°½é‡å…³é—­æŽ‰ ETagï¼Œå› ä¸ºæ¯å°æœºå™¨ç”Ÿæˆçš„ ETag éƒ½ä¸åŒã€‚

### service worker

ä¸ºäº†æ›´çµæ´»é…ç½®ç¼“å­˜ç­–ç•¥ï¼Œå¼•å…¥äº† service worker æŠ€æœ¯ï¼Œå…³äºŽè¯¥æŠ€æœ¯çš„åº”ç”¨å¯è§æ–‡ç«  [workbox åº”ç”¨](./workbox)

### ç¼“å­˜æŠ€æœ¯æ–¹æ¡ˆå®žè·µ

#### é™æ€èµ„æºä¼˜åŒ–æ–¹æ¡ˆä¸Žæ€è€ƒ

- é…ç½®è¶…é•¿æ—¶é—´çš„æœ¬åœ°ç¼“å­˜ â€”â€” èŠ‚çœå¸¦å®½ï¼Œæé«˜æ€§èƒ½
- é‡‡ç”¨å†…å®¹æ‘˜è¦ä½œä¸ºç¼“å­˜æ›´æ–°ä¾æ® â€”â€” ç²¾ç¡®çš„ç¼“å­˜æŽ§åˆ¶
- é™æ€èµ„æº CDN éƒ¨ç½² â€”â€” ä¼˜åŒ–ç½‘ç»œè¯·æ±‚
- æ›´èµ„æºå‘å¸ƒè·¯å¾„å®žçŽ°éžè¦†ç›–å¼å‘å¸ƒ â€”â€” å¹³æ»‘å‡çº§

#### å……åˆ†åˆ©ç”¨æµè§ˆå™¨ç¼“å­˜æœºåˆ¶

- å¯¹äºŽæŸäº›ä¸éœ€è¦ç¼“å­˜çš„èµ„æºï¼Œå¯ä»¥ä½¿ç”¨ Cache-control: no-store ï¼Œè¡¨ç¤ºè¯¥èµ„æºä¸éœ€è¦ç¼“å­˜
- å¯¹äºŽé¢‘ç¹å˜åŠ¨çš„èµ„æºï¼ˆæ¯”å¦‚ç»å¸¸éœ€è¦åˆ·æ–°çš„é¦–é¡µï¼Œèµ„è®¯è®ºå›æ–°é—»ç±»ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ Cache-Control: no-cache å¹¶é…åˆ ETag ä½¿ç”¨ï¼Œè¡¨ç¤ºè¯¥èµ„æºå·²è¢«ç¼“å­˜ï¼Œä½†æ˜¯æ¯æ¬¡éƒ½ä¼šå‘é€è¯·æ±‚è¯¢é—®èµ„æºæ˜¯å¦æ›´æ–°ã€‚
- å¯¹äºŽä»£ç æ–‡ä»¶æ¥è¯´ï¼Œé€šå¸¸ä½¿ç”¨ Cache-Control: max-age=31536000 å¹¶é…åˆç­–ç•¥ç¼“å­˜ä½¿ç”¨ï¼Œç„¶åŽå¯¹æ–‡ä»¶è¿›è¡ŒæŒ‡çº¹å¤„ç†ï¼Œä¸€æ—¦æ–‡ä»¶åå˜åŠ¨å°±ä¼šç«‹åˆ»ä¸‹è½½æ–°çš„æ–‡ä»¶ã€‚
- é™æ€èµ„æºæ–‡ä»¶é€šè¿‡ Service Worker è¿›è¡Œç¼“å­˜æŽ§åˆ¶å’Œç¦»çº¿åŒ–åŠ è½½

## æ•°æ®ç¼“å­˜

### æ•°æ®ç¼“å­˜æŠ€æœ¯

- **cookie 4K**ï¼Œå¯æ‰‹åŠ¨è®¾ç½®å¤±æ•ˆå®žè·µ
- **localStorage 5M**ï¼Œéœ€è¦æ‰‹åŠ¨æ¸…é™¤ï¼Œå¦åˆ™ä¸€ç›´å­˜åœ¨
- **sessionStorage 5M**ï¼Œä»…é™åŒæ ‡ç­¾è®¿é—®ï¼Œé¡µé¢å…³é—­å°±ä¼šæ¸…ç†
- **indexedDB æ— é™å®¹é‡**ï¼Œæµè§ˆå™¨ç«¯æ•°æ®åº“ï¼Œéœ€æ‰‹åŠ¨æ¸…é™¤ï¼Œå¦åˆ™ä¸€ç›´å­˜åœ¨

### cookie

cookie å®žé™…æ˜¯ä¸€å°æ®µæ–‡æœ¬ä¿¡æ¯ã€‚å®¢æˆ·ç«¯è¯·æ±‚æœåŠ¡ç«¯ï¼Œå¦‚æžœæœåŠ¡å™¨éœ€è¦è®°å½•è¯¥ç”¨æˆ·çš„ç™»å½•çŠ¶æ€ï¼Œå°±éœ€è¦ä½¿ç”¨åœ¨å“åº”æ—¶å‘å®¢æˆ·ç«¯è¿”å›žä¸€ä¸ª cookieã€‚å®¢æˆ·ç«¯æµè§ˆå™¨ä¼šå°† cookie ä¿å­˜ã€‚å®¢æˆ·ç«¯å†æ¬¡è¯·æ±‚è¯¥ç½‘ç«™æ—¶ï¼Œä¼šæºå¸¦ cookie ä¸€åŒæäº¤åˆ°æœåŠ¡ç«¯ã€‚æ­¤æ—¶æœåŠ¡ç«¯æ£€æŸ¥è¯¥ cookie æ¥ç¡®å®šç”¨æˆ·ç™»å½•çŠ¶æ€ã€‚æœåŠ¡å™¨è¿˜å¯ä»¥æ ¹æ®éœ€è¦ä¿®æ”¹ cookie å†…å®¹ã€‚

cookie åŒ…å«ä»¥ä¸‹å±žæ€§ï¼š

- Expires ï¼šcookie è¿‡æœŸæ—¶é—´ï¼Œç»å¯¹æ—¶é—´ï¼›
- Max-Ageï¼šcookie å¤±æ•ˆæ—¶é—´ï¼Œç›¸å¯¹æ—¶é—´ï¼›
- Domainï¼šæŒ‡å®š cookie å¯ä»¥é€è¾¾çš„ä¸»æœºåã€‚
- Pathï¼šæŒ‡å®šä¸€ä¸ª URL è·¯å¾„ï¼Œè¿™ä¸ªè·¯å¾„å¿…é¡»å‡ºçŽ°åœ¨è¦è¯·æ±‚çš„èµ„æºçš„è·¯å¾„ä¸­æ‰å¯ä»¥å‘é€ Cookie é¦–éƒ¨
- Secureï¼šä¸€ä¸ªå¸¦æœ‰å®‰å…¨å±žæ€§çš„ cookie åªæœ‰åœ¨è¯·æ±‚ä½¿ç”¨ SSL å’Œ HTTPS åè®®çš„æ—¶å€™æ‰ä¼šè¢«å‘é€åˆ°æœåŠ¡å™¨ã€‚
- HttpOnly: è®¾ç½®äº† HttpOnly å±žæ€§çš„ cookie ä¸èƒ½ä½¿ç”¨ JavaScript ç»ç”± Document.cookie å±žæ€§ã€XMLHttpRequest å’Œ Request APIs è¿›è¡Œè®¿é—®ï¼Œä»¥é˜²èŒƒè·¨ç«™è„šæœ¬æ”»å‡»ï¼ˆXSSï¼‰ã€‚

### localStorageã€sessionStorage

å®¹é‡é€šå¸¸ä¸è¶…è¿‡ 5Mï¼Œå­˜å‚¨å†…å®¹æ ¼å¼ä¸ºå­—ç¬¦ä¸²ï¼Œå¯ä»¥æ ¼å¼åŒ–ä¸ºå­—ç¬¦ä¸²çš„èµ„æºå‡å¯å­˜å‚¨åœ¨å…¶ä¸­ã€‚localstorage ä¸­æ•°æ®åœ¨åŒåŸŸä¸‹å¯å…±äº«ï¼Œè€Œ sessionstorage åªåœ¨ä¼šè¯ç”Ÿå‘½å‘¨æœŸä¸­æœ‰æ•ˆã€‚

#### åŸºç¡€ API

```js
// ä¿å­˜æ•°æ®
localStorage.setItem('key', 'value');
sessionStorage.setItem('key', 'value');
// è¯»å–æ•°æ®
localStorage.getItem('key');
sessionStorage.getItem('key');
// åˆ é™¤å•ä¸ªæ•°æ®
localStorage.removeItem('key');
sessionStorage.removeItem('key');
// åˆ é™¤å…¨éƒ¨æ•°æ®
localStorage.clear();
sessionStorage.clear();
// èŽ·å–ç´¢å¼•çš„key
localStorage.key('index');
sessionStorage.key('index');
```

#### äº‹ä»¶ç›‘å¬

```js
window.addEventListener('storage', function(e) {
  console.log(e.key, e.oldValue, e.newValue);
});
```

### indexedDB

å¯ç”¨äºŽå­˜å‚¨éžç»“æž„åŒ–æ•°æ®ï¼Œè¯¥æ•°æ®åº“å±žäºŽéžå…³ç³»åž‹æ•°æ®åº“ï¼Œä¾¿äºŽæŸ¥è¯¢å­˜å‚¨ã€‚

ä¸€ä¸ªç¤ºä¾‹æ¼”ç¤º indexedDB çš„ä½¿ç”¨æ–¹å¼ï¼Œå¦‚ä¸‹ï¼š

```js
const DB_NAME = 'Netease';
const DB_VERSION = 1;
const OB_NAMES = {
  UseKeyPath: 'UseKeyPath',
  UseKeyGenerator: 'UseKeyGenerator',
};

function openIndexDB() {
  // The call to the open() function returns an IDBOpenDBRequest object with a result (success) or error value that you handle as an event.
  return new Promise((resolve, reject) => {
    /**
     * NOTE:
     * 1. ç¬¬ä¸€æ¬¡æ‰“å¼€å¯èƒ½ä¼šæç¤ºç”¨æˆ·èŽ·å– indexDB çš„æƒé™
     * 2. æµè§ˆå™¨éšèº«æ¨¡å¼ä¸ä¼šå­˜åœ¨æœ¬åœ°ï¼Œåªä¼šå­˜å‚¨åœ¨å†…å­˜ä¸­
     */
    const request = window.indexedDB.open(DB_NAME, DB_VERSION);
    request.onerror = function(event) {
      // Do something with request.errorCode!
      console.log('open request failed', event);
      console.error(event.target.error);
    };
    request.onsuccess = function(event) {
      // Do something with request.result!
      // console.log('open request success', event)
      var db = event.target.result;
      db.onerror = function(e) {
        console.error('Database error: ', e.target.error);
        reject(e.target.error);
      };
      db.onclose = e => {
        console.error('Database close:', e.target.error);
        reject(e.target.error);
      };
      resolve(db);
    };
    request.onupgradeneeded = function(event) {
      /**
       * NOTE:
       * 1. åˆ›å»ºæ–°çš„ objectStore
       * 2. åˆ é™¤æ—§çš„ä¸éœ€è¦çš„ objectStore
       * 3. å¦‚æžœéœ€è¦æ›´æ–°å·²æœ‰ objectStore çš„ç»“æž„ï¼Œéœ€è¦å…ˆåˆ é™¤åŽŸæœ‰çš„ objectStore ï¼Œç„¶åŽé‡æ–°åˆ›å»º
       */
      // The IDBDatabase interface
      console.log('onupgradeneeded', event);
      var db = event.target.result; // Create an objectStore for this database
      obUseKeypath(db);
      obUseKeyGenerator(db);
      /**
       * NOTE:
       * transaction
       * ä¸‰ä¸ªäº‹ä»¶ï¼š
       * 1. error
       * 2. abort
       * 3. complete
       * ä¸¤ä¸ªæ–¹æ³•ï¼š
       * 1. abort
       * Rolls back all the changes to objects in the database associated with this transaction. If this transaction has been aborted or completed, then this method throws an error event.
       * 2. objectStore
       * Returns an IDBObjectStore object representing an object store that is part of the scope of this transaction.
       */
      db.transaction.oncomplete = function(e) {
        console.log('obj create success', e);
      };
    };
  });
}

function obUseKeypath(db) {
  const objectStore = db.createObjectStore(OB_NAMES.UseKeyPath, {
    keyPath: 'time',
  });
  objectStore.createIndex('errorCode', 'errorCode', {
    unique: false,
  });
  objectStore.createIndex('level', 'level', {
    unique: false,
  });
}

function obUseKeyGenerator(db) {
  const objectStore = db.createObjectStore(OB_NAMES.UseKeyGenerator, {
    autoIncrement: true,
  });
  objectStore.createIndex('errorCode', 'errorCode', {
    unique: false,
  });
  objectStore.createIndex('time', 'time', {
    unique: true,
  });
  objectStore.createIndex('level', 'level', {
    unique: false,
  });
}

/**
 * æ·»åŠ æ•°æ®
 * @param {array} docs è¦æ·»åŠ æ•°æ®
 * @param {string} objName ä»“åº“åç§°
 */
function addData(docs, objName) {
  if (!(docs && docs.length)) {
    throw new Error('docs must be a array!');
  }
  return openIndexDB().then(db => {
    const tx = db.transaction([objName], 'readwrite');
    tx.oncomplete = e => {
      console.log('tx:addData onsuccess', e);
      return Promise.resolve(docs);
    };
    tx.onerror = e => {
      e.stopPropagation();
      console.error('tx:addData onerror', e.target.error);
      return Promise.reject(e.target.error);
    };
    tx.onabort = e => {
      console.warn('tx:addData abort', e.target);
      return Promise.reject(e.target.error);
    };
    const obj = tx.objectStore(objName);
    docs.forEach(doc => {
      const req = obj.add(doc);
      req.onerror = e => {
        console.error('obj:addData onerror', e.target.error);
      };
    });
  });
}

const TestData = [
  {
    event: 'NE-TEST1',
    level: 'warning',
    errorCode: 200,
    url: 'http://www.example.com',
    time: '2017/11/8 ä¸‹åˆ4:53:039',
    isUploaded: false,
  },
];

addData(TestData, OB_NAMES.UseKeyGenerator).then(() =>
  addData(TestData, OB_NAMES.UseKeyPath),
);
```
