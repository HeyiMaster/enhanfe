---
nav:
  title: è¿›é˜¶
order: 3
title: å‰ç«¯é¡¹ç›®è„šæ‰‹æ¶å¼€å‘å®è·µ
---

## é¡¹ç›®èƒŒæ™¯

ç›¸ä¿¡å¤§å®¶åœ¨å·¥ä½œä¸­éƒ½æœ‰å¦‚ä¸‹ç»å†ï¼š

1. å¼€å‘æ–°é¡¹ç›®ï¼Œå¾ˆå¤šé€»è¾‘æ¯”å¦‚ï¼šé¡¹ç›®æ¶æ„ã€æ¥å£è¯·æ±‚ã€çŠ¶æ€ç®¡ç†ã€å›½é™…åŒ–ã€æ¢è‚¤ç­‰ä¹‹å‰é¡¹ç›®å°±å·²ç»å­˜åœ¨ï¼Œè¿™æ—¶ï¼Œæˆ‘ä»¬é€‰æ‹©â€œä¿¡æ‰‹æ‹ˆæ¥â€ï¼Œctrl + cï¼Œctrl + v äºŒè¿ï¼Œè°ˆç¬‘é—´ï¼Œæ–°é¡¹ç›®æ­å»ºå®Œæˆï¼Œæ— éæ˜¯è¦æ”¹æ”¹ä¸€äº›æ–‡ä»¶å’ŒåŒ…åï¼›
2. é¡¹ç›®å¢åŠ æŸä¸ªæ¨¡å—æ—¶ï¼Œå¤åˆ¶ä¸€ä¸ªå·²æœ‰æ¨¡å—ï¼Œæ”¹æ”¹åå­—ï¼Œæ–°çš„æ¨¡å—å°±ç®—åˆ›å»ºæˆåŠŸäº†ï¼›
3. é¡¹ç›®çš„è§„èŒƒè¦æ— æ—¶æ— åˆ»ä¸åœ¨åŒäº‹è€³è¾¹æåŠï¼Œå°±ç®—æœ‰è§„èŒƒæ–‡æ¡£ï¼Œä½ è¿˜éœ€è¦è‹¦å£å©†å¿ƒã€‚

ä½¿ç”¨å¤åˆ¶ç²˜è´´æœ‰ä»¥ä¸‹ç¼ºç‚¹ï¼š

1. é‡å¤æ€§å·¥ä½œï¼Œç¹çè€Œä¸”æµªè´¹æ—¶é—´
2. copy è¿‡æ¥çš„æ¨¡æ¿å®¹æ˜“å­˜åœ¨æ— å…³çš„ä»£ç 
3. é¡¹ç›®ä¸­æœ‰å¾ˆå¤šéœ€è¦é…ç½®çš„åœ°æ–¹ï¼Œå®¹æ˜“å¿½ç•¥ä¸€äº›é…ç½®ç‚¹
4. äººå·¥æ“ä½œæ°¸è¿œéƒ½æœ‰å¯èƒ½çŠ¯é”™ï¼Œå»ºæ–°é¡¹ç›®æ—¶ï¼Œæ€»è¦èŠ±æ—¶é—´å»æ’é”™
5. æ¡†æ¶ä¹Ÿä¼šä¸æ–­è¿­ä»£ï¼Œäººå·¥å»ºé¡¹ç›®ä¸çŸ¥é“æœ€æ–°ç‰ˆæœ¬å·æ˜¯å¤šå°‘ï¼Œä½¿ç”¨çš„ä¾èµ–éƒ½æ˜¯ä»€ä¹ˆç‰ˆæœ¬ï¼Œå¾ˆå®¹æ˜“ bug ä¸€å¤§å †ã€‚

æ‰¿å—è¿‡ä»¥ä¸Šä¸€äº›ç—›è‹¦çš„åŒå­¦åº”è¯¥ä¸å°‘ï¼Œæ€ä¹ˆå»è§£å†³è¿™äº›é—®é¢˜å‘¢ï¼Ÿæˆ‘è§‰å¾—ï¼Œè„šæ‰‹æ¶èƒ½å¤Ÿè§„é¿å¾ˆå¤šè®¤ä¸ºæ“ä½œçš„é—®é¢˜ï¼Œå› ä¸ºè„šæ‰‹æ¶èƒ½å¤Ÿæ ¹æ®ä½ äº‹å…ˆçº¦å®šçš„è§„èŒƒï¼Œåˆ›å»ºé¡¹ç›®ï¼Œå®šä¹‰æ–°çš„æ¨¡å—ï¼Œæ‰“åŒ…ï¼Œéƒ¨ç½²ç­‰ç­‰éƒ½èƒ½å¤Ÿåœ¨ä¸€ä¸ªå‘½ä»¤æ•²å‡»åæå®šï¼Œæå‡æ•ˆç‡çš„åŒæ—¶é™ä½äº†å…¥èŒå‘˜å·¥çš„åŸ¹è®­æˆæœ¬ï¼Œæ‰€ä»¥ï¼Œæˆ‘æ¨èå¤§å®¶è€ƒè™‘è€ƒè™‘ä¸ºå›¢é˜Ÿæ‰“é€ ä¸€ä¸ªè„šæ‰‹æ¶ï¼

## è„šæ‰‹æ¶æ‰€éœ€ä¾èµ–

| åº“å              | æè¿°             |
| ----------------- | ---------------- |
| commander         | å¤„ç†æ§åˆ¶å°å‘½ä»¤   |
| chalk             | äº”å½©æ–‘æ–“çš„æ§åˆ¶å° |
| semver            | ç‰ˆæœ¬æ£€æµ‹æç¤º     |
| fs-extra          | æ›´å‹å¥½çš„ fs æ“ä½œ |
| inquirer          | æ§åˆ¶å°è¯¢é—®       |
| execa             | æ‰§è¡Œç»ˆç«¯å‘½ä»¤     |
| download-git-repo | git è¿œç¨‹ä»“åº“æ‹‰å– |

## è„šæ‰‹æ¶çš„èŒè´£å’Œæ‰§è¡Œè¿‡ç¨‹

è„šæ‰‹æ¶å¯ä»¥ä¸ºæˆ‘ä»¬åšå¾ˆå¤šäº‹æƒ…ï¼Œæ¯”å¦‚é¡¹ç›®çš„åˆ›å»ºã€é¡¹ç›®æ¨¡å—çš„æ–°å¢ã€é¡¹ç›®æ‰“åŒ…ã€é¡¹ç›®ç»Ÿä¸€æµ‹è¯•ã€é¡¹ç›®å‘å¸ƒç­‰ï¼Œæˆ‘å…ˆä¸å¤§å®¶èŠèŠæœ€åˆå§‹çš„åŠŸèƒ½ï¼Œé¡¹ç›®åˆ›å»ºï¼š

<img src="./assets/scaffold/1.png"/>

ä¸Šå›¾å‘å¤§å®¶å±•ç¤ºäº†åˆ›å»ºé¡¹ç›®å’Œé¡¹ç›®ä¸­åˆ›å»ºæ¨¡å—çš„è„šæ‰‹æ¶å¤§è‡´å·¥ä½œæµç¨‹ï¼Œä¸‹å›¾æ›´è¯¦ç»†æè¿°äº†åŸºäºæ¨¡æ¿åˆ›å»ºçš„è¿‡ç¨‹ï¼š

<img src="./assets/scaffold/2.png"/>

å…¶å®æ€è·¯æ¯”è¾ƒç®€å•ï¼Œå½“æˆ‘ä»¬è¿è¡Œè„šæ‰‹æ¶å‘½ä»¤æ—¶ï¼Œå‘½ä»¤è¡Œä¼šç»™å‡ºç›¸å…³åˆ›å»ºå‘½ä»¤æç¤ºï¼Œæˆ‘ä»¬åªéœ€è¦æ ¹æ®ç›¸å…³æç¤ºè¾“å…¥å¯¹åº”å†…å®¹å³å¯ï¼Œé¡¹ç›®ç›¸å…³ä¿¡æ¯é”®å…¥å®Œæˆåï¼Œè„šæ‰‹æ¶ä¼šä»è¿œç¨‹ä»“åº“ï¼ˆè¿™é‡Œçš„ä»“åº“å¯ä»¥æ˜¯ githubã€gitlab ç­‰ï¼‰æ‹‰å–æ¨¡æ¿èµ„æºï¼Œç„¶åå°†æ¨¡æ¿ä¸­çš„å†…å®¹æ›¿æ¢ï¼Œè¾“å‡ºåˆ°æ–°çš„æ–‡ä»¶å¤¹ä¸­å®Œæˆé¡¹ç›®åˆ›å»ºå·¥ä½œã€‚

## package.json ä¸å…¥å£

é¡¹ç›®ç»“æ„å¦‚å›¾

<img src="./assets/scaffold/4.png"/>

åœ¨ package.json ä¸­æŒ‡æ˜ä½ çš„åŒ…é€šè¿‡æ€æ ·è½¯é“¾æ¥çš„å½¢å¼å¯åŠ¨ï¼š`bin` æŒ‡å®šï¼Œå› ä¸ºæ˜¯ package.json åŒ…ï¼Œæˆ‘ä»¬éœ€è¦æ³¨æ„ dependenciesã€devDependencies å’Œ peerDependencies çš„åŒºåˆ«ã€‚

```json
{
  "name": "awesome-test-cli",
  "version": "1.0.0",
  "description": "å‰ç«¯è„šæ‰‹æ¶å·¥å…·",
  "main": "index.js",
  "bin": {
    "awesome-test": "bin/main.js"
  },
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "keywords": ["scaffold", "efficient", "react"],
  "author": "walker",
  "license": "ISC",
  "engines": {
    "node": ">=8.9"
  },
  "dependencies": {
    "chalk": "^2.4.2",
    "commander": "^3.0.0",
    "download-git-repo": "^2.0.0",
    "execa": "^2.0.4",
    "fs-extra": "^8.1.0",
    "import-global": "^0.1.0",
    "inquirer": "^6.5.1",
    "lru-cache": "^5.1.1",
    "minimist": "^1.2.0",
    "nunjucks": "^3.2.0",
    "ora": "^3.4.0",
    "request-promise-native": "^1.0.7",
    "semver": "^6.3.0",
    "string.prototype.padstart": "^3.0.0",
    "valid-filename": "^3.1.0",
    "validate-npm-package-name": "^3.0.0"
  }
}
```

å®šä¹‰å¥½é¡¹ç›® package.json æ–‡ä»¶åï¼Œå®‰è£…ç›¸å…³ä¾èµ–ï¼Œå°±å¯ä»¥å¼€å§‹ç¼–å†™è„šæ‰‹æ¶å·¥ç¨‹ä»£ç äº†ã€‚

æˆ‘ä»¬é¦–å…ˆç¼–å†™è„šæ‰‹æ¶å…¥å£æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯ `/bin/main.js` ï¼Œè¯¥æ–‡ä»¶ä¸­å®šä¹‰çš„å†…å®¹ä¸»è¦æ“ä½œæ˜¯é€šè¿‡ `commander` å¤„ç†æ§åˆ¶å°å‘½ä»¤ï¼Œè§£æå‚æ•°ï¼Œå¹¶æ ¹æ®ä¸åŒå‚æ•°å¤„ç†ä¸åŒçš„é€»è¾‘.

```js
// å¼€å§‹å¤„ç†å‘½ä»¤
const program = require('commander');
const minimist = require('minimist');

program.version(require('../package').version).usage('<command> [options]');

// åˆ›å»ºå‘½ä»¤
program
  .command('create <app-name>')
  .description('create a new project')
  .option(
    '-p, --preset <presetName>',
    'Skip prompts and use saved or remote preset',
  )
  .option('-d, --default', 'Skip prompts and use default preset')
  .action((name, cmd) => {
    const options = cleanArgs(cmd);
    if (minimist(process.argv.slice(3))._.length > 1) {
      console.log(
        chalk.yellow(
          '\n âš ï¸  æ£€æµ‹åˆ°æ‚¨è¾“å…¥äº†å¤šä¸ªåç§°ï¼Œå°†ä»¥ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºé¡¹ç›®åï¼Œèˆå¼ƒåç»­å‚æ•°å“¦',
        ),
      );
    }
    require('../lib/create')(name, options);
  });
```

## create åˆ›å»ºé¡¹ç›®å‘½ä»¤

é€šå¸¸æˆ‘ä»¬ä¹ æƒ¯å°†åŒ…é¡¹ç›®é€»è¾‘ç›¸å…³å¤„ç†æ”¾åœ¨ `lib` ä¸­ï¼Œè¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬åé¢å¸Œæœ›æ·»åŠ æ›´å¤šå‘½ä»¤æˆ–æ“ä½œæ›´å‹å¥½ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬ç¼–å†™ `lib/create` æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶ä¸»è¦å¤„ç†æ–‡ä»¶ååˆæ³•æ£€æµ‹ï¼Œæ–‡ä»¶æ˜¯å¦å­˜åœ¨ç­‰é…ç½®ï¼Œæ£€æµ‹æ— è¯¯ï¼Œæ‰§è¡Œé¡¹ç›®åˆ›å»ºé€»è¾‘ï¼Œè¯¥é€»è¾‘æˆ‘ä»¬æ”¾åœ¨ `lib/Creator` æ–‡ä»¶ä¸­å¤„ç†ã€‚

```js
async function create(projectName, options) {
  const cwd = options.cwd || process.cwd();
  // æ˜¯å¦åœ¨å½“å‰ç›®å½•
  const inCurrent = projectName === '.';
  const name = inCurrent ? path.relative('../', cwd) : projectName;
  const targetDir = path.resolve(cwd, projectName || '.');

  const result = validatePackageName(name);
  // å¦‚æœæ‰€è¾“å…¥çš„ä¸æ˜¯åˆæ³•npmåŒ…åï¼Œåˆ™é€€å‡º
  if (!result.validForNewPackages) {
    console.error(chalk.red(`ä¸åˆæ³•çš„é¡¹ç›®å: "${name}"`));
    result.errors &&
      result.errors.forEach(err => {
        console.error(chalk.red.dim('âŒ ' + err));
      });
    result.warnings &&
      result.warnings.forEach(warn => {
        console.error(chalk.red.dim('âš ï¸ ' + warn));
      });
    exit(1);
  }

  // æ£€æŸ¥æ–‡ä»¶å¤¹æ˜¯å¦å­˜åœ¨
  if (fs.existsSync(targetDir)) {
    if (options.force) {
      await fs.remove(targetDir);
    } else {
      await clearConsole();
      if (inCurrent) {
        const { ok } = await inquirer.prompt([
          {
            name: 'ok',
            type: 'confirm',
            message: `Generate project in current directory?`,
          },
        ]);
        if (!ok) {
          return;
        }
      } else {
        const { action } = await inquirer.prompt([
          {
            name: 'action',
            type: 'list',
            message: `ç›®æ ‡æ–‡ä»¶å¤¹ ${chalk.cyan(targetDir)} å·²ç»å­˜åœ¨ï¼Œè¯·é€‰æ‹©ï¼š`,
            choices: [
              { name: 'è¦†ç›–', value: 'overwrite' },
              { name: 'å–æ¶ˆ', value: false },
            ],
          },
        ]);
        if (!action) {
          return;
        } else if (action === 'overwrite') {
          console.log(`\nRemoving ${chalk.cyan(targetDir)}...`);
          await fs.remove(targetDir);
        }
      }
    }
  }
  await clearConsole();

  // å‰é¢å®Œæˆå‡†å¤‡å·¥ä½œï¼Œæ­£å¼å¼€å§‹åˆ›å»ºé¡¹ç›®
  const creator = new Creator(name, targetDir);
  await creator.create(options);
}

module.exports = (...args) => {
  return create(...args).catch(err => {
    stopSpinner(false);
    error(err);
  });
};
```

é€šè¿‡ä»¥ä¸Šæ“ä½œï¼Œå®Œæˆäº†åˆ›å»ºé¡¹ç›®å‰çš„å‡†å¤‡å·¥ä½œï¼Œæ¥ä¸‹æ¥æ­£å¼è¿›è¡Œåˆ›å»ºï¼Œåˆ›å»ºæ“ä½œé€šè¿‡ä¸€ä¸‹ä»£ç å¼€å§‹

```js
const creator = new Creator(name, targetDir);
await creator.create(options);
```

åˆ›å»ºé€»è¾‘æˆ‘ä»¬æ”¾åœ¨å¦å¤–æ–‡ä»¶ä¸­ `/lib/Creator`ï¼Œè¯¥æ–‡ä»¶ä¸­æˆ‘ä»¬ä¸»è¦è¿›è¡Œçš„æ“ä½œæœ‰ï¼š

- æ‹‰å–è¿œç¨‹æ¨¡æ¿ï¼›
- è¯¢é—®é¡¹ç›®åˆ›å»ºç›¸å…³é…ç½®ï¼Œæ¯”å¦‚ï¼šé¡¹ç›®åã€é¡¹ç›®ç‰ˆæœ¬ã€æ“ä½œäººç­‰ï¼›
- å°†æ‹‰å–çš„æ¨¡æ¿æ–‡ä»¶æ‹·è´åˆ°åˆ›å»ºé¡¹ç›®æ–‡ä»¶å¤¹ä¸­ï¼Œç”Ÿæˆ readme æ–‡æ¡£ï¼›
- å®‰è£…é¡¹ç›®æ‰€éœ€ä¾èµ–ï¼›
- åˆ›å»º git ä»“åº“ï¼Œå®Œæˆé¡¹ç›®åˆ›å»ºã€‚

```js
const chalk = require('chalk');
const execa = require('execa');
const inquirer = require('inquirer');
const EventEmitter = require('events');
const loadRemotePreset = require('../lib/utils/loadRemotePreset');
const writeFileTree = require('../lib/utils/writeFileTree');
const copyFile = require('../lib/utils/copyFile');
const generateReadme = require('../lib/utils/generateReadme');
const { installDeps } = require('../lib/utils/installDeps');

const { defaults } = require('../lib/options');

const {
  log,
  error,
  hasYarn,
  hasGit,
  hasProjectGit,
  logWithSpinner,
  clearConsole,
  stopSpinner,
  exit,
} = require('../lib/utils/common');

module.exports = class Creator extends EventEmitter {
  constructor(name, context) {
    super();

    this.name = name;
    this.context = context;

    this.run = this.run.bind(this);
  }

  async create(cliOptions = {}, preset = null) {
    const { run, name, context } = this;

    if (cliOptions.preset) {
      // awesome-test create foo --preset mobx
      preset = await this.resolvePreset(cliOptions.preset, cliOptions.clone);
    } else {
      preset = await this.resolvePreset(
        defaults.presets.default,
        cliOptions.clone,
      );
    }

    await clearConsole();
    log(
      chalk.blue.bold(
        `Awesome-test CLI v${require('../package.json').version}`,
      ),
    );
    logWithSpinner(`âœ¨`, `æ­£åœ¨åˆ›å»ºé¡¹ç›® ${chalk.yellow(context)}.`);
    this.emit('creation', { event: 'creating' });

    stopSpinner();
    // è®¾ç½®æ–‡ä»¶åï¼Œç‰ˆæœ¬å·ç­‰
    const { pkgVers, pkgDes } = await inquirer.prompt([
      {
        name: 'pkgVers',
        message: `è¯·è¾“å…¥é¡¹ç›®ç‰ˆæœ¬å·`,
        default: '1.0.0',
      },
      {
        name: 'pkgDes',
        message: `è¯·è¾“å…¥é¡¹ç›®ç®€ä»‹`,
        default: 'project created by awesome-test-cli',
      },
    ]);

    // å°†ä¸‹è½½çš„ä¸´æ—¶æ–‡ä»¶æ‹·è´åˆ°é¡¹ç›®ä¸­
    const pkgJson = await copyFile(preset.tmpdir, preset.targetDir);

    const pkg = Object.assign(pkgJson, {
      version: pkgVers,
      description: pkgDes,
    });

    // write package.json
    log();
    logWithSpinner('ğŸ“„', `ç”Ÿæˆ ${chalk.yellow('package.json')} ç­‰æ¨¡æ¿æ–‡ä»¶`);
    await writeFileTree(context, {
      'package.json': JSON.stringify(pkg, null, 2),
    });

    // åŒ…ç®¡ç†
    const packageManager =
      (hasYarn() ? 'yarn' : null) || (hasPnpm3OrLater() ? 'pnpm' : 'npm');
    await writeFileTree(context, {
      'README.md': generateReadme(pkg, packageManager),
    });

    const shouldInitGit = this.shouldInitGit(cliOptions);
    if (shouldInitGit) {
      logWithSpinner(`ğŸ—ƒ`, `åˆå§‹åŒ–Gitä»“åº“`);
      this.emit('creation', { event: 'git-init' });
      await run('git init');
    }

    // å®‰è£…ä¾èµ–
    stopSpinner();
    log();
    logWithSpinner(`âš™`, `å®‰è£…ä¾èµ–`);
    // log(`âš™  å®‰è£…ä¾èµ–ä¸­ï¼Œè¯·ç¨ç­‰...`)

    await installDeps(context, packageManager, cliOptions.registry);

    // commit initial state
    let gitCommitFailed = false;
    if (shouldInitGit) {
      await run('git add -A');
      const msg = typeof cliOptions.git === 'string' ? cliOptions.git : 'init';
      try {
        await run('git', ['commit', '-m', msg]);
      } catch (e) {
        gitCommitFailed = true;
      }
    }

    // log instructions
    stopSpinner();
    log();
    log(`ğŸ‰  é¡¹ç›®åˆ›å»ºæˆåŠŸ ${chalk.yellow(name)}.`);
    if (!cliOptions.skipGetStarted) {
      log(
        `ğŸ‘‰  è¯·æŒ‰å¦‚ä¸‹å‘½ä»¤ï¼Œå¼€å§‹æ„‰å¿«å¼€å‘å§ï¼\n\n` +
          (this.context === process.cwd()
            ? ``
            : chalk.cyan(` ${chalk.gray('$')} cd ${name}\n`)) +
          chalk.cyan(
            ` ${chalk.gray('$')} ${
              packageManager === 'yarn'
                ? 'yarn start'
                : packageManager === 'pnpm'
                ? 'pnpm run start'
                : 'npm start'
            }`,
          ),
      );
    }
    log();
    this.emit('creation', { event: 'done' });

    if (gitCommitFailed) {
      warn(
        `å› æ‚¨çš„git usernameæˆ–emailé…ç½®ä¸æ­£ç¡®ï¼Œæ— æ³•ä¸ºæ‚¨åˆå§‹åŒ–git commitï¼Œ\n` +
          `è¯·ç¨åè‡ªè¡Œgit commitã€‚\n`,
      );
    }
  }

  async resolvePreset(name, clone) {
    let preset;
    logWithSpinner(`Fetching remote preset ${chalk.cyan(name)}...`);
    this.emit('creation', { event: 'fetch-remote-preset' });
    try {
      preset = await loadRemotePreset(name, this.context, clone);
      stopSpinner();
    } catch (e) {
      stopSpinner();
      error(`Failed fetching remote preset ${chalk.cyan(name)}:`);
      throw e;
    }

    // é»˜è®¤ä½¿ç”¨defaultå‚æ•°
    if (name === 'default' && !preset) {
      preset = defaults.presets.default;
    }
    if (!preset) {
      error(`preset "${name}" not found.`);
      exit(1);
    }
    return preset;
  }

  run(command, args) {
    if (!args) {
      [command, ...args] = command.split(/\s+/);
    }
    return execa(command, args, { cwd: this.context });
  }

  shouldInitGit(cliOptions) {
    if (!hasGit()) {
      return false;
    }
    // --git
    if (cliOptions.forceGit) {
      return true;
    }
    // --no-git
    if (cliOptions.git === false || cliOptions.git === 'false') {
      return false;
    }
    // default: true unless already in a git repo
    return !hasProjectGit(this.context);
  }
};
```

åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å®Œæˆäº†é¡¹ç›®çš„åˆ›å»ºï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ä¸€èµ·çœ‹çœ‹é¡¹ç›®çš„æ¨¡å—åˆ›å»ºã€‚

## page åˆ›å»ºæ¨¡å—

æˆ‘ä»¬å›åˆ°å…¥å£æ–‡ä»¶ï¼Œæ·»åŠ  page å‘½ä»¤çš„å¤„ç†

```js
// åˆ›å»ºé¡µé¢å‘½ä»¤
program
  .command('page <page-name>')
  .description('create a new page')
  .option('-f, --force', 'Overwrite target directory if it exists')
  .action((name, cmd) => {
    const options = cleanArgs(cmd);
    require('../lib/page')(name, options);
  });
```

ä¸ create ç±»ä¼¼ï¼Œæˆ‘ä»¬çœŸæ­£çš„é€»è¾‘å¤„ç†æ”¾ç½®åœ¨ `lib/page` ä¸­ï¼Œpage ä¸­ä¸»è¦è´Ÿè´£çš„å†…å®¹å’Œ create ç±»ä¼¼ï¼Œä¸ºåˆ›å»ºæ¨¡å—åšä¸€äº›å‡†å¤‡ï¼Œæ¯”å¦‚æ£€æµ‹é¡¹ç›®ä¸­æ”¹æ¨¡å—æ˜¯å¦å·²ç»å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨ï¼Œè¯¢é—®æ˜¯å¦è¦†ç›–ç­‰æ“ä½œã€‚

```js
const fs = require('fs-extra');
const path = require('path');
const chalk = require('chalk');
const inquirer = require('inquirer');
const PageCreator = require('./PageCreator');
const validFileName = require('valid-filename');
const {
  error,
  stopSpinner,
  exit,
  clearConsole,
} = require('../lib/utils/common');

/**
 * åˆ›å»ºé¡¹ç›®
 * @param {*} pageName
 * @param {*} options
 */
async function create(pageName, options) {
  // æ£€æµ‹æ–‡ä»¶åæ˜¯å¦åˆè§„
  const result = validFileName(pageName);
  // å¦‚æœæ‰€è¾“å…¥çš„ä¸æ˜¯åˆæ³•npmåŒ…åï¼Œåˆ™é€€å‡º
  if (!result) {
    console.error(chalk.red(`ä¸åˆæ³•çš„æ–‡ä»¶å: "${pageName}"`));
    exit(1);
  }

  const cwd = options.cwd || process.cwd();
  const pagePath = path.resolve(
    cwd,
    './src/pages',
    pageName.charAt(0).toUpperCase() + pageName.slice(1).toLowerCase(),
  );
  const pkgJsonFile = path.resolve(cwd, 'package.json');

  // å¦‚æœä¸å­˜åœ¨package.jsonï¼Œè¯´æ˜ä¸å†æ ¹ç›®å½•ï¼Œä¸èƒ½åˆ›å»º
  if (!fs.existsSync(pkgJsonFile)) {
    console.error(
      chalk.red('\n' + 'âš ï¸  è¯·ç¡®è®¤æ‚¨æ˜¯å¦åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹è¿è¡Œæ­¤å‘½ä»¤\n'),
    );
    return;
  }

  // å¦‚æœpageå·²ç»å­˜åœ¨ï¼Œè¯¢é—®è¦†ç›–è¿˜æ˜¯å–æ¶ˆ
  if (fs.existsSync(pagePath)) {
    if (options.force) {
      await fs.remove(pagePath);
    } else {
      await clearConsole();
      const { action } = await inquirer.prompt([
        {
          name: 'action',
          type: 'list',
          message: `å·²å­˜åœ¨ ${chalk.cyan(pageName)} é¡µé¢ï¼Œè¯·é€‰æ‹©ï¼š`,
          choices: [
            { name: 'è¦†ç›–', value: true },
            { name: 'å–æ¶ˆ', value: false },
          ],
        },
      ]);
      if (!action) {
        return;
      } else {
        console.log(`\nRemoving ${chalk.cyan(pagePath)}...`);
        await fs.remove(pagePath);
      }
    }
  }

  // å‰é¢å®Œæˆå‡†å¤‡å·¥ä½œï¼Œæ­£å¼å¼€å§‹åˆ›å»ºé¡µé¢
  const pageCreator = new PageCreator(pageName, pagePath);
  await pageCreator.create(options);
}

module.exports = (...args) => {
  return create(...args).catch(err => {
    stopSpinner(false);
    error(err);
  });
};
```

æ£€æµ‹å®Œä»¥åï¼Œé€šè¿‡ä»¥ä¸‹ä»£ç ï¼Œæ‰§è¡Œ page åˆ›å»ºçš„é€»è¾‘

```js
// å‰é¢å®Œæˆå‡†å¤‡å·¥ä½œï¼Œæ­£å¼å¼€å§‹åˆ›å»ºé¡µé¢
const pageCreator = new PageCreator(pageName, pagePath);
await pageCreator.create(options);
```

åœ¨ `lib/pageCreator` æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡è¯»å–é¢„å…ˆå®šä¹‰å¥½çš„æ¨¡æ¿æ–‡ä»¶ï¼Œç”Ÿæˆç›®æ ‡æ–‡ä»¶ï¼Œåœ¨è¿™é‡Œä½¿ç”¨äº†ä¸€ä¸ªæ¨¡æ¿è¯­è¨€â€”â€”nunjucksï¼Œæˆ‘ä»¬å°†ç”Ÿæˆé¡µé¢çš„æ“ä½œæ”¾ç½®åœ¨ `utils/generatePage` æ–‡ä»¶ä¸­å¤„ç†ï¼Œå¦‚ä¸‹ï¼š

```js
const chalk = require('chalk');
const path = require('path');
const fs = require('fs-extra');
const nunjucks = require('nunjucks');

const { log, error, logWithSpinner, stopSpinner } = require('./common');

const tempPath = path.resolve(__dirname, '../../temp');
const pageTempPath = path.resolve(tempPath, 'page.js');
const lessTempPath = path.resolve(tempPath, 'page.less');
const ioTempPath = path.resolve(tempPath, 'io.js');
const storeTempPath = path.resolve(tempPath, 'store.js');

async function generatePage(context, { lowerName, upperName }) {
  logWithSpinner(`ç”Ÿæˆ ${chalk.yellow(`${upperName}/${upperName}.js`)}`);
  const ioTemp = await fs.readFile(pageTempPath);
  const ioContent = nunjucks.renderString(ioTemp.toString(), {
    lowerName,
    upperName,
  });
  await fs.writeFile(path.resolve(context, `./${upperName}.js`), ioContent, {
    flag: 'a',
  });
  stopSpinner();
}

async function generateLess(context, { lowerName, upperName }) {
  logWithSpinner(`ç”Ÿæˆ ${chalk.yellow(`${upperName}/${upperName}.less`)}`);
  const ioTemp = await fs.readFile(lessTempPath);
  const ioContent = nunjucks.renderString(ioTemp.toString(), {
    lowerName,
    upperName,
  });
  await fs.writeFile(path.resolve(context, `./${upperName}.less`), ioContent, {
    flag: 'a',
  });
  stopSpinner();
}

async function generateIo(context, { lowerName, upperName }) {
  logWithSpinner(`ç”Ÿæˆ ${chalk.yellow(`${upperName}/io.js`)}`);
  const ioTemp = await fs.readFile(ioTempPath);
  const ioContent = nunjucks.renderString(ioTemp.toString(), {
    lowerName,
    upperName,
  });
  await fs.writeFile(path.resolve(context, `./io.js`), ioContent, {
    flag: 'a',
  });
  stopSpinner();
}

async function generateStore(context, { lowerName, upperName }) {
  logWithSpinner(`ç”Ÿæˆ ${chalk.yellow(`${upperName}/store-${lowerName}.js`)}`);
  const ioTemp = await fs.readFile(storeTempPath);
  const ioContent = nunjucks.renderString(ioTemp.toString(), {
    lowerName,
    upperName,
  });
  await fs.writeFile(
    path.resolve(context, `./store-${lowerName}.js`),
    ioContent,
    { flag: 'a' },
  );
  stopSpinner();
}

module.exports = (context, nameObj) => {
  Promise.all([
    generateIo(context, nameObj),
    generatePage(context, nameObj),
    generateStore(context, nameObj),
    generateLess(context, nameObj),
  ]).catch(err => {
    stopSpinner(false);
    error(err);
  });
};
```

åœ¨ PageCreator ä¸­å¼•å…¥è¯¥æ–‡ä»¶ï¼Œå¹¶æ‰§è¡Œï¼Œç»™ä¸€äº›æç¤ºï¼Œä¼šæ›´å‹å¥½ã€‚

```js
const chalk = require('chalk');
const EventEmitter = require('events');
const fs = require('fs-extra');

const generatePage = require('./utils/generatePage');

const {
  log,
  error,
  logWithSpinner,
  clearConsole,
  stopSpinner,
  exit,
} = require('../lib/utils/common');

module.exports = class PageCreator extends EventEmitter {
  constructor(name, context) {
    super();

    this.name = name;
    this.context = context;
  }

  async create(cliOptions = {}) {
    const fileNameObj = this.getName();
    const { context } = this;
    await clearConsole();
    log(
      chalk.blue.bold(
        `Awesome-test CLI v${require('../package.json').version}`,
      ),
    );
    logWithSpinner(`âœ¨`, `æ­£åœ¨åˆ›å»ºé¡µé¢...`);
    // åˆ›å»ºæ–‡ä»¶å¤¹
    await fs.mkdir(context, { recursive: true });
    this.emit('creation', { event: 'creating' });

    stopSpinner();

    console.log(context);
    await generatePage(context, fileNameObj);
  }

  getName() {
    const originName = this.name;
    const tailName = originName.slice(1);
    const upperName = originName.charAt(0).toUpperCase() + tailName;
    const lowerName = originName.charAt(0).toLowerCase() + tailName;
    return {
      upperName,
      lowerName,
    };
  }
};
```

åˆ°è¿™é‡Œæˆ‘ä»¬å®Œæˆäº†è„šæ‰‹æ¶çš„é¡¹ç›®åˆ›å»ºå’Œæ¨¡å—åˆ›å»ºï¼Œç›¸ä¿¡æ­¤æ—¶çš„ä½ ä¹Ÿè¿«ä¸åŠå¾…äº†ï¼Œä½ å¯ä»¥é¡ºç€è¿™ä¸ªæ€è·¯ï¼Œèµ°ä¸‹å»ï¼Œä¸ºè„šæ‰‹æ¶èµ‹äºˆæ›´å¤šèƒ½åŠ›ï¼

é¡¹ç›®æºç ï¼š[https://github.com/HeyiMaster/awesome-test-cli](https://github.com/HeyiMaster/awesome-test-cli)
