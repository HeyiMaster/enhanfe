<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link
      rel="shortcut icon"
      type="image/x-icon"
      href="https://walker-markdown.oss-cn-shenzhen.aliyuncs.com/uPic/enhanfe.png"
    />
    <link rel="stylesheet" href="/umi.css" />
    <script>
      window.routerBase = "/";
    </script>
    <script>
      //! umi version: 3.5.2
    </script>
    <script>
      !(function () {
        var e = localStorage.getItem("dumi:prefers-color"),
          t = window.matchMedia("(prefers-color-scheme: dark)").matches,
          r = ["light", "dark", "auto"];
        document.documentElement.setAttribute(
          "data-prefers-color",
          e === r[2] ? (t ? r[1] : r[0]) : r.includes(e) ? e : r[0]
        );
      })();
    </script>
    <title>Redux åŸç†æµ…æ</title>
  </head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-route="/advanced/redux" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" style="background-image:url(&#x27;https://walker-markdown.oss-cn-shenzhen.aliyuncs.com/uPic/enhanfe.png&#x27;)" href="/">Enhanfe</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><span><a href="/basic">ğŸ’Š åŸºç¡€</a></span><span><a aria-current="page" class="active" href="/advanced">ğŸ”¥ è¿›é˜¶</a></span><span><a href="/algorithms">ğŸ¦ æ•°æ®ç»“æ„ä¸ç®—æ³•</a></span><span><a target="_blank" rel="noopener noreferrer" href="https://github.com/HeyiMaster/enhanfe">â­ï¸Â Â GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></span><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "></div></div></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;https://walker-markdown.oss-cn-shenzhen.aliyuncs.com/uPic/enhanfe.png&#x27;)" href="/"></a><h1>Enhanfe</h1><p></p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li><a href="/basic">ğŸ’Š åŸºç¡€</a></li><li><a aria-current="page" class="active" href="/advanced">ğŸ”¥ è¿›é˜¶</a></li><li><a href="/algorithms">ğŸ¦ æ•°æ®ç»“æ„ä¸ç®—æ³•</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://github.com/HeyiMaster/enhanfe">â­ï¸Â Â GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "><button title="Dark theme" class="__dumi-default-dark-moon "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3854" width="22" height="22"><path d="M991.816611 674.909091a69.166545 69.166545 0 0 0-51.665455-23.272727 70.795636 70.795636 0 0 0-27.438545 5.585454A415.674182 415.674182 0 0 1 754.993338 698.181818c-209.594182 0-393.472-184.785455-393.472-395.636363 0-52.363636 38.539636-119.621818 69.515637-173.614546 4.887273-8.610909 9.634909-16.756364 14.103272-24.901818A69.818182 69.818182 0 0 0 384.631156 0a70.842182 70.842182 0 0 0-27.438545 5.585455C161.678429 90.298182 14.362065 307.898182 14.362065 512c0 282.298182 238.824727 512 532.38691 512a522.286545 522.286545 0 0 0 453.957818-268.334545A69.818182 69.818182 0 0 0 991.816611 674.909091zM546.679156 954.181818c-248.785455 0-462.941091-192-462.941091-442.181818 0-186.647273 140.637091-372.829091 300.939637-442.181818-36.817455 65.629091-92.578909 151.970909-92.578909 232.727273 0 250.181818 214.109091 465.454545 462.917818 465.454545a488.331636 488.331636 0 0 0 185.181091-46.545455 453.003636 453.003636 0 0 1-393.565091 232.727273z m103.656728-669.323636l-14.266182 83.781818a34.909091 34.909091 0 0 0 50.362182 36.770909l74.775272-39.563636 74.752 39.563636a36.142545 36.142545 0 0 0 16.174546 3.956364 34.909091 34.909091 0 0 0 34.210909-40.727273l-14.289455-83.781818 60.509091-59.345455a35.025455 35.025455 0 0 0-19.223272-59.578182l-83.61891-12.101818-37.376-76.101818a34.56 34.56 0 0 0-62.254545 0l-37.376 76.101818-83.618909 12.101818a34.909091 34.909091 0 0 0-19.246546 59.578182z m70.423272-64.698182a34.280727 34.280727 0 0 0 26.135273-19.083636l14.312727-29.090909 14.336 29.090909a34.257455 34.257455 0 0 0 26.135273 19.083636l32.046546 4.887273-23.272728 22.574545a35.234909 35.234909 0 0 0-10.007272 30.952727l5.46909 32.116364-28.625454-15.127273a34.490182 34.490182 0 0 0-32.302546 0l-28.695272 15.127273 5.469091-32.116364a35.141818 35.141818 0 0 0-9.984-30.952727l-23.272728-22.574545z" p-id="3855"></path></svg></button><button title="Light theme" class="__dumi-default-dark-sun "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4026" width="22" height="22"><path d="M915.2 476.16h-43.968c-24.704 0-44.736 16-44.736 35.84s20.032 35.904 44.736 35.904H915.2c24.768 0 44.8-16.064 44.8-35.904s-20.032-35.84-44.8-35.84zM512 265.6c-136.704 0-246.464 109.824-246.464 246.4 0 136.704 109.76 246.464 246.464 246.464S758.4 648.704 758.4 512c0-136.576-109.696-246.4-246.4-246.4z m0 425.6c-99.008 0-179.2-80.128-179.2-179.2 0-98.944 80.192-179.2 179.2-179.2S691.2 413.056 691.2 512c0 99.072-80.192 179.2-179.2 179.2zM197.44 512c0-19.84-19.136-35.84-43.904-35.84H108.8c-24.768 0-44.8 16-44.8 35.84s20.032 35.904 44.8 35.904h44.736c24.768 0 43.904-16.064 43.904-35.904zM512 198.464c19.776 0 35.84-20.032 35.84-44.8v-44.8C547.84 84.032 531.84 64 512 64s-35.904 20.032-35.904 44.8v44.8c0 24.768 16.128 44.864 35.904 44.864z m0 627.136c-19.776 0-35.904 20.032-35.904 44.8v44.736C476.096 940.032 492.16 960 512 960s35.84-20.032 35.84-44.8v-44.736c0-24.768-16.064-44.864-35.84-44.864z m329.92-592.832c17.472-17.536 20.288-43.072 6.4-57.024-14.016-14.016-39.488-11.2-57.024 6.336-4.736 4.864-26.496 26.496-31.36 31.36-17.472 17.472-20.288 43.008-6.336 57.024 13.952 14.016 39.488 11.2 57.024-6.336 4.8-4.864 26.496-26.56 31.296-31.36zM213.376 759.936c-4.864 4.8-26.56 26.624-31.36 31.36-17.472 17.472-20.288 42.944-6.4 56.96 14.016 13.952 39.552 11.2 57.024-6.336 4.8-4.736 26.56-26.496 31.36-31.36 17.472-17.472 20.288-43.008 6.336-56.96-14.016-13.952-39.552-11.072-56.96 6.336z m19.328-577.92c-17.536-17.536-43.008-20.352-57.024-6.336-14.08 14.016-11.136 39.488 6.336 57.024 4.864 4.864 26.496 26.56 31.36 31.424 17.536 17.408 43.008 20.288 56.96 6.336 14.016-14.016 11.264-39.488-6.336-57.024-4.736-4.864-26.496-26.56-31.296-31.424z m527.168 628.608c4.864 4.864 26.624 26.624 31.36 31.424 17.536 17.408 43.072 20.224 57.088 6.336 13.952-14.016 11.072-39.552-6.4-57.024-4.864-4.8-26.56-26.496-31.36-31.36-17.472-17.408-43.072-20.288-57.024-6.336-13.952 14.016-11.008 39.488 6.336 56.96z" p-id="4027"></path></svg></button><button title="Default to system" class="__dumi-default-dark-auto "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="11002" width="22" height="22"><path d="M127.658667 492.885333c0-51.882667 10.24-101.717333 30.378666-149.162666s47.786667-88.064 81.92-122.538667 75.093333-61.781333 122.538667-81.92 96.938667-30.378667 149.162667-30.378667 101.717333 10.24 149.162666 30.378667 88.405333 47.786667 122.88 81.92 61.781333 75.093333 81.92 122.538667 30.378667 96.938667 30.378667 149.162666-10.24 101.717333-30.378667 149.162667-47.786667 88.405333-81.92 122.88-75.093333 61.781333-122.88 81.92-97.28 30.378667-149.162666 30.378667-101.717333-10.24-149.162667-30.378667-88.064-47.786667-122.538667-81.92-61.781333-75.093333-81.92-122.88-30.378667-96.938667-30.378666-149.162667z m329.045333 0c0 130.048 13.994667 244.394667 41.984 343.381334h12.970667c46.762667 0 91.136-9.216 133.461333-27.306667s78.848-42.666667 109.568-73.386667 54.954667-67.242667 73.386667-109.568 27.306667-86.698667 27.306666-133.461333c0-46.421333-9.216-90.794667-27.306666-133.12s-42.666667-78.848-73.386667-109.568-67.242667-54.954667-109.568-73.386667-86.698667-27.306667-133.461333-27.306666h-11.605334c-28.672 123.562667-43.349333 237.909333-43.349333 343.722666z" p-id="11003"></path></svg></button></div></div></div><ul class="__dumi-default-menu-list"><li><a href="/advanced/webpack">Tapable ä¸ Webpack æµ…æ</a></li><li><a href="/advanced/babel">Babel æµ…æ</a></li><li><a href="/advanced/scaffold">å‰ç«¯é¡¹ç›®è„šæ‰‹æ¶å¼€å‘å®è·µ</a></li><li><a aria-current="page" class="active" href="/advanced/redux">Redux åŸç†æµ…æ</a></li><li><a href="/advanced/buildownreact">React åŸç†æµ…æ</a></li><li><a href="/advanced/eventloop">äº‹ä»¶ç³»ç»Ÿæµ…æ</a></li><li><a href="/advanced/async">å¼‚æ­¥å¤„ç†æµ…æ</a></li></ul></div></div><ul role="slug-list" class="__dumi-default-layout-toc"><li title="Redux è®¾è®¡æ€æƒ³" data-depth="2"><a href="/advanced/redux#redux-è®¾è®¡æ€æƒ³"><span>Redux è®¾è®¡æ€æƒ³</span></a></li><li title="createStore" data-depth="2"><a href="/advanced/redux#createstore"><span>createStore</span></a></li><li title="combineReducer" data-depth="2"><a href="/advanced/redux#combinereducer"><span>combineReducer</span></a></li><li title="applyMiddleware" data-depth="2"><a href="/advanced/redux#applymiddleware"><span>applyMiddleware</span></a></li><li title="æ€»ç»“" data-depth="2"><a href="/advanced/redux#æ€»ç»“"><span>æ€»ç»“</span></a></li></ul><div class="__dumi-default-layout-content"><div class="markdown"><h2 id="redux-è®¾è®¡æ€æƒ³"><a aria-hidden="true" tabindex="-1" href="/advanced/redux#redux-è®¾è®¡æ€æƒ³"><span class="icon icon-link"></span></a>Redux è®¾è®¡æ€æƒ³</h2><p>Redux æ˜¯ä¸€ä¸ªéå¸¸æµè¡Œçš„å‰ç«¯çŠ¶æ€åº“ï¼Œå¾ˆå¤šäººçŸ¥é“ Redux æ˜¯ç¼˜è‡ª Reactã€‚é€šå¸¸æˆ‘ä»¬è®¤ä¸ºä½¿ç”¨ Redux ç®¡ç†é¡¹ç›®ä¸­çš„çŠ¶æ€ä¼šä½¿é¡¹ç›®å¼€å‘å˜å¾—ç®€å•ï¼Œä¸è¿‡ä¹Ÿæœ‰æ—¶ï¼Œé¡¹ç›®å¼•å…¥ Redux ä¼šä½¿å¾—é¡¹ç›®æ„ˆå‘å¤æ‚ã€‚ å…¶å®ï¼Œå­¦ä¹  Reduxï¼Œæˆ‘ä»¬æ›´å…³æ³¨çš„æ˜¯ Redux å¯¹äºçŠ¶æ€ç®¡ç†çš„æ€æƒ³ï¼Œå…¶ä¸­åŒ…å«äº†ä¸‰ä¸ªéå¸¸é‡è¦çš„æ¦‚å¿µï¼Œåˆ†åˆ«ä¸ºï¼š</p><ol><li>å•ä¸€æ•°æ®æº</li><li>state åªè¯»</li><li>ä½¿ç”¨çº¯å‡½æ•°æ‰§è¡ŒçŠ¶æ€ä¿®æ”¹</li></ol><p><strong>å•ä¸€æ•°æ®æº</strong>è¡¨ç¤ºï¼Œé¡¹ç›®ä¸­æ‰€æœ‰çŠ¶æ€ç»Ÿä¸€å­˜å‚¨åœ¨äº†ä¸€ä¸ªå˜é‡ä¸Šï¼Œä¹Ÿå¯ä»¥æè¿°ä¸ºå­˜å‚¨åœ¨äº†åŒä¸€æ£µ tree ä¸Šï¼Œè¿™ä½¿å¾—ä¸åŒç»„ä»¶ä¹‹é—´ï¼ŒçŠ¶æ€çš„åŒæ­¥ä¸æ›´æ–°å˜å¾—å¯é ï¼›<strong>state åªè¯»</strong>æ„å‘³ç€ï¼Œä½ æ— æ³•æ‰‹åŠ¨ä¿®æ”¹ state çš„å€¼ï¼Œstate å­˜å‚¨åœ¨æŸä¸ªç§æœ‰å˜é‡ä¸Šï¼Œä»¥è‡³äºä½ æ— æ³•ç›´æ¥è®¿é—®ï¼›<strong>çº¯å‡½æ•°ä¿®æ”¹çŠ¶æ€</strong>æ˜¯è¯´ï¼Œæ¯ä¸ªçŠ¶æ€çš„ä¿®æ”¹å¿…é¡»é€šè¿‡å®šä¹‰çš„ reducer å‡½æ•°å®Œæˆã€‚æˆ‘ä»¬é¦–å…ˆæ¥çœ‹ï¼Œä¸€ä¸ªæœ€ç®€å• Redux ä½¿ç”¨ç¤ºä¾‹ï¼Œä¸ºäº†ä¾¿äºæŸ¥çœ‹ï¼Œæˆ‘ä»¬æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­å±•ç¤ºï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword module">import</span><span class="token plain"> </span><span class="token imports punctuation">{</span><span class="token imports"> createStore </span><span class="token imports punctuation">}</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&#x27;redux&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> initialState </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  count</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">reducer</span><span class="token punctuation">(</span><span class="token parameter">state </span><span class="token parameter operator">=</span><span class="token parameter"> initialState</span><span class="token parameter punctuation">,</span><span class="token parameter"> action</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword control-flow">switch</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">action</span><span class="token punctuation">.</span><span class="token property-access">type</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">case</span><span class="token plain"> </span><span class="token string">&#x27;INCREASE&#x27;</span><span class="token operator">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token spread operator">...</span><span class="token plain">state</span><span class="token punctuation">,</span><span class="token plain"> count</span><span class="token operator">:</span><span class="token plain"> state</span><span class="token punctuation">.</span><span class="token property-access">count</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">case</span><span class="token plain"> </span><span class="token string">&#x27;DECREASE&#x27;</span><span class="token operator">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token spread operator">...</span><span class="token plain">state</span><span class="token punctuation">,</span><span class="token plain"> count</span><span class="token operator">:</span><span class="token plain"> state</span><span class="token punctuation">.</span><span class="token property-access">count</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword module">default</span><span class="token operator">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword control-flow">return</span><span class="token plain"> state</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> store </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">createStore</span><span class="token punctuation">(</span><span class="token plain">reducer</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// è®¢é˜… state å˜åŒ–</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">store</span><span class="token punctuation">.</span><span class="token method function property-access">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">store</span><span class="token punctuation">.</span><span class="token method function property-access">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">store</span><span class="token punctuation">.</span><span class="token method function property-access">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> type</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;ADD&#x27;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>ä»ä¸Šä¾‹æˆ‘ä»¬å¯ä»¥å‘ç°ï¼ŒçŠ¶æ€çš„æ›´æ”¹å®šä¹‰åœ¨ reducer å‡½æ•°ä¸­ï¼Œå¹¶ä¸”è¯¥å‡½æ•°æ¯æ¬¡è¢«è°ƒç”¨ï¼Œéƒ½ä¼šæ ¹æ®ä¼ å…¥ action ä¸­çš„ type å€¼è¿”å›å¯¹åº”æ–°å¯¹è±¡ï¼Œè¯¥æ–°å¯¹è±¡é™¤äº†éœ€è¦æ›´æ”¹çš„ count å€¼ä»¥å¤–ï¼Œå…¶ä»–å†…å®¹ä¸å˜ã€‚é€šè¿‡è¿™ä¸€ä¸ªä¾‹å­ï¼Œå°±èƒ½å˜æ¸… Redux è®¾è®¡æ€æƒ³ã€‚æˆ‘ä»¬å°±ä»è¿™ä¸ªç¤ºä¾‹å¼€å§‹ï¼Œæ‰‹å†™ä¸€ä¸ª Reduxï¼Œä»è€Œæ·±å…¥ç†è§£ Redux è®¾è®¡æ€æƒ³ã€‚</p><h2 id="createstore"><a aria-hidden="true" tabindex="-1" href="/advanced/redux#createstore"><span class="icon icon-link"></span></a>createStore</h2><p>é€šè¿‡ä¸Šä¾‹æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼ŒRedux æœ€æ ¸å¿ƒçš„ä¸€ä¸ª api ä¾¿æ˜¯ createStoreï¼Œè¯¥å‡½æ•°æ¥å—ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¿”å›ä¸€ä¸ª store å¯¹è±¡ï¼Œç›®å‰æˆ‘ä»¬è®¤ä¸ºè¯¥ store å¯¹è±¡åŒ…å«äº†ä¸€ä¸‹ä¸‰ä¸ªæ–¹æ³•ï¼šsubscribeã€dispatchã€getStateã€‚è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬å®ç° createStore æ–¹æ³•çš„æ€è·¯å°±æœ‰äº†ã€‚ä»£ç ç‰‡æ®µå¦‚ä¸‹ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">createStore</span><span class="token punctuation">(</span><span class="token parameter">reducer</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    subscribe</span></div><div class="token-line"><span class="token plain">    getState</span></div><div class="token-line"><span class="token plain">    dispatch</span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p>åœ¨æ­¤åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬æ ¹æ®æ•°æ®æºå•ä¸€è¿™ä¸€ç‰¹æ€§ï¼Œåœ¨åˆ›å»ºçš„ store ä¸­ï¼ŒçŠ¶æ€å­˜å‚¨åœ¨äº†ä¸€ä¸ªç§æœ‰çš„å˜é‡ä¸Šï¼Œè¯¥å˜é‡æ— æ³•è¢«å¤–ç•Œç›´æ¥è®¿é—®ï¼Œåªèƒ½é€šè¿‡ getState æ–¹æ³•è®¿é—®ã€‚state çš„å€¼æ˜¯é€šè¿‡è°ƒç”¨ reducer ä»¥åï¼Œå°† reducer å‡½æ•°è¿”å›çš„æ–° state å¯¹è±¡èµ‹ç»™äº†å†…éƒ¨ç§æœ‰ state å˜é‡ã€‚æ˜ç™½äº†è¿™å‡ ç‚¹ï¼Œæˆ‘ä»¬å°±å¯ä»¥å®Œå–„ä»¥ä¸Šä»£ç äº†ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment">// createStore.ts</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment">/**</span></div><div class="token-line"><span class="token comment"> * This function is used to create a redux store</span></div><div class="token-line"><span class="token comment"> * è¯¥å‡½æ•°ç”¨äºåˆ›å»º redux store</span></div><div class="token-line"><span class="token comment"> */</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token imports punctuation">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">Store</span><span class="token imports punctuation">,</span><span class="token imports"> </span><span class="token imports maybe-class-name">StoreEnhancer</span><span class="token imports punctuation">,</span><span class="token imports"> </span><span class="token imports maybe-class-name">StoreEnhancerStoreCreator</span><span class="token imports"> </span><span class="token imports punctuation">}</span><span class="token plain"> </span><span class="token keyword">from</span><span class="token plain"> </span><span class="token string">&#x27;./types/store&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token imports punctuation">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">Action</span><span class="token imports"> </span><span class="token imports punctuation">}</span><span class="token plain"> </span><span class="token keyword">from</span><span class="token plain"> </span><span class="token string">&#x27;./types/actions&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token imports punctuation">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">Reducer</span><span class="token imports"> </span><span class="token imports punctuation">}</span><span class="token plain"> </span><span class="token keyword">from</span><span class="token plain"> </span><span class="token string">&#x27;./types/reducers&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">export</span><span class="token plain"> </span><span class="token keyword">default</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token generic-function function">createStore</span><span class="token generic-function generic class-name operator">&lt;</span><span class="token generic-function generic class-name"></span></div><div class="token-line"><span class="token generic-function generic class-name">  </span><span class="token generic-function generic class-name constant">S</span><span class="token generic-function generic class-name punctuation">,</span><span class="token generic-function generic class-name"></span></div><div class="token-line"><span class="token generic-function generic class-name">  </span><span class="token generic-function generic class-name constant">A</span><span class="token generic-function generic class-name"> </span><span class="token generic-function generic class-name keyword">extends</span><span class="token generic-function generic class-name"> </span><span class="token generic-function generic class-name maybe-class-name">Action</span><span class="token generic-function generic class-name punctuation">,</span><span class="token generic-function generic class-name"></span></div><div class="token-line"><span class="token generic-function generic class-name">  </span><span class="token generic-function generic class-name maybe-class-name">Ext</span><span class="token generic-function generic class-name"> </span><span class="token generic-function generic class-name operator">=</span><span class="token generic-function generic class-name"> </span><span class="token generic-function generic class-name punctuation">{</span><span class="token generic-function generic class-name punctuation">}</span><span class="token generic-function generic class-name punctuation">,</span><span class="token generic-function generic class-name"></span></div><div class="token-line"><span class="token generic-function generic class-name">  </span><span class="token generic-function generic class-name maybe-class-name">StateExt</span><span class="token generic-function generic class-name"> </span><span class="token generic-function generic class-name operator">=</span><span class="token generic-function generic class-name"> </span><span class="token generic-function generic class-name builtin">never</span><span class="token generic-function generic class-name"></span></div><div class="token-line"><span class="token generic-function generic class-name"></span><span class="token generic-function generic class-name operator">&gt;</span><span class="token punctuation">(</span><span class="token plain">reducer</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">Reducer</span><span class="token punctuation">,</span><span class="token plain"> enhancer</span><span class="token operator">?</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">StoreEnhancer</span><span class="token operator">&lt;</span><span class="token maybe-class-name">Ext</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token maybe-class-name">StateExt</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">Store</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">let</span><span class="token plain"> state</span><span class="token operator">:</span><span class="token plain"> </span><span class="token constant">S</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> nextListeners</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token function-variable function">listener</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    nextListeners</span><span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="token plain">listener</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">/**</span></div><div class="token-line"><span class="token comment">     * return unsubscribe function</span></div><div class="token-line"><span class="token comment">     */</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">return</span><span class="token plain"> state</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token plain">action</span><span class="token operator">:</span><span class="token plain"> </span><span class="token constant">A</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    state </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">reducer</span><span class="token punctuation">(</span><span class="token plain">state</span><span class="token punctuation">,</span><span class="token plain"> action</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token keyword">let</span><span class="token plain"> i </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">,</span><span class="token plain"> len </span><span class="token operator">=</span><span class="token plain"> nextListeners</span><span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">;</span><span class="token plain"> i </span><span class="token operator">&lt;</span><span class="token plain"> len</span><span class="token punctuation">;</span><span class="token plain"> i</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      nextListeners</span><span class="token punctuation">[</span><span class="token plain">i</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    subscribe</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    getState</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    dispatch</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">as</span><span class="token plain"> </span><span class="token maybe-class-name">Store</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><blockquote><p>ä¸ºäº†ä½¿è¯»è€…å¯¹äº Redux çš„è®¤è¯†æ›´æ¸…æ™°ä¸¥è°¨ï¼Œæˆ‘ä»¬ä½¿ç”¨ Typescript å®ç°ç®€å•ç‰ˆ Reduxã€‚åŒæ—¶ï¼Œä¸ºäº†ä¿è¯æ–‡ç« ä¸¥è°¨æ€§ï¼Œæˆ‘ä¼šåœ¨æ¯ä¸ªçŸ¥è¯†ç‚¹åé™„ä¸Šå•å…ƒæµ‹è¯•ä»¥åŠæµ‹è¯•ç»“æœï¼Œæœ¬æ–‡æµ‹è¯•ä½¿ç”¨ jestï¼Œå¦‚æœæœ‰è¿˜ä¸æ¸…æ¥šçš„åŒå­¦å¯ä»¥äº‹å…ˆå­¦ä¹ ä¸€ä¸‹ jest çš„ä½¿ç”¨æ–¹æ³•ã€‚</p></blockquote><p>åˆ°è¿™é‡Œï¼Œä½ å¯èƒ½éš¾ä»¥ç½®ä¿¡ï¼Œå°±åœ¨æ­¤æ—¶ï¼Œä½ å·²ç»å®ç°äº†ä¸€ä¸ªç®€å•ç‰ˆçš„ Reduxã€‚ä¸ä¿¡ï¼Ÿæˆ‘ä»¬å†™å•å…ƒæµ‹è¯•ï¼Œçœ‹è¿è¡Œç»“æœæ˜¯å¦ç¬¦åˆé¢„æœŸã€‚</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment">// createStore.test.ts</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token imports punctuation">{</span><span class="token imports"></span></div><div class="token-line"><span class="token imports">  createStore</span><span class="token imports punctuation">,</span><span class="token imports"></span></div><div class="token-line"><span class="token imports"></span><span class="token imports punctuation">}</span><span class="token plain"> </span><span class="token keyword">from</span><span class="token plain"> </span><span class="token string">&#x27;../../src/Advanced/Redux&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&#x27;test redux&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#x27;basic usage&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> initialState </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      count</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">reducer</span><span class="token punctuation">(</span><span class="token plain">state </span><span class="token operator">=</span><span class="token plain"> initialState</span><span class="token punctuation">,</span><span class="token plain"> action</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">switch</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">action</span><span class="token punctuation">.</span><span class="token keyword">type</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword">case</span><span class="token plain"> </span><span class="token string">&#x27;ADD&#x27;</span><span class="token operator">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token spread operator">...</span><span class="token plain">state</span><span class="token punctuation">,</span><span class="token plain"> count</span><span class="token operator">:</span><span class="token plain"> state</span><span class="token punctuation">.</span><span class="token property-access">count</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword">case</span><span class="token plain"> </span><span class="token string">&#x27;REDUCE&#x27;</span><span class="token operator">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token spread operator">...</span><span class="token plain">state</span><span class="token punctuation">,</span><span class="token plain"> count</span><span class="token operator">:</span><span class="token plain"> state</span><span class="token punctuation">.</span><span class="token property-access">count</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword">default</span><span class="token operator">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token keyword">break</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> store </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">createStore</span><span class="token punctuation">(</span><span class="token plain">reducer</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    store</span><span class="token punctuation">.</span><span class="token method function property-access">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">store</span><span class="token punctuation">.</span><span class="token method function property-access">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    store</span><span class="token punctuation">.</span><span class="token method function property-access">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token keyword">type</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;ADD&#x27;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token plain">store</span><span class="token punctuation">.</span><span class="token method function property-access">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> count</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    store</span><span class="token punctuation">.</span><span class="token method function property-access">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token keyword">type</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;REDUCE&#x27;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token plain">store</span><span class="token punctuation">.</span><span class="token method function property-access">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> count</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p>å¯åŠ¨æµ‹è¯•åï¼Œè¯¥æµ‹è¯•ç”¨ä¾‹é¡ºåˆ©é€šè¿‡ï¼Œè¯´æ˜ç®€å•ç‰ˆ Redux å°è£…å®Œæˆã€‚</p><h2 id="combinereducer"><a aria-hidden="true" tabindex="-1" href="/advanced/redux#combinereducer"><span class="icon icon-link"></span></a>combineReducer</h2><p>é€šå¸¸æˆ‘ä»¬çš„é¡¹ç›®éƒ½è¦æ¯”ä¸Šä¾‹æ‰€åˆ—ä¸¾çš„éº»çƒ¦ï¼Œé¡¹ç›®ä¸­å¾€å¾€æœ‰å¾ˆå¤šæ¨¡å—ä¸­çš„çŠ¶æ€éƒ½éœ€è¦å­˜å‚¨åœ¨ Redux ä¸­ï¼Œé‚£ä¹Ÿå°±æ„å‘³ç€ï¼Œæˆ‘ä»¬å®šä¹‰çš„ reducer å‡½æ•°ä¸­å†…å®¹ä¼šç‰¹åˆ«å¤šï¼Œè¿™æ ·ä¸€æ¥ï¼Œé¡¹ç›®ä¼šå˜å¾—éš¾ä»¥ç»´æŠ¤ï¼Œæœ‰ä»€ä¹ˆå¥½çš„åŠæ³•æ‹†å¼€ reducerï¼Œæ¯ä¸ªæ¨¡éƒ½å¯ä»¥å®šä¹‰è‡ªå·±çŠ¶æ€ç›¸å…³çš„ reducerï¼Œæœ€ç»ˆåœ¨ store åˆ›å»ºæ—¶ï¼Œåˆå¹¶æ‰€æœ‰çš„ reducerã€‚è¿™æœ‰ç‚¹åˆ†æ²»çš„æ„æ€ï¼Œå¼€å‘æ—¶ï¼Œæˆ‘ä»¬äººä¸ºæŒ‰ç…§æ¨¡å—æ‹†åˆ†å„è‡ªçš„ reducerï¼Œåœ¨ store åˆ›å»ºæ—¶ï¼Œç¨‹åºè‡ªåŠ¨åˆå¹¶æˆ‘ä»¬æ‹†åˆ†çš„æ¨¡å—ç”Ÿæˆä¸€æ£µ state treeã€‚æ­£æ˜¯ combineReducer å®Œæˆäº†è¿™ä¸ªåˆå¹¶çš„æ“ä½œã€‚æˆ‘ä»¬å…ˆçœ‹çœ‹ï¼Œä½¿ç”¨ Redux æ—¶ï¼Œæ˜¯å¦‚ä½•ä½¿ç”¨ combineReducer çš„ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> countInitialState </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  count</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">countReducer</span><span class="token punctuation">(</span><span class="token parameter">state </span><span class="token parameter operator">=</span><span class="token parameter"> countInitialState</span><span class="token parameter punctuation">,</span><span class="token parameter"> action</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword control-flow">switch</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">action</span><span class="token punctuation">.</span><span class="token property-access">type</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">case</span><span class="token plain"> </span><span class="token string">&#x27;ADD&#x27;</span><span class="token operator">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token spread operator">...</span><span class="token plain">state</span><span class="token punctuation">,</span><span class="token plain"> count</span><span class="token operator">:</span><span class="token plain"> state</span><span class="token punctuation">.</span><span class="token property-access">count</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword module">default</span><span class="token operator">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword control-flow">return</span><span class="token plain"> state</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> numInitialState </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  num</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">numReducer</span><span class="token punctuation">(</span><span class="token parameter">state </span><span class="token parameter operator">=</span><span class="token parameter"> numInitialState</span><span class="token parameter punctuation">,</span><span class="token parameter"> action</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword control-flow">switch</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">action</span><span class="token punctuation">.</span><span class="token property-access">type</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">case</span><span class="token plain"> </span><span class="token string">&#x27;PLUS&#x27;</span><span class="token operator">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token spread operator">...</span><span class="token plain">state</span><span class="token punctuation">,</span><span class="token plain"> num</span><span class="token operator">:</span><span class="token plain"> state</span><span class="token punctuation">.</span><span class="token property-access">num</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword module">default</span><span class="token operator">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword control-flow">return</span><span class="token plain"> state</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> reducer </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">combineReducer</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  countState</span><span class="token operator">:</span><span class="token plain"> countReducer</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  numState</span><span class="token operator">:</span><span class="token plain"> numReducer</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> store </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">createStore</span><span class="token punctuation">(</span><span class="token plain">reducer</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">store</span><span class="token punctuation">.</span><span class="token method function property-access">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">store</span><span class="token punctuation">.</span><span class="token method function property-access">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">store</span><span class="token punctuation">.</span><span class="token method function property-access">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> type</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;ADD&#x27;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">store</span><span class="token punctuation">.</span><span class="token method function property-access">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> type</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;CUT&#x27;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>æˆ‘ä»¬å®šä¹‰äº†ä¸¤ä¸ª reducer åˆ†åˆ«ä¸ºï¼šcountReducer å’Œ numReducerï¼Œåœ¨ createStore å‰ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† combineReducer æ–¹æ³•ï¼Œå°†ä¸¤ä¸ª reducer åˆå¹¶ä¸ºä¸€ä¸ª reducer å¹¶è¿”å›ï¼Œæœ€ç»ˆå°†åˆå¹¶åçš„ reducer ä¼ é€’ç»™ createStoreï¼Œç”Ÿæˆ storeã€‚ è¿™æ ·ä¸€åˆ†æï¼Œé—®é¢˜å¥½åƒä¹Ÿæ˜æœ—äº†ï¼Œæˆ‘ä»¬ç€çœ¼äº combineReducer å‡½æ•°ï¼š</p><ol><li>è¯¥å‡½æ•°æ¥æ”¶çš„å‚æ•°ä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶ä¸”è¯¥å¯¹è±¡æ»¡è¶³ï¼šä»¥å¯¹åº”æ¨¡å—çŠ¶æ€åä½œä¸º keyï¼Œä»¥å¯¹åº”æ¨¡å— reducer å‡½æ•°ä½œä¸º valueï¼›</li><li>è¯¥å‡½æ•°è¿”å›å€¼ä¸º reducerï¼Œå°±åƒæˆ‘ä»¬ç¬¬ä¸€ä¸ªç¤ºä¾‹ä¸­æåˆ°çš„é‚£ä¸ª reducer å‡½æ•°ï¼Œä»–ä»¬çš„å†…åœ¨è¡¨ç°æ˜¯ä¸€è‡´çš„ã€‚</li></ol><p>æœ‰äº†è¿™ä¸¤ç‚¹ç†è®ºä¾æ®ä½œä¸ºæ”¯æ’‘ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°è¯•å†™å‡º combineReducer å‡½æ•°çš„åŸºæœ¬ç»“æ„äº†ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">combineReducer</span><span class="token punctuation">(</span><span class="token plain">reducerMaps</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// ...</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">combination</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// ...</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p>æ€è·¯å¾ˆç®€å•ï¼Œåœ¨ combineReducer å‡½æ•°ä¸­è·å–åˆ° reducerMaps çš„ key æ•°ç»„ï¼Œç„¶ååœ¨ combination å‡½æ•°ä¸­éå†è¿™äº› keyï¼Œè·å–å„è‡ªå¯¹åº”çš„ reducer å¹¶æ‰§è¡Œï¼Œå¾—åˆ°å„æ¨¡å— stateï¼Œç„¶åå°†è¿™äº› state ç»‘å®šåˆ°ä¸€ä¸ªå˜é‡ä¸Š nextStateï¼Œæœ€ç»ˆè¿”å› nextStateï¼Œå®Œæˆ reducer çš„åˆå¹¶ã€‚</p><p>æˆ‘ä»¬æ¥ç€å®Œå–„ä¸Šé¢çš„ä»£ç ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token imports punctuation">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">AnyAction</span><span class="token imports"> </span><span class="token imports punctuation">}</span><span class="token plain"> </span><span class="token keyword">from</span><span class="token plain"> </span><span class="token string">&#x27;./types/actions&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token imports punctuation">{</span><span class="token imports"></span></div><div class="token-line"><span class="token imports">  </span><span class="token imports maybe-class-name">ReducersMapObject</span><span class="token imports punctuation">,</span><span class="token imports"></span></div><div class="token-line"><span class="token imports">  </span><span class="token imports maybe-class-name">StateFromReducersMapObject</span><span class="token imports punctuation">,</span><span class="token imports"></span></div><div class="token-line"><span class="token imports"></span><span class="token imports punctuation">}</span><span class="token plain"> </span><span class="token keyword">from</span><span class="token plain"> </span><span class="token string">&#x27;./types/reducers&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">export</span><span class="token plain"> </span><span class="token keyword">default</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">combineReducer</span><span class="token punctuation">(</span><span class="token plain">reducers</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">ReducersMapObject</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">/**</span></div><div class="token-line"><span class="token comment">   * Get all reducer keys</span></div><div class="token-line"><span class="token comment">   * è·å–åˆ°æ‰€æœ‰ reducer key</span></div><div class="token-line"><span class="token comment">   * */</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> reducerKeys </span><span class="token operator">=</span><span class="token plain"> </span><span class="token known-class-name class-name">Object</span><span class="token punctuation">.</span><span class="token method function property-access">keys</span><span class="token punctuation">(</span><span class="token plain">reducers</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">/**</span></div><div class="token-line"><span class="token comment">   * Return the new reducer function</span></div><div class="token-line"><span class="token comment">   * è¿”å›æ–°çš„ reducer å‡½æ•°</span></div><div class="token-line"><span class="token comment">   * */</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">combination</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    state</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">StateFromReducersMapObject</span><span class="token operator">&lt;</span><span class="token keyword">typeof</span><span class="token plain"> reducers</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    action</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">AnyAction</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">/**</span></div><div class="token-line"><span class="token comment">     * Define a new state, which is used to store the state of all modules after the merge</span></div><div class="token-line"><span class="token comment">     * å®šä¹‰æ–°çš„ stateï¼Œè¯¥ state ç”¨æ¥å­˜å‚¨åˆå¹¶ä¹‹åçš„æ‰€æœ‰æ¨¡å— state</span></div><div class="token-line"><span class="token comment">     * */</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> nextState</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">StateFromReducersMapObject</span><span class="token operator">&lt;</span><span class="token keyword">typeof</span><span class="token plain"> reducers</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">/**</span></div><div class="token-line"><span class="token comment">     * Traverse all reducers</span></div><div class="token-line"><span class="token comment">     * éå†æ‰€æœ‰ reducer</span></div><div class="token-line"><span class="token comment">     * */</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token keyword">let</span><span class="token plain"> i </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">;</span><span class="token plain"> i </span><span class="token operator">&lt;</span><span class="token plain"> reducerKeys</span><span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">;</span><span class="token plain"> i</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">const</span><span class="token plain"> key </span><span class="token operator">=</span><span class="token plain"> reducerKeys</span><span class="token punctuation">[</span><span class="token plain">i</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">const</span><span class="token plain"> reducer </span><span class="token operator">=</span><span class="token plain"> reducers</span><span class="token punctuation">[</span><span class="token plain">key</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token comment">/**</span></div><div class="token-line"><span class="token comment">       * First get the value of the previous state, this is the value stored in createStore,</span></div><div class="token-line"><span class="token comment">       * this value is a state tree, including all module states</span></div><div class="token-line"><span class="token comment">       * å…ˆè·å–åˆ°ä¹‹å‰ state çš„å€¼ï¼Œè¿™ä¸ªæ˜¯ createStore ä¸­å­˜å‚¨çš„å€¼ï¼Œè¯¥å€¼æ˜¯ä¸€ä¸ª state treeï¼ŒåŒ…æ‹¬äº†æ‰€æœ‰æ¨¡å— state</span></div><div class="token-line"><span class="token comment">       * */</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">const</span><span class="token plain"> previousStateForKey </span><span class="token operator">=</span><span class="token plain"> state</span><span class="token punctuation">[</span><span class="token plain">key</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token comment">/**</span></div><div class="token-line"><span class="token comment">       * The reducer is executed, and the state parameter of the incoming and outgoing state is officially</span></div><div class="token-line"><span class="token comment">       * the state stored last time, and the new state after the calculation will be obtained after the call</span></div><div class="token-line"><span class="token comment">       * æ‰§è¡Œ reducerï¼Œå‡ºå…¥çš„ state å‚æ•°æ­£å¼ä¸Šæ¬¡å­˜å‚¨çš„ stateï¼Œè°ƒç”¨åä¼šè·å¾—è®¡ç®—åæ–°çš„ state</span></div><div class="token-line"><span class="token comment">       * */</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">const</span><span class="token plain"> nextStateForKey </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">reducer</span><span class="token punctuation">(</span><span class="token plain">previousStateForKey</span><span class="token punctuation">,</span><span class="token plain"> action</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token comment">/**</span></div><div class="token-line"><span class="token comment">       * Attach the corresponding module state to the nextState object, and use key as the key</span></div><div class="token-line"><span class="token comment">       * å°†å¯¹åº”æ¨¡å— state æŒ‚åˆ° nextState å¯¹è±¡ä¸Šï¼Œä¸”ä»¥ key ä¸ºé”®</span></div><div class="token-line"><span class="token comment">       * */</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      nextState</span><span class="token punctuation">[</span><span class="token plain">key</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> nextStateForKey</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">/**</span></div><div class="token-line"><span class="token comment">     * Return the merged state</span></div><div class="token-line"><span class="token comment">     * è¿”å›åˆå¹¶åçš„ state</span></div><div class="token-line"><span class="token comment">     * */</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">return</span><span class="token plain"> nextState</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p>æ˜¯ä¸æ˜¯å¾ˆç®€å•ï¼Œä¸è¿‡ä¸è¦é«˜å…´å¾—å¤ªæ—©ï¼Œæ¥ä¸‹æ¥ç¼–å†™å•å…ƒæµ‹è¯•ï¼Œæµ‹è¯•æˆ‘ä»¬çš„è¿™éƒ¨åˆ†åŠŸèƒ½ã€‚æµ‹è¯•ç”¨ä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment">// createStore.test.ts</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token imports punctuation">{</span><span class="token imports"></span></div><div class="token-line"><span class="token imports">  createStore</span><span class="token imports punctuation">,</span><span class="token imports"></span></div><div class="token-line"><span class="token imports">  combineReducer</span><span class="token imports punctuation">,</span><span class="token imports"></span></div><div class="token-line"><span class="token imports"></span><span class="token imports punctuation">}</span><span class="token plain"> </span><span class="token keyword">from</span><span class="token plain"> </span><span class="token string">&#x27;../../src/Advanced/Redux&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&#x27;test redux&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#x27;test combineReducer&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> countInitialState </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      count</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">countReducer</span><span class="token punctuation">(</span><span class="token plain">state </span><span class="token operator">=</span><span class="token plain"> countInitialState</span><span class="token punctuation">,</span><span class="token plain"> action</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">switch</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">action</span><span class="token punctuation">.</span><span class="token keyword">type</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword">case</span><span class="token plain"> </span><span class="token string">&#x27;ADD&#x27;</span><span class="token operator">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token spread operator">...</span><span class="token plain">state</span><span class="token punctuation">,</span><span class="token plain"> count</span><span class="token operator">:</span><span class="token plain"> state</span><span class="token punctuation">.</span><span class="token property-access">count</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword">case</span><span class="token plain"> </span><span class="token string">&#x27;REDUCE&#x27;</span><span class="token operator">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token spread operator">...</span><span class="token plain">state</span><span class="token punctuation">,</span><span class="token plain"> count</span><span class="token operator">:</span><span class="token plain"> state</span><span class="token punctuation">.</span><span class="token property-access">count</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword">default</span><span class="token operator">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token keyword">return</span><span class="token plain"> state</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> numInitialState </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      num</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">numReducer</span><span class="token punctuation">(</span><span class="token plain">state </span><span class="token operator">=</span><span class="token plain"> numInitialState</span><span class="token punctuation">,</span><span class="token plain"> action</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">switch</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">action</span><span class="token punctuation">.</span><span class="token keyword">type</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword">case</span><span class="token plain"> </span><span class="token string">&#x27;PLUS&#x27;</span><span class="token operator">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token spread operator">...</span><span class="token plain">state</span><span class="token punctuation">,</span><span class="token plain"> num</span><span class="token operator">:</span><span class="token plain"> state</span><span class="token punctuation">.</span><span class="token property-access">num</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword">case</span><span class="token plain"> </span><span class="token string">&#x27;CUT&#x27;</span><span class="token operator">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token spread operator">...</span><span class="token plain">state</span><span class="token punctuation">,</span><span class="token plain"> num</span><span class="token operator">:</span><span class="token plain"> state</span><span class="token punctuation">.</span><span class="token property-access">num</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword">default</span><span class="token operator">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token keyword">return</span><span class="token plain"> state</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> reducer </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">combineReducer</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      countState</span><span class="token operator">:</span><span class="token plain"> countReducer</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      numState</span><span class="token operator">:</span><span class="token plain"> numReducer</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> store </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">createStore</span><span class="token punctuation">(</span><span class="token plain">reducer</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    store</span><span class="token punctuation">.</span><span class="token method function property-access">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">store</span><span class="token punctuation">.</span><span class="token method function property-access">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    store</span><span class="token punctuation">.</span><span class="token method function property-access">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token keyword">type</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;ADD&#x27;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token plain">store</span><span class="token punctuation">.</span><span class="token method function property-access">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toHaveProperty</span><span class="token punctuation">(</span><span class="token string">&#x27;countState&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token plain">store</span><span class="token punctuation">.</span><span class="token method function property-access">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toHaveProperty</span><span class="token punctuation">(</span><span class="token string">&#x27;numState&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token plain">store</span><span class="token punctuation">.</span><span class="token method function property-access">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">as</span><span class="token plain"> </span><span class="token builtin">any</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">countState</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> count</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    store</span><span class="token punctuation">.</span><span class="token method function property-access">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token keyword">type</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;CUT&#x27;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token plain">store</span><span class="token punctuation">.</span><span class="token method function property-access">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">as</span><span class="token plain"> </span><span class="token builtin">any</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">numState</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> num</span><span class="token operator">:</span><span class="token plain"> </span><span class="token operator">-</span><span class="token number">1</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p>èµï¼å•å…ƒæµ‹è¯•é€šè¿‡ã€‚</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token builtin class-name">test</span><span class="token plain"> redux</span></div><div class="token-line"><span class="token plain">    âœ“ </span><span class="token builtin class-name">test</span><span class="token plain"> combineReducer </span><span class="token punctuation">(</span><span class="token plain">22ms</span><span class="token punctuation">)</span></div></pre></div><p>åå¤´æ¥çœ‹ Redux ä¸­çš„è¿™ä¸¤ä¸ªæ ¸å¿ƒ apiï¼Œæ˜¯å¦è§‰å¾—å°èœä¸€ç¢Ÿï¼Ÿä»ä¸­æ˜¯å¦å­¦åˆ°äº†å¾ˆå¤šçŸ¥è¯†å‘¢ï¼Ÿæ¯”å¦‚ï¼š</p><ul><li>é—­åŒ…</li><li>è£…é¥°è€…æ¨¡å¼</li></ul><p>è¿™äº›ç¼–ç¨‹æ€æƒ³åœ¨å¦ä¸€ä¸ª api ä¸­å±•ç°å¾—æ›´å½»åº•ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ Redux ä¸­å¦å¤–ä¸€ä¸ªæå…¶é‡è¦çš„æ–¹æ³•â€”â€”applyMiddlewareã€‚</p><h2 id="applymiddleware"><a aria-hidden="true" tabindex="-1" href="/advanced/redux#applymiddleware"><span class="icon icon-link"></span></a>applyMiddleware</h2><p>è¿™ä¸ªå‡½æ•°å¾ˆå¤§ç¨‹åº¦æé«˜äº† Redux çš„æ‹“å±•æ€§ï¼Œä¸­é—´ä»¶ï¼Œé¡¾åæ€ä¹‰æ˜¯åœ¨æŸäº›æ“ä½œçš„å‰æˆ–åå»è¿›è¡Œä¸€äº›é¢å¤–æ“ä½œï¼Œè¿™å…¶å®å°±æ˜¯äººä»¬å¸¸è¯´çš„ AOPã€‚Redux å…è®¸ä½ è‡ªå®šä¹‰ä¸€äº›ä¸­é—´ä»¶ï¼Œä»è€Œæ‹“å±• Redux çš„èƒ½åŠ›ï¼Œæ¯”å¦‚æˆ‘ä»¬å¸Œæœ›åœ¨ Redux ä¸­æ¯æ¬¡ state å˜åŒ–å‰åï¼Œéƒ½èƒ½æ‰“å°ç›¸å…³æ—¥å¿—ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å®šä¹‰ä¸€ä¸ª<strong>æ—¥å¿—ä¸­é—´ä»¶</strong>ï¼Œè¿™ä¸ªä¸­é—´ä»¶çš„å®šä¹‰å¾ˆç®€å•ï¼Œæˆ‘ä»¬ç›´æ¥ä¸Šä»£ç ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">logger</span><span class="token punctuation">(</span><span class="token plain">store</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token plain">next</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token plain">action</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">group</span><span class="token punctuation">(</span><span class="token plain">action</span><span class="token punctuation">.</span><span class="token keyword">type</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">info</span><span class="token punctuation">(</span><span class="token string">&#x27;dispatching logger&#x27;</span><span class="token punctuation">,</span><span class="token plain"> action</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">let</span><span class="token plain"> result </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">next</span><span class="token punctuation">(</span><span class="token plain">action</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&#x27;next state&#x27;</span><span class="token punctuation">,</span><span class="token plain"> store</span><span class="token punctuation">.</span><span class="token method function property-access">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">groupEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">return</span><span class="token plain"> result</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p>å¤§å®¶è¿˜è®°å¾—å‡½æ•°æŸ¯é‡ŒåŒ–å—ï¼Ÿè¿™é‡Œä½¿ç”¨å‡½æ•°æŸ¯é‡ŒåŒ–æ˜¯ä¸ºäº†åœ¨ä¸åŒçš„å‡½æ•°æ‰§è¡Œæ—¶ï¼Œå¾—åˆ°å¯¹åº”è¿”å›å€¼ï¼Œç„¶åæä¾›ç»™åç»­å‡½æ•°ä½¿ç”¨ã€‚ä»ä¸Šé¢å‡½æ•°çš„å®šä¹‰æ–¹å¼æˆ‘ä»¬å¯ä»¥çŒœæµ‹ï¼Œå‡½æ•°ä¸€å±‚å±‚åµŒå¥—æœ€ç»ˆéœ€è¦ä¸€å±‚å±‚è°ƒç”¨ä»è€Œè·å¾—æœ€ç»ˆå€¼ã€‚å…¶å®ï¼Œæˆ‘ä»¬ä¸å¦¨çŒœæƒ³ä¸­é—´ä»¶çš„ä½œç”¨å°±æ˜¯ä¸ºäº†å¼ºåŒ– dispatch èƒ½åŠ›ï¼Œå°±åƒä¸Šé¢ä»£ç ç‰‡æ®µï¼Œæˆ‘ä»¬å‘ç° <code>next(action)</code> è¿™æ®µä»£ç ï¼Œè¿”å›å€¼ result ä¾¿æ˜¯ç”Ÿæˆåçš„ storeï¼Œè¿™é‡Œæˆ‘ä»¬ä¸å…ä¼šç–‘æƒ‘ï¼Œä¸æ˜¯ä¿®æ”¹ state çŠ¶æ€åªèƒ½é€šè¿‡ dispatch å—ï¼Ÿè¿™é‡Œæ˜¯æ€ä¹ˆå›äº‹å‘¢ï¼Ÿæˆ‘ä»¬å¤§èƒ†çŒœæƒ³ï¼Œè¿™é‡Œçš„ next å‡½æ•°å…¶å®å°±æ˜¯ dispatch æŠ«äº†ä¸€ä»¶å¤–è¡£ï¼Œæœ¬è´¨è¿˜æ˜¯ dispatchã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å†çœ‹å¦‚ä½•ä½¿ç”¨ä¸­é—´ä»¶ï¼ŒRedux ä¸­é—´ä»¶çš„ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token imports punctuation">{</span><span class="token imports"> createStore</span><span class="token imports punctuation">,</span><span class="token imports"> applyMiddleware </span><span class="token imports punctuation">}</span><span class="token plain"> </span><span class="token keyword">from</span><span class="token plain"> </span><span class="token string">&#x27;redux&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">reducer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// ä½¿ç”¨å¦‚ä¸Šå®šä¹‰çš„ loggerï¼Œè¿™é‡Œä¸é¢å¤–å®šä¹‰äº†</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> store </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">createStore</span><span class="token punctuation">(</span><span class="token plain">reducer</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token function">applyMiddleware</span><span class="token punctuation">(</span><span class="token plain">logger</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>æˆ‘ä»¬è¿˜çŸ¥é“ï¼Œç¬¬ä¸€æ¬¡è°ƒç”¨ logger éœ€è¦åœ¨ applyMiddleware å‡½æ•°ä¸­ä¸ºå…¶ä¼ å…¥åˆå§‹åŒ–çš„ storeã€‚ç¬¬äºŒæ¬¡è°ƒç”¨ logger è°ƒç”¨åè¿”å›çš„å‡½æ•°ä¸”ä»¥ dispatch ä½œä¸ºå‚æ•°ã€‚è¿˜å‰©ä¸‹æœ€å†…å±‚ï¼Œé‚£ä¾¿æ˜¯ä¿®é¥° dispatch çš„å‡½æ•°ã€‚åˆ†æå¾—å‡ºè¿™äº›è¦ç‚¹ä¹‹åï¼Œæˆ‘ä»¬ä»æ”¹é€  createStore å‡½æ•°å¼€å§‹ï¼ŒcreateStore å‡½æ•°æ–°å¢ä¸€ä¸ªå‚æ•°ï¼Œè¿™ä¸ªå‚æ•°çš„åå­—ä¸ºâ€œenhancerâ€ï¼Œé¡¾åæ€ä¹‰å¢å¼ºå™¨ï¼Œå¯¹åº”çš„æ­£æ˜¯ applyMiddleware å‡½æ•°ï¼Œè¯¥å‡½æ•°è¿ç»­è°ƒç”¨äº†ä¸¤æ¬¡ï¼Œç¬¬ä¸€æ¬¡è°ƒç”¨ä¼ å…¥ createStoreï¼Œç¬¬äºŒæ¬¡è°ƒç”¨ä¼ å…¥äº† reducerï¼Œå…·ä½“å®ç°å¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token imports punctuation">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">Store</span><span class="token imports punctuation">,</span><span class="token imports"> </span><span class="token imports maybe-class-name">StoreEnhancer</span><span class="token imports punctuation">,</span><span class="token imports"> </span><span class="token imports maybe-class-name">StoreEnhancerStoreCreator</span><span class="token imports"> </span><span class="token imports punctuation">}</span><span class="token plain"> </span><span class="token keyword">from</span><span class="token plain"> </span><span class="token string">&#x27;./types/store&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token imports punctuation">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">Action</span><span class="token imports"> </span><span class="token imports punctuation">}</span><span class="token plain"> </span><span class="token keyword">from</span><span class="token plain"> </span><span class="token string">&#x27;./types/actions&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token imports punctuation">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">Reducer</span><span class="token imports"> </span><span class="token imports punctuation">}</span><span class="token plain"> </span><span class="token keyword">from</span><span class="token plain"> </span><span class="token string">&#x27;./types/reducers&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">export</span><span class="token plain"> </span><span class="token keyword">default</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token generic-function function">createStore</span><span class="token generic-function generic class-name operator">&lt;</span><span class="token generic-function generic class-name"></span></div><div class="token-line"><span class="token generic-function generic class-name">  </span><span class="token generic-function generic class-name constant">S</span><span class="token generic-function generic class-name punctuation">,</span><span class="token generic-function generic class-name"></span></div><div class="token-line"><span class="token generic-function generic class-name">  </span><span class="token generic-function generic class-name constant">A</span><span class="token generic-function generic class-name"> </span><span class="token generic-function generic class-name keyword">extends</span><span class="token generic-function generic class-name"> </span><span class="token generic-function generic class-name maybe-class-name">Action</span><span class="token generic-function generic class-name punctuation">,</span><span class="token generic-function generic class-name"></span></div><div class="token-line"><span class="token generic-function generic class-name">  </span><span class="token generic-function generic class-name maybe-class-name">Ext</span><span class="token generic-function generic class-name"> </span><span class="token generic-function generic class-name operator">=</span><span class="token generic-function generic class-name"> </span><span class="token generic-function generic class-name punctuation">{</span><span class="token generic-function generic class-name punctuation">}</span><span class="token generic-function generic class-name punctuation">,</span><span class="token generic-function generic class-name"></span></div><div class="token-line"><span class="token generic-function generic class-name">  </span><span class="token generic-function generic class-name maybe-class-name">StateExt</span><span class="token generic-function generic class-name"> </span><span class="token generic-function generic class-name operator">=</span><span class="token generic-function generic class-name"> </span><span class="token generic-function generic class-name builtin">never</span><span class="token generic-function generic class-name"></span></div><div class="token-line"><span class="token generic-function generic class-name"></span><span class="token generic-function generic class-name operator">&gt;</span><span class="token punctuation">(</span><span class="token plain">reducer</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">Reducer</span><span class="token punctuation">,</span><span class="token plain"> enhancer</span><span class="token operator">?</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">StoreEnhancer</span><span class="token operator">&lt;</span><span class="token maybe-class-name">Ext</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token maybe-class-name">StateExt</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">Store</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">/**</span></div><div class="token-line"><span class="token comment">   * Determines whether enhancer exists, if so, calls enhancer and returns</span></div><div class="token-line"><span class="token comment">   * åˆ¤æ–­æ˜¯å¦å­˜åœ¨ enhancerï¼Œè‹¥å­˜åœ¨åˆ™è°ƒç”¨ enhancer å¹¶è¿”å›</span></div><div class="token-line"><span class="token comment">   * */</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token plain"> enhancer </span><span class="token operator">!==</span><span class="token plain"> </span><span class="token string">&#x27;undefined&#x27;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token plain"> enhancer </span><span class="token operator">!==</span><span class="token plain"> </span><span class="token string">&#x27;function&#x27;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">throw</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name known-class-name class-name">Error</span><span class="token punctuation">(</span><span class="token string">&#x27;Expected the enhancer to be a function.&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token function">enhancer</span><span class="token punctuation">(</span><span class="token plain">createStore </span><span class="token keyword">as</span><span class="token plain"> </span><span class="token maybe-class-name">StoreEnhancerStoreCreator</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">reducer</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">as</span><span class="token plain"> </span><span class="token maybe-class-name">Store</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">let</span><span class="token plain"> state</span><span class="token operator">:</span><span class="token plain"> </span><span class="token constant">S</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> nextListeners</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token function-variable function">listener</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    nextListeners</span><span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="token plain">listener</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">return</span><span class="token plain"> state</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token plain">action</span><span class="token operator">:</span><span class="token plain"> </span><span class="token constant">A</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    state </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">reducer</span><span class="token punctuation">(</span><span class="token plain">state</span><span class="token punctuation">,</span><span class="token plain"> action</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token keyword">let</span><span class="token plain"> i </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">,</span><span class="token plain"> len </span><span class="token operator">=</span><span class="token plain"> nextListeners</span><span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">;</span><span class="token plain"> i </span><span class="token operator">&lt;</span><span class="token plain"> len</span><span class="token punctuation">;</span><span class="token plain"> i</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      nextListeners</span><span class="token punctuation">[</span><span class="token plain">i</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    subscribe</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    getState</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    dispatch</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">as</span><span class="token plain"> </span><span class="token maybe-class-name">Store</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p>è¿™é‡Œå®ç°æ€è·¯ä¸å¤æ‚ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹ applyMiddleware å®ç°ï¼Œæ—¢ç„¶ enhancer ç»å†äº†ä¸¤æ¬¡è°ƒç”¨ï¼Œé‚£ä¹ˆ applyMiddleware å‡½æ•°ä¹Ÿéœ€è¦é€šè¿‡å‡½æ•°æŸ¯é‡ŒåŒ–å®ç°é€å±‚è°ƒç”¨ä»è€Œå®Œæˆå‚æ•°ä¼ é€’ã€‚åˆ†æåˆ°è¿™å„¿ï¼Œæˆ‘ä»¬å…ˆå®ç°ä¸€éƒ¨åˆ† applyMiddleware å‡½æ•°ä»£ç ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment">// applyMiddleware.ts</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">export</span><span class="token plain"> </span><span class="token keyword">default</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">applyMiddleware</span><span class="token punctuation">(</span><span class="token plain">middleware</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">createStore</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">reducer</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">let</span><span class="token plain"> newStore </span><span class="token operator">=</span><span class="token plain"> </span><span class="token comment">// ...</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">return</span><span class="token plain"> newStore</span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p>æ—¢ç„¶è¦å°è£… dispatchï¼Œå¹¶æœ€ç»ˆè¿”å›æ–°çš„ storeï¼Œå°±éœ€è¦å°†åˆå§‹ store å’Œ dispatch è§£æ„å¹¶ç»„è£…ã€‚æˆ‘ä»¬ä¿®æ”¹ä»¥ä¸Šä»£ç ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">export</span><span class="token plain"> </span><span class="token keyword">default</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">applyMiddleware</span><span class="token punctuation">(</span><span class="token plain">middleware</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">return</span><span class="token plain"> createStore </span><span class="token arrow operator">=&gt;</span><span class="token plain"> reducer </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">/**</span></div><div class="token-line"><span class="token comment">     * Initialize the store, which is the original store</span></div><div class="token-line"><span class="token comment">     * åˆå§‹åŒ– storeï¼Œä¹Ÿå°±æ˜¯åŸå§‹ store</span></div><div class="token-line"><span class="token comment">     * */</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> store </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">createStore</span><span class="token punctuation">(</span><span class="token plain">reducer</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">/**</span></div><div class="token-line"><span class="token comment">     * Execute middleware and pass the store obtained above as a parameter</span></div><div class="token-line"><span class="token comment">     * æ‰§è¡Œ middlewareï¼Œå°†ä¸Šé¢å¾—åˆ°çš„ store ä½œä¸ºå‚æ•°ä¼ å…¥</span></div><div class="token-line"><span class="token comment">     * */</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> fn </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">middleware</span><span class="token punctuation">(</span><span class="token plain">store</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">/**</span></div><div class="token-line"><span class="token comment">     * Get dispatch in the initial store</span></div><div class="token-line"><span class="token comment">     * è·å–åˆå§‹ store ä¸­çš„ dispatch</span></div><div class="token-line"><span class="token comment">     * */</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> dispatch </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> store</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">/**</span></div><div class="token-line"><span class="token comment">     * Pass in the dispatch in the initial store and return a new enhanced version of dispatch</span></div><div class="token-line"><span class="token comment">     * å°†åˆå§‹ store ä¸­çš„ dispatch ä¼ å…¥ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„åŠ å¼ºç‰ˆ dispatch</span></div><div class="token-line"><span class="token comment">     * */</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> enhancedDispatch </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token plain">dispatch</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">/**</span></div><div class="token-line"><span class="token comment">     * Return to the new store, where dispatch has been replaced with an enhanced version of dispatch</span></div><div class="token-line"><span class="token comment">     * è¿”å›æ–°çš„ storeï¼Œå…¶ä¸­ dispatch å·²æ›¿æ¢ä¸ºåŠ å¼ºç‰ˆçš„ dispatch</span></div><div class="token-line"><span class="token comment">     * */</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token spread operator">...</span><span class="token plain">store</span><span class="token punctuation">,</span><span class="token plain"> dispatch</span><span class="token operator">:</span><span class="token plain"> enhancedDispatch </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p>åŸºç¡€ç‰ˆæœ¬ applyMiddleware å·²å®Œæˆï¼Œæˆ‘ä»¬ç¼–å†™æµ‹è¯•ä»£ç è¿›è¡Œæµ‹è¯•ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#x27;test middleware basic usage&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> initialState </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    count</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">reducer</span><span class="token punctuation">(</span><span class="token plain">state </span><span class="token operator">=</span><span class="token plain"> initialState</span><span class="token punctuation">,</span><span class="token plain"> action</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">switch</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">action</span><span class="token punctuation">.</span><span class="token keyword">type</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">case</span><span class="token plain"> </span><span class="token string">&#x27;ADD&#x27;</span><span class="token operator">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token spread operator">...</span><span class="token plain">state</span><span class="token punctuation">,</span><span class="token plain"> count</span><span class="token operator">:</span><span class="token plain"> state</span><span class="token punctuation">.</span><span class="token property-access">count</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">case</span><span class="token plain"> </span><span class="token string">&#x27;REDUCE&#x27;</span><span class="token operator">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token spread operator">...</span><span class="token plain">state</span><span class="token punctuation">,</span><span class="token plain"> count</span><span class="token operator">:</span><span class="token plain"> state</span><span class="token punctuation">.</span><span class="token property-access">count</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">default</span><span class="token operator">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword">break</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">logger</span><span class="token punctuation">(</span><span class="token plain">store</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token plain">next</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token plain">action</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">group</span><span class="token punctuation">(</span><span class="token plain">action</span><span class="token punctuation">.</span><span class="token keyword">type</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">info</span><span class="token punctuation">(</span><span class="token string">&#x27;dispatching logger&#x27;</span><span class="token punctuation">,</span><span class="token plain"> action</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword">let</span><span class="token plain"> result </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">next</span><span class="token punctuation">(</span><span class="token plain">action</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&#x27;next state&#x27;</span><span class="token punctuation">,</span><span class="token plain"> store</span><span class="token punctuation">.</span><span class="token method function property-access">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">groupEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword">return</span><span class="token plain"> result</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> store </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">createStore</span><span class="token punctuation">(</span><span class="token plain">reducer</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token function">applyMiddleware</span><span class="token punctuation">(</span><span class="token plain">logger</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  store</span><span class="token punctuation">.</span><span class="token method function property-access">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token keyword">type</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;ADD&#x27;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token plain">store</span><span class="token punctuation">.</span><span class="token method function property-access">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> count</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>æ‰§è¡Œæµ‹è¯•ï¼Œç”¨ä¾‹é€šè¿‡ï¼Œè¯´æ˜æˆ‘ä»¬ç¼–å†™çš„ applyMiddleware æ— è¯¯ï¼Œä½†æˆ‘ä»¬æ³¨æ„åˆ°ä¸€ç‚¹ï¼ŒRedux å®˜æ–¹çš„ applyMiddleware æ–¹æ³•æ˜¯æ”¯æŒä¼ å…¥å¤šä¸ªä¸­é—´ä»¶å‡½æ•°çš„ï¼Œå¹¶ä¸”å„ä¸ªå‡½æ•°çš„æ‰§è¡Œé¡ºåºä¸ºä¸€æ¬¡è¿›å‡ºï¼Œå‘ˆç°ç»å…¸çš„<strong>æ´‹è‘±æ¨¡å‹</strong>ã€‚æˆ‘ä»¬éœ€è¦æ”¹é€ ä¸€ä¸‹ applyMiddleware å‡½æ•°ï¼Œè®©å…¶å¯ä»¥æ‰§è¡Œä¼ å…¥çš„å¤šä¸ªä¸­é—´ä»¶å‡½æ•°ã€‚ æ”¹é€  applyMiddleware å‡½æ•°ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦è®²è§£ä¸€ä¸ªéå¸¸é‡è¦çš„å‡½æ•°ï¼Œè¯¥å‡½æ•°åœ¨å¼€å‘ä¸­æˆ–è€…æ˜¯é¢è¯•ä¸­éƒ½ç»å¸¸è¢«é—®åŠï¼Œé‚£å°±æ˜¯ <strong>compose</strong>ã€‚è¯¥å‡½æ•°çš„åŠŸèƒ½æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä»¬ä¸¾ä¸€ä¸ªç®€å•ä¾‹å­ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">logger1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">logger2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token punctuation">}</span></div></pre></div><p>æ—¢ç„¶æˆ‘ä»¬æœ€ç»ˆæœŸæœ› logger1 å’Œ logger2 æ‰§è¡Œé¡ºåºå‘ˆç°<strong>æ´‹è‘±æ¨¡å‹</strong>ï¼Œé‚£ä¹ˆåº”è¯¥è¿™æ ·æ‰§è¡Œï¼Œæˆ‘ä»¬æ‰‹åŠ¨æ¨¡æ‹Ÿä¸€ä¸‹ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token function">logger1</span><span class="token punctuation">(</span><span class="token function">logger2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>æ˜¯ä¸æ˜¯æ˜ç™½äº†ï¼Ÿå¥½ï¼Œæˆ‘ä»¬åœ¨çœ‹åˆ° applyMiddlewareï¼Œæˆ‘ä»¬çŸ¥é“å¤šä¸ªä¸­é—´ä»¶æ˜¯ä½œä¸ºå‚æ•°ä¼ é€’è¿› applyMiddleware å‡½æ•°çš„ï¼Œæ—¢ç„¶è¿™æ ·ï¼Œæˆ‘ä»¬é¦–å…ˆè¦å°†å‚æ•°è§£æ„ä¸ºæ•°ç»„æ‰å¥½è¿›è¡Œæ“ä½œï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">applyMiddleware</span><span class="token punctuation">(</span><span class="token spread operator">...</span><span class="token plain">middlewares</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token punctuation">}</span></div></pre></div><p>è¿™æ ·å°±å¾—åˆ°äº†ä¸­é—´ä»¶æ•°ç»„ï¼Œæ¥ä¸‹æ¥ï¼Œè¿™äº›æ•°ç»„éœ€è¦é€å±‚åŒ…è£¹å¹¶è°ƒç”¨ï¼Œè¿™è®©æˆ‘ä»¬è”æƒ³åˆ°äº†æ•°ç»„çš„ reduce æ–¹æ³•ï¼Œè¯¥æ–¹æ³•åˆšå¥½æ»¡è¶³æ•°ç»„å‰åå…ƒç´ åœ¨éå†è¿‡ç¨‹ä¸­æ„æˆè”ç³»ã€‚è€ƒè™‘åˆ°è¿™é‡Œï¼Œé—®é¢˜ä¼¼ä¹è¿åˆƒè€Œè§£ï¼Œæˆ‘ä»¬å…ˆæ¥å®šä¹‰ compose å‡½æ•°ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">export</span><span class="token plain"> </span><span class="token keyword">default</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">compose</span><span class="token punctuation">(</span><span class="token spread operator">...</span><span class="token plain">funcs</span><span class="token operator">:</span><span class="token plain"> </span><span class="token known-class-name class-name">Function</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">return</span><span class="token plain"> funcs</span><span class="token punctuation">.</span><span class="token method function property-access">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token plain">a</span><span class="token punctuation">,</span><span class="token plain"> b</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token spread operator">...</span><span class="token plain">args</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">any</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token function">a</span><span class="token punctuation">(</span><span class="token function">b</span><span class="token punctuation">(</span><span class="token spread operator">...</span><span class="token plain">args</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p>ä»è¿™é‡Œå°±èƒ½æ¸…æ™°çœ‹åˆ°ï¼Œä¼ å…¥çš„å‡½æ•°æ•°ç»„ä¼šè¿›è¿‡ reduce æ–¹æ³•ä½¿æ¯ä¸ªå‡½æ•°åŒ…è£¹ï¼ŒåŒæ—¶è¿”å›çš„æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°æ¥æ”¶ä¸€äº›å‚æ•°ï¼Œè¿™é‡Œå…¶å®æ˜¯ åŠ å¼ºåçš„ dispatchã€‚</p><p>é‚£ä¹ˆæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¼ºåŒ– applyMiddleware å‡½æ•°ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token imports punctuation">{</span><span class="token imports"> compose </span><span class="token imports punctuation">}</span><span class="token plain"> </span><span class="token keyword">from</span><span class="token plain"> </span><span class="token string">&#x27;./compose&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">applyMiddleware</span><span class="token punctuation">(</span><span class="token spread operator">...</span><span class="token plain">middlewares</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> store </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"> </span><span class="token comment">// ...</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> middlewareChain </span><span class="token operator">=</span><span class="token plain"> middlewares</span><span class="token punctuation">.</span><span class="token method function property-access">reduce</span><span class="token punctuation">(</span><span class="token plain">middleware </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token function">middleware</span><span class="token punctuation">(</span><span class="token plain">store</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">/**</span></div><div class="token-line"><span class="token comment">   * Traversing the middlewareChain, nesting all functions within it one layer at a time,</span></div><div class="token-line"><span class="token comment">   * and finally returning the result of execution</span></div><div class="token-line"><span class="token comment">   * éå† middlewareChainï¼Œå°†å…¶ä¸­æ‰€æœ‰å‡½æ•°ä¸€å±‚å±‚åµŒå¥—è°ƒç”¨ï¼Œå¹¶æœ€ç»ˆè¿”å›æ‰§è¡Œç»“æœ</span></div><div class="token-line"><span class="token comment">   * */</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> dispatch </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">compose</span><span class="token punctuation">(</span><span class="token spread operator">...</span><span class="token plain">middlewareChain</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">store</span><span class="token punctuation">.</span><span class="token property-access">dispatch</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token spread operator">...</span><span class="token plain">store</span><span class="token punctuation">,</span><span class="token plain"> dispatch </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p>å®Œæ•´ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token imports punctuation">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">AnyAction</span><span class="token imports"> </span><span class="token imports punctuation">}</span><span class="token plain"> </span><span class="token keyword">from</span><span class="token plain"> </span><span class="token string">&#x27;./types/actions&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token imports punctuation">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">Reducer</span><span class="token imports"> </span><span class="token imports punctuation">}</span><span class="token plain"> </span><span class="token keyword">from</span><span class="token plain"> </span><span class="token string">&#x27;./types/reducers&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token imports punctuation">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">Middleware</span><span class="token imports punctuation">,</span><span class="token imports"> </span><span class="token imports maybe-class-name">MiddlewareAPI</span><span class="token imports"> </span><span class="token imports punctuation">}</span><span class="token plain"> </span><span class="token keyword">from</span><span class="token plain"> </span><span class="token string">&#x27;./types/middleware&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token imports punctuation">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">Dispatch</span><span class="token imports punctuation">,</span><span class="token imports"> </span><span class="token imports maybe-class-name">StoreEnhancerStoreCreator</span><span class="token imports"> </span><span class="token imports punctuation">}</span><span class="token plain"> </span><span class="token keyword">from</span><span class="token plain"> </span><span class="token string">&#x27;./types/store&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token imports">compose</span><span class="token plain"> </span><span class="token keyword">from</span><span class="token plain"> </span><span class="token string">&#x27;./compose&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">export</span><span class="token plain"> </span><span class="token keyword">default</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">applyMiddleware</span><span class="token punctuation">(</span><span class="token spread operator">...</span><span class="token plain">middlewares</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">Middleware</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">createStore</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">StoreEnhancerStoreCreator</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token constant">S</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token constant">A</span><span class="token plain"> </span><span class="token keyword">extends</span><span class="token plain"> </span><span class="token class-name maybe-class-name">AnyAction</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    reducer</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">Reducer</span><span class="token operator">&lt;</span><span class="token constant">S</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> store </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">createStore</span><span class="token punctuation">(</span><span class="token plain">reducer</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">let</span><span class="token plain"> dispatch</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">Dispatch</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> middlewareAPI</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">MiddlewareAPI</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      getState</span><span class="token operator">:</span><span class="token plain"> store</span><span class="token punctuation">.</span><span class="token property-access">getState</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token function-variable function">dispatch</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">action</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token spread operator">...</span><span class="token plain">args</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token plain">action</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token spread operator">...</span><span class="token plain">args</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> chain </span><span class="token operator">=</span><span class="token plain"> middlewares</span><span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token plain">middleware </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token function">middleware</span><span class="token punctuation">(</span><span class="token plain">middlewareAPI</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    dispatch </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">compose</span><span class="token punctuation">(</span><span class="token spread operator">...</span><span class="token plain">chain</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">store</span><span class="token punctuation">.</span><span class="token property-access">dispatch</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token spread operator">...</span><span class="token plain">store</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      dispatch</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p>åˆ«å¿˜äº†ç¼–å†™æµ‹è¯•ç”¨ä¾‹ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#x27;test middleware basic usage&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> initialState </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    count</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">reducer</span><span class="token punctuation">(</span><span class="token plain">state </span><span class="token operator">=</span><span class="token plain"> initialState</span><span class="token punctuation">,</span><span class="token plain"> action</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">switch</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">action</span><span class="token punctuation">.</span><span class="token keyword">type</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">case</span><span class="token plain"> </span><span class="token string">&#x27;ADD&#x27;</span><span class="token operator">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token spread operator">...</span><span class="token plain">state</span><span class="token punctuation">,</span><span class="token plain"> count</span><span class="token operator">:</span><span class="token plain"> state</span><span class="token punctuation">.</span><span class="token property-access">count</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">case</span><span class="token plain"> </span><span class="token string">&#x27;REDUCE&#x27;</span><span class="token operator">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token spread operator">...</span><span class="token plain">state</span><span class="token punctuation">,</span><span class="token plain"> count</span><span class="token operator">:</span><span class="token plain"> state</span><span class="token punctuation">.</span><span class="token property-access">count</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">default</span><span class="token operator">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword">break</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">logger1</span><span class="token punctuation">(</span><span class="token plain">store</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token plain">next</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token plain">action</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">group</span><span class="token punctuation">(</span><span class="token plain">action</span><span class="token punctuation">.</span><span class="token keyword">type</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">info</span><span class="token punctuation">(</span><span class="token string">&#x27;dispatching logger111&#x27;</span><span class="token punctuation">,</span><span class="token plain"> action</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword">let</span><span class="token plain"> result </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">next</span><span class="token punctuation">(</span><span class="token plain">action</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&#x27;next state 111&#x27;</span><span class="token punctuation">,</span><span class="token plain"> store</span><span class="token punctuation">.</span><span class="token method function property-access">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">groupEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword">return</span><span class="token plain"> result</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">logger2</span><span class="token punctuation">(</span><span class="token plain">store</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token plain">next</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token plain">action</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">group</span><span class="token punctuation">(</span><span class="token plain">action</span><span class="token punctuation">.</span><span class="token keyword">type</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">info</span><span class="token punctuation">(</span><span class="token string">&#x27;dispatching logger222&#x27;</span><span class="token punctuation">,</span><span class="token plain"> action</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword">let</span><span class="token plain"> result </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">next</span><span class="token punctuation">(</span><span class="token plain">action</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&#x27;next state 222&#x27;</span><span class="token punctuation">,</span><span class="token plain"> store</span><span class="token punctuation">.</span><span class="token method function property-access">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">groupEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword">return</span><span class="token plain"> result</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> store </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">createStore</span><span class="token punctuation">(</span><span class="token plain">reducer</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token function">applyMiddleware</span><span class="token punctuation">(</span><span class="token plain">logger1</span><span class="token punctuation">,</span><span class="token plain"> logger2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  store</span><span class="token punctuation">.</span><span class="token method function property-access">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token keyword">type</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;ADD&#x27;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token plain">store</span><span class="token punctuation">.</span><span class="token method function property-access">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> count</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  store</span><span class="token punctuation">.</span><span class="token method function property-access">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token keyword">type</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;REDUCE&#x27;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token plain">store</span><span class="token punctuation">.</span><span class="token method function property-access">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> count</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>æ‰§è¡Œæµ‹è¯•ï¼Œæµ‹è¯•é€šè¿‡ï¼Œè¯´æ˜æˆ‘ä»¬å®šä¹‰çš„ applyMiddleware æ— è¯¯ã€‚</p><h2 id="æ€»ç»“"><a aria-hidden="true" tabindex="-1" href="/advanced/redux#æ€»ç»“"><span class="icon icon-link"></span></a>æ€»ç»“</h2><ul><li>Redux å‘å¸ƒè®¢é˜…æ¨¡å¼å®ç°</li><li>combineReducerã€applyMiddleware æ–¹æ³•çš„å®ç°å‡ä½¿ç”¨åˆ°äº†å‡½æ•°æŸ¯é‡ŒåŒ–ï¼Œé€šè¿‡å‡½æ•°æŸ¯é‡ŒåŒ–å®ç°å‚æ•°ä¼ é€’ä»¥åŠä½œç”¨åŸŸéš”ç¦»</li><li>åº”ç”¨ä¸­çš„çŠ¶æ€å˜åŒ–ï¼Œåªèƒ½é€šè¿‡è§¦å‘ actionï¼Œä»è€Œæ‰§è¡Œå¯¹åº” reducer æ›´æ–°çŠ¶æ€ï¼Œé€šè¿‡æºç æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæ¯æ¬¡ dispatch éƒ½æ‰§è¡Œäº† reducer å¹¶å°†è¿”å›å€¼èµ‹å€¼ç»™äº† state è¿›è¡Œå­˜å‚¨</li><li>Redux æ”¯æŒä½¿ç”¨ä¸­é—´ä»¶çš„æ–¹å¼æ‹“å±• Redux èƒ½åŠ›ï¼Œä¸­é—´ä»¶æ˜¯ä¸€ä¸ªè£…é¥°è€…æ¨¡å¼å®ç°ï¼Œä¼ å…¥å½“å‰ dispatchï¼Œç»è¿‡ä¸­é—´ä»¶ä¼šè¿”å›ä¸€ä¸ªå¢å¼ºç‰ˆ dispatch</li></ul></div><div class="__dumi-default-layout-footer-meta"><span data-updated-text="æœ€åæ›´æ–°æ—¶é—´ï¼š">7/3/2021 04:32:32</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script src="/umi.js"></script>
  </body>
</html>
