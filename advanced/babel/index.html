<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link
      rel="shortcut icon"
      type="image/x-icon"
      href="https://walker-markdown.oss-cn-shenzhen.aliyuncs.com/uPic/enhanfe.png"
    />
    <link rel="stylesheet" href="/enhanfe/umi.css" />
    <script>
      window.routerBase = "/enhanfe/";
    </script>
    <script>
      //! umi version: 3.5.2
    </script>
    <script>
      !(function () {
        var e = localStorage.getItem("dumi:prefers-color"),
          t = window.matchMedia("(prefers-color-scheme: dark)").matches,
          r = ["light", "dark", "auto"];
        document.documentElement.setAttribute(
          "data-prefers-color",
          e === r[2] ? (t ? r[1] : r[0]) : r.includes(e) ? e : r[0]
        );
      })();
    </script>
    <title>Babel æµ…æ</title>
  </head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-route="/advanced/babel" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" style="background-image:url(&#x27;https://walker-markdown.oss-cn-shenzhen.aliyuncs.com/uPic/enhanfe.png&#x27;)" href="/enhanfe//">Enhanfe</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><span><a href="/enhanfe//basic">ğŸ’Š åŸºç¡€</a></span><span><a aria-current="page" class="active" href="/enhanfe//advanced">ğŸ”¥ è¿›é˜¶</a></span><span><a href="/enhanfe//algorithms">ğŸ¦ æ•°æ®ç»“æ„ä¸ç®—æ³•</a></span><span><a target="_blank" rel="noopener noreferrer" href="https://github.com/HeyiMaster/enhanfe">â­ï¸Â Â GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></span><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "></div></div></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;https://walker-markdown.oss-cn-shenzhen.aliyuncs.com/uPic/enhanfe.png&#x27;)" href="/enhanfe//"></a><h1>Enhanfe</h1><p></p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li><a href="/enhanfe//basic">ğŸ’Š åŸºç¡€</a></li><li><a aria-current="page" class="active" href="/enhanfe//advanced">ğŸ”¥ è¿›é˜¶</a></li><li><a href="/enhanfe//algorithms">ğŸ¦ æ•°æ®ç»“æ„ä¸ç®—æ³•</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://github.com/HeyiMaster/enhanfe">â­ï¸Â Â GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "><button title="Dark theme" class="__dumi-default-dark-moon "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3854" width="22" height="22"><path d="M991.816611 674.909091a69.166545 69.166545 0 0 0-51.665455-23.272727 70.795636 70.795636 0 0 0-27.438545 5.585454A415.674182 415.674182 0 0 1 754.993338 698.181818c-209.594182 0-393.472-184.785455-393.472-395.636363 0-52.363636 38.539636-119.621818 69.515637-173.614546 4.887273-8.610909 9.634909-16.756364 14.103272-24.901818A69.818182 69.818182 0 0 0 384.631156 0a70.842182 70.842182 0 0 0-27.438545 5.585455C161.678429 90.298182 14.362065 307.898182 14.362065 512c0 282.298182 238.824727 512 532.38691 512a522.286545 522.286545 0 0 0 453.957818-268.334545A69.818182 69.818182 0 0 0 991.816611 674.909091zM546.679156 954.181818c-248.785455 0-462.941091-192-462.941091-442.181818 0-186.647273 140.637091-372.829091 300.939637-442.181818-36.817455 65.629091-92.578909 151.970909-92.578909 232.727273 0 250.181818 214.109091 465.454545 462.917818 465.454545a488.331636 488.331636 0 0 0 185.181091-46.545455 453.003636 453.003636 0 0 1-393.565091 232.727273z m103.656728-669.323636l-14.266182 83.781818a34.909091 34.909091 0 0 0 50.362182 36.770909l74.775272-39.563636 74.752 39.563636a36.142545 36.142545 0 0 0 16.174546 3.956364 34.909091 34.909091 0 0 0 34.210909-40.727273l-14.289455-83.781818 60.509091-59.345455a35.025455 35.025455 0 0 0-19.223272-59.578182l-83.61891-12.101818-37.376-76.101818a34.56 34.56 0 0 0-62.254545 0l-37.376 76.101818-83.618909 12.101818a34.909091 34.909091 0 0 0-19.246546 59.578182z m70.423272-64.698182a34.280727 34.280727 0 0 0 26.135273-19.083636l14.312727-29.090909 14.336 29.090909a34.257455 34.257455 0 0 0 26.135273 19.083636l32.046546 4.887273-23.272728 22.574545a35.234909 35.234909 0 0 0-10.007272 30.952727l5.46909 32.116364-28.625454-15.127273a34.490182 34.490182 0 0 0-32.302546 0l-28.695272 15.127273 5.469091-32.116364a35.141818 35.141818 0 0 0-9.984-30.952727l-23.272728-22.574545z" p-id="3855"></path></svg></button><button title="Light theme" class="__dumi-default-dark-sun "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4026" width="22" height="22"><path d="M915.2 476.16h-43.968c-24.704 0-44.736 16-44.736 35.84s20.032 35.904 44.736 35.904H915.2c24.768 0 44.8-16.064 44.8-35.904s-20.032-35.84-44.8-35.84zM512 265.6c-136.704 0-246.464 109.824-246.464 246.4 0 136.704 109.76 246.464 246.464 246.464S758.4 648.704 758.4 512c0-136.576-109.696-246.4-246.4-246.4z m0 425.6c-99.008 0-179.2-80.128-179.2-179.2 0-98.944 80.192-179.2 179.2-179.2S691.2 413.056 691.2 512c0 99.072-80.192 179.2-179.2 179.2zM197.44 512c0-19.84-19.136-35.84-43.904-35.84H108.8c-24.768 0-44.8 16-44.8 35.84s20.032 35.904 44.8 35.904h44.736c24.768 0 43.904-16.064 43.904-35.904zM512 198.464c19.776 0 35.84-20.032 35.84-44.8v-44.8C547.84 84.032 531.84 64 512 64s-35.904 20.032-35.904 44.8v44.8c0 24.768 16.128 44.864 35.904 44.864z m0 627.136c-19.776 0-35.904 20.032-35.904 44.8v44.736C476.096 940.032 492.16 960 512 960s35.84-20.032 35.84-44.8v-44.736c0-24.768-16.064-44.864-35.84-44.864z m329.92-592.832c17.472-17.536 20.288-43.072 6.4-57.024-14.016-14.016-39.488-11.2-57.024 6.336-4.736 4.864-26.496 26.496-31.36 31.36-17.472 17.472-20.288 43.008-6.336 57.024 13.952 14.016 39.488 11.2 57.024-6.336 4.8-4.864 26.496-26.56 31.296-31.36zM213.376 759.936c-4.864 4.8-26.56 26.624-31.36 31.36-17.472 17.472-20.288 42.944-6.4 56.96 14.016 13.952 39.552 11.2 57.024-6.336 4.8-4.736 26.56-26.496 31.36-31.36 17.472-17.472 20.288-43.008 6.336-56.96-14.016-13.952-39.552-11.072-56.96 6.336z m19.328-577.92c-17.536-17.536-43.008-20.352-57.024-6.336-14.08 14.016-11.136 39.488 6.336 57.024 4.864 4.864 26.496 26.56 31.36 31.424 17.536 17.408 43.008 20.288 56.96 6.336 14.016-14.016 11.264-39.488-6.336-57.024-4.736-4.864-26.496-26.56-31.296-31.424z m527.168 628.608c4.864 4.864 26.624 26.624 31.36 31.424 17.536 17.408 43.072 20.224 57.088 6.336 13.952-14.016 11.072-39.552-6.4-57.024-4.864-4.8-26.56-26.496-31.36-31.36-17.472-17.408-43.072-20.288-57.024-6.336-13.952 14.016-11.008 39.488 6.336 56.96z" p-id="4027"></path></svg></button><button title="Default to system" class="__dumi-default-dark-auto "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="11002" width="22" height="22"><path d="M127.658667 492.885333c0-51.882667 10.24-101.717333 30.378666-149.162666s47.786667-88.064 81.92-122.538667 75.093333-61.781333 122.538667-81.92 96.938667-30.378667 149.162667-30.378667 101.717333 10.24 149.162666 30.378667 88.405333 47.786667 122.88 81.92 61.781333 75.093333 81.92 122.538667 30.378667 96.938667 30.378667 149.162666-10.24 101.717333-30.378667 149.162667-47.786667 88.405333-81.92 122.88-75.093333 61.781333-122.88 81.92-97.28 30.378667-149.162666 30.378667-101.717333-10.24-149.162667-30.378667-88.064-47.786667-122.538667-81.92-61.781333-75.093333-81.92-122.88-30.378667-96.938667-30.378666-149.162667z m329.045333 0c0 130.048 13.994667 244.394667 41.984 343.381334h12.970667c46.762667 0 91.136-9.216 133.461333-27.306667s78.848-42.666667 109.568-73.386667 54.954667-67.242667 73.386667-109.568 27.306667-86.698667 27.306666-133.461333c0-46.421333-9.216-90.794667-27.306666-133.12s-42.666667-78.848-73.386667-109.568-67.242667-54.954667-109.568-73.386667-86.698667-27.306667-133.461333-27.306666h-11.605334c-28.672 123.562667-43.349333 237.909333-43.349333 343.722666z" p-id="11003"></path></svg></button></div></div></div><ul class="__dumi-default-menu-list"><li><a href="/enhanfe//advanced/webpack">Tapable ä¸ Webpack æµ…æ</a></li><li><a aria-current="page" class="active" href="/enhanfe//advanced/babel">Babel æµ…æ</a></li><li><a href="/enhanfe//advanced/scaffold">å‰ç«¯é¡¹ç›®è„šæ‰‹æ¶å¼€å‘å®è·µ</a></li><li><a href="/enhanfe//advanced/redux">Redux åŸç†æµ…æ</a></li><li><a href="/enhanfe//advanced/buildownreact">React åŸç†æµ…æ</a></li><li><a href="/enhanfe//advanced/eventloop">äº‹ä»¶ç³»ç»Ÿæµ…æ</a></li><li><a href="/enhanfe//advanced/async">å¼‚æ­¥å¤„ç†æµ…æ</a></li></ul></div></div><ul role="slug-list" class="__dumi-default-layout-toc"><li title="Babel ç®€ä»‹" data-depth="2"><a href="/enhanfe//advanced/babel#babel-ç®€ä»‹"><span>Babel ç®€ä»‹</span></a></li><li title="Babel å·¥å…·é“¾" data-depth="2"><a href="/enhanfe//advanced/babel#babel-å·¥å…·é“¾"><span>Babel å·¥å…·é“¾</span></a></li><li title="@babel/parser" data-depth="3"><a href="/enhanfe//advanced/babel#babelparser"><span>@babel/parser</span></a></li><li title="@babel/traverse" data-depth="3"><a href="/enhanfe//advanced/babel#babeltraverse"><span>@babel/traverse</span></a></li><li title="@babel/generator" data-depth="3"><a href="/enhanfe//advanced/babel#babelgenerator"><span>@babel/generator</span></a></li><li title="@babel/typesã€@babel/template" data-depth="3"><a href="/enhanfe//advanced/babel#babeltypesã€babeltemplate"><span>@babel/typesã€@babel/template</span></a></li><li title="Babel çš„å¯åŠ¨ä¸é…ç½®" data-depth="2"><a href="/enhanfe//advanced/babel#babel-çš„å¯åŠ¨ä¸é…ç½®"><span>Babel çš„å¯åŠ¨ä¸é…ç½®</span></a></li><li title="Plugin" data-depth="2"><a href="/enhanfe//advanced/babel#plugin"><span>Plugin</span></a></li><li title="å¸¸ç”¨ Plugin" data-depth="3"><a href="/enhanfe//advanced/babel#å¸¸ç”¨-plugin"><span>å¸¸ç”¨ Plugin</span></a></li><li title="è‡ªå®šä¹‰ Babel Plugin" data-depth="3"><a href="/enhanfe//advanced/babel#è‡ªå®šä¹‰-babel-plugin"><span>è‡ªå®šä¹‰ Babel Plugin</span></a></li></ul><div class="__dumi-default-layout-content"><div class="markdown"><h2 id="babel-ç®€ä»‹"><a aria-hidden="true" tabindex="-1" href="/enhanfe//advanced/babel#babel-ç®€ä»‹"><span class="icon icon-link"></span></a>Babel ç®€ä»‹</h2><p>Babel æ˜¯ JavaScript ç¼–è¯‘å™¨ï¼Œæ›´ç¡®åˆ‡åœ°è¯´ Babel æ˜¯ä¸€ä¸ªå·¥å…·é“¾ï¼Œåœ¨æ—©æœŸï¼Œå®ƒä¸»è¦ç”¨äºåœ¨å½“å‰å’Œè¾ƒæ—§çš„æµè§ˆå™¨æˆ– js ç¯å¢ƒä¸­å°† ECMAScript 2015+ ä»£ç è½¬æ¢ä¸º JavaScript çš„å‘åå…¼å®¹ç‰ˆæœ¬ã€‚è€Œå¦‚ä»Šï¼Œé€šè¿‡ babel å¯ä»¥åšçš„äº‹æƒ…è¿œä¸æ­¢äºæ­¤ï¼Œå®˜æ–¹æ–‡æ¡£ç»™å‡ºäº† Babel ä»¥ä¸‹ç‰¹æ€§ï¼š</p><ul><li>è½¬æ¢è¯­æ³•</li><li>ç›®æ ‡ç¯å¢ƒä¸­ç¼ºå°‘çš„ polyfill åŠŸèƒ½ï¼ˆé€šè¿‡ <code>@babel/polyfill</code> ï¼‰</li><li>æºä»£ç è½¬æ¢ï¼ˆcodemodsï¼‰</li></ul><p>é™¤äº†ä»¥ä¸Šç‰¹æ€§ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å€ŸåŠ© Babel å®ç°è‡ªå®šä¹‰ç¼–è¯‘å™¨ï¼Œå®ç°æ›´å¤šåœºæ™¯ä¸‹æºä»£ç çš„è½¬æ¢åŠŸèƒ½ã€‚ä¾‹å¦‚ Taro 1.x ç‰ˆæœ¬ï¼Œä¾¿æ˜¯ä½¿ç”¨ Babel å®ç°åŸºäº Nerv è¯­æ³•çš„å¤šç«¯ä»£ç è½¬åŒ–å™¨ï¼Œè™½ç„¶åœ¨åæ¥çš„æŠ€æœ¯æ¼”å˜ä¸­ï¼Œæ”¾å¼ƒäº†è¿™ç§å®ç°æ–¹å¼ï¼Œä½† Babel ä¹‹å¼ºå¤§ï¼Œæ— å¯åšéã€‚æœ¬æ–‡å°†ä» Babel åŸºç¡€è®²èµ·ï¼Œè´¯ç©¿ Babel é“¾è·¯ã€‚</p><p>æ—¥å¸¸ä¸­æˆ‘ä»¬ä½¿ç”¨ Babel æœ€å¤šçš„åœºæ™¯å¤§æ¦‚å°±æ˜¯ js ä»£ç è½¬æ¢äº†ï¼Œä¾‹å¦‚ ES6 ä»£ç æµè§ˆå™¨æ— æ³•å®Œå…¨æ”¯æŒæ€ä¹ˆåŠï¼ŸReact åº”ç”¨ JSX ä»£ç å¦‚ä½•è½¬æ¢ä¸º js ä»£ç ï¼Ÿè¿™ä¸¤ä¸ªé—®é¢˜å¾ˆç®€å•ï¼Œå¦‚æœæ˜¯å€ŸåŠ© webpackï¼Œæˆ‘ä»¬å¯ä»¥å®‰è£… babel-laoder è¿›è¡Œ js ä»£ç å¤„ç†ï¼Œæœ€ç»ˆè¾“å‡ºç›®æ ‡ä»£ç ï¼Œä¸åŒçš„æ˜¯ï¼Œå¯¹äº ES6 ä»£ç ï¼Œæˆ‘ä»¬é€šå¸¸é€‰æ‹© <code>@babel/preset-env</code> è¿›è¡Œæ”¯æŒï¼Œè€Œå¯¹äº JSX ä»£ç ï¼Œæˆ‘ä»¬éœ€è¦é€‰æ‹© <code>@babel/preset-react</code> åŒ…ä»¥æ”¯æŒã€‚</p><p><code>@babel/preset-env</code> å¯å°† ES6 ä»£ç è½¬æ¢ä¸ºå…¼å®¹ä»£ç ï¼Œç®€å•ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment">// Babel Input: ES2015 arrow function</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> n </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// Babel Output: ES5 equivalent</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword control-flow">return</span><span class="token plain"> n </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p><code>@babel/preset-react</code> å¯å°† JSX ä»£ç è½¬æ¢ä¸º js ä»£ç ï¼Œç®€å•ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment">// Babel Input: JSX</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token operator">&lt;</span><span class="token plain">div</span><span class="token operator">&gt;</span><span class="token number">123</span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token plain">div</span><span class="token operator">&gt;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// Babel Output: ES5 equivalent</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token maybe-class-name">React</span><span class="token punctuation">.</span><span class="token method function property-access">createElement</span><span class="token punctuation">(</span><span class="token string">&#x27;div&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token keyword null nil">null</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&#x27;123&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>ç”±æ­¤å¯è§ï¼Œå€ŸåŠ© Babel å¯ä»¥è½»æ¾å®ç°ä»£ç è½¬æ¢ã€‚</p><h2 id="babel-å·¥å…·é“¾"><a aria-hidden="true" tabindex="-1" href="/enhanfe//advanced/babel#babel-å·¥å…·é“¾"><span class="icon icon-link"></span></a>Babel å·¥å…·é“¾</h2><p>Babel è½¬åŒ–ä»£ç å†…éƒ¨å®ç°å¯æ¦‚æ‹¬ä¸ºï¼š<strong>è§£ææºç ç”Ÿæˆ AST -&gt; éå† AST è°ƒæ•´å†…å®¹ä»¥æ±‚å¾—åˆ°æ–°çš„ä»£ç è¾“å‡º -&gt; ç”Ÿæˆè½¬æ¢åçš„ä»£ç </strong>ã€‚ ä»¥ä¸Šä»‹ç»çš„ä¸‰æ­¥ï¼Œåˆ†åˆ«å¯¹åº”äº† Babel æä¾›çš„ä¸‰ä¸ªä¸åŒåŒ…ï¼Œåˆ†åˆ«ä¸ºï¼š<code>@babel/parser</code>ã€<code>@babel/traverse</code>ã€<code>@babel/generator</code> ã€‚è¿™ä¸ªè¿‡ç¨‹æˆ‘ä»¬ç”¨æµç¨‹å›¾ç®€å•æè¿°å¦‚ä¸‹ï¼š</p><img src="/enhanfe/static/babel-1.45da5fab.png"/><p>ç”±å¤–è€Œå†…ï¼Œæˆ‘ä»¬ä» <code>@babel/parser</code> è®²èµ·ã€‚</p><h3 id="babelparser"><a aria-hidden="true" tabindex="-1" href="/enhanfe//advanced/babel#babelparser"><span class="icon icon-link"></span></a>@babel/parser</h3><p>ä»‹ç»è¿™ä¸ªåŒ…ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆçœ‹ä¸€è¡Œå¾ˆç®€å•çš„ä»£ç ï¼Œç„¶ååšä¸€ä¸ªç®€å•åˆ†æã€‚å¦‚ä¸‹æ‰€ç¤ºç»™ä½ ä¸€æ®µä»£ç ï¼Œè¯·ä½ æè¿°è¿™æ®µä»£ç ã€‚</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">var</span><span class="token plain"> a </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">7</span><span class="token punctuation">;</span></div></pre></div><p>å¯¹äº Babelï¼Œé¦–å…ˆä¼šåˆ†æè¿™æ®µä»£ç çš„ä¸€äº›ç¬¦å·ï¼Œè¿™æ®µä»£ç ä¸­ï¼ŒBabel è¿™æ ·æ¥æè¿°æ¯ä¸ªç¬¦å·ï¼š</p><table><thead><tr><th>å«ä¹‰</th><th>ç¬¦å·</th></tr></thead><tbody><tr><td>Keyword</td><td>var</td></tr><tr><td>Identifier</td><td>a</td></tr><tr><td>Punctuator</td><td>=</td></tr><tr><td>Literal</td><td>7</td></tr><tr><td>Punctuator</td><td>;</td></tr></tbody></table><p>é¦–å…ˆä¼šé’ˆå¯¹ä»£ç è¿›è¡Œè¯æ³•åˆ†æï¼ˆLexical Analysisï¼‰ï¼Œä¾‹å¦‚ä»¥ä¸‹ä¾‹å­ï¼Œè¯æ³•åˆ†æä¸é€šè¿‡ï¼š</p><p><strong>è¯æ³•åˆ†æï¼ˆLexical Analysisï¼‰</strong></p><p>æœªç»“å°¾çš„æ³¨é‡Š</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment">/* var a = 7;</span></div></pre></div><p>éæ³•å­—ç¬¦</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">var</span><span class="token plain"> a </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">7</span><span class="token plain">Â°</span><span class="token punctuation">;</span></div></pre></div><p>ä¸æ­£ç¡®çš„äºŒè¿›åˆ¶æ•°</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">var</span><span class="token plain"> a </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain">b20</span><span class="token punctuation">;</span></div></pre></div><p><strong>è¯­æ³•åˆ†æï¼ˆSyntax Analysisï¼‰</strong></p><p>è¯­æ³•åˆ†æå³æ˜¯å°†è¯æ³•åˆ†ææ‰€å¾—å†…å®¹æ•´åˆåˆ°æŠ½è±¡è¯­æ³•æ ‘ï¼ˆASTï¼‰ä¸­ã€‚</p><blockquote><p>ASTï¼Œå…¨ç§° abstract syntax treeï¼Œä½¿ç”¨å¯¹è±¡æè¿°è¯­æ³•ç»“æ„ã€‚</p></blockquote><p>é€šè¿‡è¯æ³•åˆ†æï¼Œæˆ‘ä»¬å¾—åˆ°äº†ä»£ç ä¸­åŸºæœ¬å…ƒç´ ï¼Œè¿›è€Œéœ€è¦è¿›è¡Œè¯­æ³•åˆ†æï¼Œä¸²è¯æˆå¥ï¼Œå¯¹äºä¸Šé¢æ‰€è®²åˆ°çš„ <code>var a = 7;</code> è¿™æ®µä»£ç ï¼Œè¿›è¡Œè¯­æ³•åˆ†æåæ„å»ºæŠ½è±¡è¯­æ³•æ ‘ï¼Œç»“æœå¦‚å›¾ï¼š</p><img src="/enhanfe/static/babel-2.4d8d3ced.png"/><p><strong>è¯­ä¹‰åˆ†æï¼ˆSemantic Analysisï¼‰</strong></p><p>ç»è¿‡è¯æ³•ã€è¯­æ³•åˆ†æåï¼Œä»£ç è¿˜éœ€ç»“åˆä¸Šä¸‹æ–‡è¿›è¡Œè¯­ä¹‰åˆ†æï¼Œä¾‹å¦‚åœ¨ä½œç”¨åŸŸä¸­ä½¿ç”¨äº†æŸä¸ªä¸æ›¾å£°æ˜çš„å˜é‡ï¼Œåœ¨ä½œç”¨åŸŸä¸­é‡å¤å£°æ˜æŸä¸ªå˜é‡ç­‰é—®é¢˜ã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><p>é‡å¤å£°æ˜</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">let</span><span class="token plain"> num </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">let</span><span class="token plain"> num </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation">;</span></div></pre></div><p>ä½¿ç”¨ä¸åœ¨è¯¥ä½œç”¨åŸŸä¸­çš„å˜é‡</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">let</span><span class="token plain"> str </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string">&#x27;hello&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">str</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>åˆ°è¿™é‡Œï¼ŒBabel Parser å·²åŸºæœ¬å®Œæˆä»£ç çš„è§£æå·¥ä½œï¼Œå¹¶è¾“å‡ºåˆå§‹ä»£ç  ASTã€‚è¿›è€Œï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ @babel/traverseï¼Œéå†ä»£ç ä»¥ç”Ÿæˆç›®æ ‡ä»£ç ã€‚</p><p>ä»¥ä¸Šä»‹ç»äº† parser å†…éƒ¨æµç¨‹ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸‹ç¤ºä¾‹ä¸€çª¥å…¶ç”¨æ³•ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;@babel/parser&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">parse</span><span class="token punctuation">(</span><span class="token string">&#x27;code&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// parse in strict mode and allow module declarations</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  sourceType</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;module&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  plugins</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// enable jsx and flow syntax</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token string">&#x27;jsx&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token string">&#x27;flow&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><h3 id="babeltraverse"><a aria-hidden="true" tabindex="-1" href="/enhanfe//advanced/babel#babeltraverse"><span class="icon icon-link"></span></a>@babel/traverse</h3><p>çœ‹åˆ°éå†ï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“è”æƒ³åˆ°æ•°ç»„çš„éå†ï¼Œè€Œåœ¨ AST ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„ç®—æ³•æ˜¯å›¾éå†ï¼Œæ›´å‡†ç¡®çš„è¯´æ˜¯ <strong>æ·±åº¦ä¼˜å…ˆæœç´¢</strong>ã€‚</p><p><strong>å£°æ˜éå†ï¼ˆDeclarative traversalï¼‰</strong>æ‹¿åˆ° parser è½¬åŒ–å¾—åˆ°çš„ AST åï¼Œé€šè¿‡éå†ä»¥å¯¹ä¸åŒå£°æ˜è¿›è¡Œæ“ä½œï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token function">traverse</span><span class="token punctuation">(</span><span class="token plain">ast</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token maybe-class-name">CallExpression</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">enter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&#x27;Call&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p><strong>åŠ¨æ€æŠ½è±¡è¯­æ³•æ ‘ï¼ˆDynamic Abstract Syntax Treeï¼‰</strong>æŠ½è±¡è¯­æ³•æ ‘å¯èƒ½ä¼šåœ¨éå†è¿‡ç¨‹ä¸­ï¼ŒåŠ¨æ€è°ƒæ•´éƒ¨åˆ†ç»“æ„ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p><p>éå†åˆ° 1 + fn(3) æ—¶ï¼Œä½¿ç”¨ [6, fn] æ›¿æ¢è¯¥è¡¨è¾¾å¼ï¼ŒCallExpression æ›¿æ¢ä¸º ArrayExpression<img src="/enhanfe/static/babel-3.50335e40.png"/>éå†å®Œåï¼Œè¿”å›<img src="/enhanfe/static/babel-4.b415f93d.png"/></p><p><strong>ä½œç”¨åŸŸåˆ†æï¼ˆScope analysisï¼‰</strong></p><p>ä»¥ä¸Šè¿‡ç¨‹å®Œæˆäº† Babel æŠ½è±¡è¯­æ³•æ ‘éå†è¿‡ç¨‹ï¼Œå¹¶æ ¹æ®å®é™…éœ€æ±‚ï¼Œå°†åˆå§‹ä»£ç  AST åœ¨éå†è¿‡ç¨‹è½¬æ¢æˆäº†ç›®æ ‡ä»£ç  AST ï¼Œæ¥ä¸‹æ¥éœ€è¦å°†ç›®æ ‡ä»£ç  AST è¾“å‡ºä¸ºç›®æ ‡ä»£ç ã€‚</p><p>ä»¥ä¸Šä»‹ç»äº† traverse å†…éƒ¨æµç¨‹ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸‹ç¤ºä¾‹ä¸€çª¥å…¶ç”¨æ³•ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword module">import</span><span class="token plain"> </span><span class="token imports operator">*</span><span class="token imports"> </span><span class="token imports keyword module">as</span><span class="token imports"> parser</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&#x27;@babel/parser&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token imports">traverse</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&#x27;@babel/traverse&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> code </span><span class="token operator">=</span><span class="token plain"> </span><span class="token template-string template-punctuation string">`</span><span class="token template-string string">function square(n) {</span></div><div class="token-line"><span class="token template-string string">  return n * n;</span></div><div class="token-line"><span class="token template-string string">}</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> ast </span><span class="token operator">=</span><span class="token plain"> parser</span><span class="token punctuation">.</span><span class="token method function property-access">parse</span><span class="token punctuation">(</span><span class="token plain">code</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token function">traverse</span><span class="token punctuation">(</span><span class="token plain">ast</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">enter</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">path</span><span class="token punctuation">.</span><span class="token method function property-access">isIdentifier</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;n&#x27;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      path</span><span class="token punctuation">.</span><span class="token property-access">node</span><span class="token punctuation">.</span><span class="token property-access">name</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string">&#x27;x&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><h3 id="babelgenerator"><a aria-hidden="true" tabindex="-1" href="/enhanfe//advanced/babel#babelgenerator"><span class="icon icon-link"></span></a>@babel/generator</h3><p>å°† AST è½¬åŒ–ç”Ÿæˆä¸ºç›®æ ‡ä»£ç ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword module">import</span><span class="token plain"> </span><span class="token imports punctuation">{</span><span class="token imports"> parse </span><span class="token imports punctuation">}</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&#x27;@babel/parser&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token imports">generate</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&#x27;@babel/generator&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> a </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string">&#x27;var a = 1;&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> b </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string">&#x27;var b = 2;&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> astA </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token plain">a</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> sourceFilename</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;a.js&#x27;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> astB </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token plain">b</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> sourceFilename</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;b.js&#x27;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> ast </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  type</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;Program&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  body</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token method function property-access">concat</span><span class="token punctuation">(</span><span class="token plain">astA</span><span class="token punctuation">.</span><span class="token property-access">program</span><span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">,</span><span class="token plain"> astB</span><span class="token punctuation">.</span><span class="token property-access">program</span><span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> code</span><span class="token punctuation">,</span><span class="token plain"> map </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  ast</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"> sourceMaps</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token string">&#x27;a.js&#x27;</span><span class="token operator">:</span><span class="token plain"> a</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token string">&#x27;b.js&#x27;</span><span class="token operator">:</span><span class="token plain"> b</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><h3 id="babeltypesã€babeltemplate"><a aria-hidden="true" tabindex="-1" href="/enhanfe//advanced/babel#babeltypesã€babeltemplate"><span class="icon icon-link"></span></a>@babel/typesã€@babel/template</h3><p><strong>@babel/types</strong></p><p>ä½¿ç”¨ <code>@babel/types</code> åŒ…å¯ä»¥å¾ˆè½»æ¾è¿›è¡Œè¯­æ³•æ ‘ä¸­èŠ‚ç‚¹çš„ç±»å‹åˆ¤æ–­ç­‰æ“ä½œï¼Œä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä»¥ä¸‹æ–¹å¼åˆ¤æ–­ä¸€ä¸ªèŠ‚ç‚¹æ˜¯è¡¨è¾¾å¼ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">t</span><span class="token punctuation">.</span><span class="token method function property-access">isExpression</span><span class="token punctuation">(</span><span class="token plain">node</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>æˆ–è€…å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹å¼åˆ¤æ–­ï¼ŒæŸä¸ªèŠ‚ç‚¹æ˜¯å¦ä¸º test ä¸ºåçš„æ ‡è¯†ç¬¦ã€‚</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">t</span><span class="token punctuation">.</span><span class="token method function property-access">isIdentifier</span><span class="token punctuation">(</span><span class="token plain">node</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;test&#x27;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>ä¸æ­¤åŒæ—¶ï¼Œä½¿ç”¨ <code>@babel/types</code> å¯ä»¥å¾ˆè½»æ¾æ„å»ºä¸€ä¸ªè¡¨è¾¾å¼ï¼Œä¾‹å¦‚æœŸæœ›å°† varId èŠ‚ç‚¹çš„å€¼å¢åŠ  2ã€‚å¯ä»¥è¿™æ ·ä½¿ç”¨ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">t</span><span class="token punctuation">.</span><span class="token method function property-access">assignmentExpression</span><span class="token punctuation">(</span><span class="token string">&#x27;+=&#x27;</span><span class="token punctuation">,</span><span class="token plain"> varId</span><span class="token punctuation">,</span><span class="token plain"> t</span><span class="token punctuation">.</span><span class="token method function property-access">numericLiteral</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>è½¬æ¢åï¼Œå¾—åˆ°å¦‚ä¸‹ ASTï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  type</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;AssignmentExpression&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  operator</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;+=&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  right</span><span class="token operator">:</span><span class="token plain"> varId</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  left</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    type</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;NumericLiteral&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    value</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">2</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬çœ‹çœ‹æ›´ä¸ºå¤æ‚çš„ AST æ„å»ºï¼Œéœ€æ±‚ä¸ºï¼šç»™å®šä¸€ä¸ªæè¿°æ•°ç»„çš„èŠ‚ç‚¹ varIdï¼Œæ„å»ºè¯­æ³•æ ‘ä½¿å¾—è¯¥æ•°ç»„æ¯ä¸ªå…ƒç´ å¢åŠ  2ï¼Œä¸”æœ€åä»…è¿”å›å€¼å¤§äº 10 çš„å…ƒç´ ã€‚ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">t</span><span class="token punctuation">.</span><span class="token method function property-access">assignmentExpression</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token string">&#x27;=&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  varId</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  t</span><span class="token punctuation">.</span><span class="token method function property-access">callExpression</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    t</span><span class="token punctuation">.</span><span class="token method function property-access">memberExpression</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      t</span><span class="token punctuation">.</span><span class="token method function property-access">callExpression</span><span class="token punctuation">(</span><span class="token plain">t</span><span class="token punctuation">.</span><span class="token method function property-access">memberExpression</span><span class="token punctuation">(</span><span class="token plain">varId</span><span class="token punctuation">,</span><span class="token plain"> t</span><span class="token punctuation">.</span><span class="token method function property-access">identifier</span><span class="token punctuation">(</span><span class="token string">&#x27;map&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        t</span><span class="token punctuation">.</span><span class="token method function property-access">arrowFunctionExpression</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token punctuation">[</span><span class="token plain">t</span><span class="token punctuation">.</span><span class="token method function property-access">identifier</span><span class="token punctuation">(</span><span class="token string">&#x27;e&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          t</span><span class="token punctuation">.</span><span class="token method function property-access">binaryExpression</span><span class="token punctuation">(</span><span class="token string">&#x27;+&#x27;</span><span class="token punctuation">,</span><span class="token plain"> t</span><span class="token punctuation">.</span><span class="token method function property-access">identifier</span><span class="token punctuation">(</span><span class="token string">&#x27;e&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"> t</span><span class="token punctuation">.</span><span class="token method function property-access">numericLiteral</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      t</span><span class="token punctuation">.</span><span class="token method function property-access">identifier</span><span class="token punctuation">(</span><span class="token string">&#x27;filter&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">[</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      t</span><span class="token punctuation">.</span><span class="token method function property-access">arrowFunctionExpression</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">[</span><span class="token plain">t</span><span class="token punctuation">.</span><span class="token method function property-access">identifier</span><span class="token punctuation">(</span><span class="token string">&#x27;e&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        t</span><span class="token punctuation">.</span><span class="token method function property-access">binaryExpression</span><span class="token punctuation">(</span><span class="token string">&#x27;&gt;&#x27;</span><span class="token punctuation">,</span><span class="token plain"> t</span><span class="token punctuation">.</span><span class="token method function property-access">identifier</span><span class="token punctuation">(</span><span class="token string">&#x27;e&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"> t</span><span class="token punctuation">.</span><span class="token method function property-access">numericLiteral</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>ä»¥ä¸Šä»£ç ç€å®ä»¤äººå¤´ç§ƒï¼Œå¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬æœŸæœ›åœ¨å¯è¯»æ€§é«˜ã€ä»£ç ç»´æŠ¤æˆæœ¬ä½çš„å‰æä¸‹ï¼Œä¹¦å†™å¯é ä»£ç ï¼Œä»¥ä¸Šç¤ºä¾‹æˆ‘ä»¬å¯ä»¥é€šè¿‡å¦å¤–ä¸€ç§æ–¹å¼å®ç°ï¼Œé‚£å°±æ˜¯æ¨¡æ¿å®šä¹‰ã€‚</p><p><strong>@babel/template</strong></p><p>è¿˜æ˜¯ä»¥ä¸Šä¾‹ä¸ºä¾‹ï¼Œæˆ‘ä»¬ä½¿ç”¨æ¨¡æ¿æ–¹å¼æ„å»º AST å°±éå¸¸æ–¹ä¾¿äº†ï¼Œä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword module">import</span><span class="token plain"> </span><span class="token imports">template</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&#x27;@babel/template&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">template</span><span class="token punctuation">.</span><span class="token property-access">expression</span><span class="token punctuation">.</span><span class="token property-access">ast</span><span class="token template-string template-punctuation string">`</span><span class="token template-string string"></span></div><div class="token-line"><span class="token template-string string">  </span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">varId</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string string"> = </span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">varId</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string string"></span></div><div class="token-line"><span class="token template-string string">              .map(e =&gt; e + 2)</span></div><div class="token-line"><span class="token template-string string">              .filter(e =&gt; e &gt; 10)</span></div><div class="token-line"><span class="token template-string string"></span><span class="token template-string template-punctuation string">`</span><span class="token punctuation">;</span></div></pre></div><h2 id="babel-çš„å¯åŠ¨ä¸é…ç½®"><a aria-hidden="true" tabindex="-1" href="/enhanfe//advanced/babel#babel-çš„å¯åŠ¨ä¸é…ç½®"><span class="icon icon-link"></span></a>Babel çš„å¯åŠ¨ä¸é…ç½®</h2><p>æˆ‘ä»¬æœ€å¸¸è§ Babel çš„ä½¿ç”¨æ–¹å¼ä¾¿æ˜¯åœ¨ webpack å·¥å…·ä¸­ï¼Œä½¿ç”¨ babel-loader è¿›è¡Œ js èµ„æºå¤„ç†ï¼ŒBabel çš„é…ç½®å¯ä»¥å®šä¹‰åœ¨ package.json æˆ–è€… é¡¹ç›®ä¸‹çš„ .babelrc ä¸­ã€‚é™¤äº† babel-loaderï¼Œè¿˜å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ä½¿ç”¨ Babelï¼š</p><ul><li>@babel/cli</li><li>@babel/register</li><li>babelify</li><li>parcel</li><li>babel-loader</li></ul><p>å…³äº Babel çš„é…ç½®ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰åœ¨ä¸€ä¸‹æ–‡ä»¶ä¸­ï¼š</p><ul><li>babel.config.js</li><li>.babelrc</li><li>package.json</li><li>è¿è¡Œæ—¶æŒ‡å®š</li></ul><h2 id="plugin"><a aria-hidden="true" tabindex="-1" href="/enhanfe//advanced/babel#plugin"><span class="icon icon-link"></span></a>Plugin</h2><h3 id="å¸¸ç”¨-plugin"><a aria-hidden="true" tabindex="-1" href="/enhanfe//advanced/babel#å¸¸ç”¨-plugin"><span class="icon icon-link"></span></a>å¸¸ç”¨ Plugin</h3><p>Babel ç»™æˆ‘ä»¬æä¾›äº†å¾ˆå¤šå®ç”¨æ’ä»¶ï¼Œå¦‚ä¸‹è¡¨ï¼š</p><table><thead><tr><th>ç±»åˆ«</th><th>æ’ä»¶</th></tr></thead><tbody><tr><td>features</td><td>@babel/plugin-transform-classes</td></tr><tr><td>proposals</td><td>@babel/plugin-proposal-optional-chaining</td></tr><tr><td>extensions</td><td>@babel/plugin-transform-typescript<br/>@babel/plugin-transform-react-jsx</td></tr><tr><td>optimization</td><td>@babel/plugin-transform-runtime</td></tr></tbody></table><p>å½“ç„¶ï¼ŒBabel æ’ä»¶è¿œä¸æ­¢äºæ­¤ï¼Œå¦‚æœä½ æƒ³äº†è§£æ›´å¤š Babel æ’ä»¶ï¼Œå¯è‡ªè¡Œæœç´¢ã€‚</p><h3 id="è‡ªå®šä¹‰-babel-plugin"><a aria-hidden="true" tabindex="-1" href="/enhanfe//advanced/babel#è‡ªå®šä¹‰-babel-plugin"><span class="icon icon-link"></span></a>è‡ªå®šä¹‰ Babel Plugin</h3><p>è‡ªå®šä¹‰ Babel plugin å‰ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦æ˜ç¡®ä¸€ä¸‹å‡ ä¸ªè§‚ç‚¹ï¼š</p><ul><li>Babel æ’ä»¶æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå‡½æ•°è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œè¯¥å¯¹è±¡ä¸­çš„ä¸åŒå±æ€§ä¸æ–¹æ³•å®šä¹‰äº† plugin çš„åŠŸèƒ½</li><li>æ’ä»¶å¿…é¡»æœ‰ä¸€ä¸ªå“å½“å½“çš„åå­—</li><li>å®šä¹‰ Babel éå†å™¨</li><li>ä¿®æ”¹ Babel é…ç½®</li><li>ç»§æ‰¿å…¶ä»– plugin</li></ul><p>ç†Ÿæ‚‰è¿™å‡ ç‚¹ä»¥åï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ªæœ€ç®€å•çš„ç¤ºä¾‹ï¼Œæ¼”ç¤ºå®šä¹‰ä¸€ä¸ª Babel Plugin æ‰€éœ€è¦çš„æœ€åŸºæœ¬å…ƒç´ ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function maybe-class-name">EnhanfePlugin</span><span class="token punctuation">(</span><span class="token parameter">babel</span><span class="token parameter punctuation">,</span><span class="token parameter"> options</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;enhanfe-plugin&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    visitor</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token function maybe-class-name">CallExpression</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token comment">/*...*/</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">manipulateOptions</span><span class="token punctuation">(</span><span class="token parameter">babelOptions</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token comment">/*...*/</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    inherits</span><span class="token operator">:</span><span class="token plain"> </span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;another-plugin&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p>æŒæ¡äº†å¼€å‘ä¸€ä¸ª Plugin æœ€åŸºæœ¬çš„æ„æˆåï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç¤ºä¾‹å­¦ä¹  Babel Plugin çš„å°è£…ã€‚éœ€æ±‚å¦‚ä¸‹ï¼šæ‰‹å†™è½¬æ¢æ’ä»¶ï¼Œæ”¯æŒå¯¹è±¡å¯é€‰é“¾å–å€¼ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">person</span><span class="token operator">?.</span><span class="token plain">name</span><span class="token punctuation">;</span></div></pre></div><p>æ ¹æ®ä»¥ä¸Š Plugin å®šä¹‰æ¨¡æ¿ï¼Œæˆ‘ä»¬åˆ†å—ç¼–å†™é€»è¾‘ï¼Œä»£ç ä¸å„éƒ¨åˆ†è¯´æ˜å¦‚ä¸‹ä»£ç ç‰‡æ®µæ‰€ç¤ºï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">module</span><span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function maybe-class-name">EnhanfePlugin</span><span class="token punctuation">(</span><span class="token parameter">babel</span><span class="token parameter punctuation">,</span><span class="token parameter"> options</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> types</span><span class="token operator">:</span><span class="token plain"> t</span><span class="token punctuation">,</span><span class="token plain"> template </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> babel</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;enhanfe-plugin&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">manipulateOptions</span><span class="token punctuation">(</span><span class="token parameter">opts</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      opts</span><span class="token punctuation">.</span><span class="token property-access">parserOpts</span><span class="token punctuation">.</span><span class="token property-access">plugin</span><span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="token string">&#x27;optionalChanning&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    visitor</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token function maybe-class-name">OptionalMemeberExpression</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> object</span><span class="token punctuation">,</span><span class="token plain"> property </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> path</span><span class="token punctuation">.</span><span class="token property-access">node</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">        </span><span class="token comment">// é‡æ–°æ„å»ºè¡¨è¾¾å¼</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword">const</span><span class="token plain"> memberExpr </span><span class="token operator">=</span><span class="token plain"> t</span><span class="token punctuation">.</span><span class="token method function property-access">memberExpression</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          object</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          property</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          path</span><span class="token punctuation">.</span><span class="token property-access">node</span><span class="token punctuation">.</span><span class="token property-access">computed</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">        </span><span class="token comment">// éœ€è¦å¤„ç† undefined ä»¥é˜²æ­¢ undefined ä½œä¸ºå˜é‡åè¢«èµ‹å€¼</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token comment">// é€šè¿‡ path è·å–åˆ°å½“å‰ä½œç”¨åŸŸï¼Œå¹¶æ„å»ºä¸€ä¸ª undefined èŠ‚ç‚¹</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword">const</span><span class="token plain"> relUndefined </span><span class="token operator">=</span><span class="token plain"> path</span><span class="token punctuation">.</span><span class="token property-access">scope</span><span class="token punctuation">.</span><span class="token method function property-access">buildUndefinedNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">        path</span><span class="token punctuation">.</span><span class="token method function property-access">replaceWith</span><span class="token punctuation">(</span><span class="token plain">template</span><span class="token punctuation">.</span><span class="token property-access">expression</span><span class="token punctuation">.</span><span class="token property-access">ast</span><span class="token template-string template-punctuation string">`</span><span class="token template-string string"></span></div><div class="token-line"><span class="token template-string string">          </span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">object</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string string"> == null ? </span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">relUndefined</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string string"> : </span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">memberExpr</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string string"></span></div><div class="token-line"><span class="token template-string string">        </span><span class="token template-string template-punctuation string">`</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span></div></pre></div><p>ä»¥ä¸Šæ’ä»¶å®šä¹‰å¯¹äºç»™å®šçš„æµ‹è¯•ç”¨ä¾‹ï¼Œå·²ç»å¯ä»¥æ»¡è¶³äº†ï¼Œä½†æ˜¯å¦‚æœæ”¹å˜å¯é€‰é“¾é•¿åº¦æˆ–è€…è°ƒç”¨å½¢å¼ï¼Œä»¥ä¸Š Plugin å°†æ— æ³•ä½¿ç”¨ï¼Œæ¯”å¦‚ä»¥ä¸‹åœºæ™¯çš„å–å€¼ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">bags</span><span class="token operator">?.</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">person</span><span class="token operator">?.</span><span class="token plain">children</span><span class="token operator">?.</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">?.</span><span class="token plain">name</span><span class="token punctuation">;</span></div></pre></div><p>ä¸ºäº†æ”¯æŒä»¥ä¸Šç”¨ä¾‹ï¼Œæˆ‘ä»¬éœ€è¦ç¼–å†™æ›´å¤æ‚é€»è¾‘å¤„ç†ï¼Œè¦†ç›–å°½å¯èƒ½å¤šçš„æµ‹è¯•ç”¨ä¾‹ã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">module</span><span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function maybe-class-name">EnhanfePlugin</span><span class="token punctuation">(</span><span class="token parameter">babel</span><span class="token parameter punctuation">,</span><span class="token parameter"> options</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> types</span><span class="token operator">:</span><span class="token plain"> t</span><span class="token punctuation">,</span><span class="token plain"> template </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> babel</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;enhanfe-plugin&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">manipulateOptions</span><span class="token punctuation">(</span><span class="token parameter">opts</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      opts</span><span class="token punctuation">.</span><span class="token property-access">parserOpts</span><span class="token punctuation">.</span><span class="token property-access">plugin</span><span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="token string">&#x27;optionalChanning&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    visitor</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token function maybe-class-name">OptionalMemeberExpression</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token comment">// æš‚å­˜</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword">const</span><span class="token plain"> originalPath </span><span class="token operator">=</span><span class="token plain"> path</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword">const</span><span class="token plain"> temp </span><span class="token operator">=</span><span class="token plain"> path</span><span class="token punctuation">.</span><span class="token property-access">scope</span><span class="token punctuation">.</span><span class="token method function property-access">generateUidIdentifier</span><span class="token punctuation">(</span><span class="token string">&#x27;obj&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        path</span><span class="token punctuation">.</span><span class="token property-access">scope</span><span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> id</span><span class="token operator">:</span><span class="token plain"> temp </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">        </span><span class="token comment">// å¦‚æœå½“å‰èŠ‚ç‚¹å­˜åœ¨å¯é€‰é“¾è¡¨ç¤º</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword control-flow">while</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token plain">path</span><span class="token punctuation">.</span><span class="token property-access">node</span><span class="token punctuation">.</span><span class="token property-access">optional</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          path </span><span class="token operator">=</span><span class="token plain"> path</span><span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">&#x27;object&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword">let</span><span class="token plain"> memberExpr </span><span class="token operator">=</span><span class="token plain"> temp</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword control-flow">do</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          memberExpr </span><span class="token operator">=</span><span class="token plain"> t</span><span class="token punctuation">.</span><span class="token method function property-access">memberExpression</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            memberExpr</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            path</span><span class="token punctuation">.</span><span class="token property-access">node</span><span class="token punctuation">.</span><span class="token property-access">property</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            path</span><span class="token punctuation">.</span><span class="token property-access">node</span><span class="token punctuation">.</span><span class="token property-access">computed</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">          </span><span class="token comment">// éå†å®Œæˆï¼Œè·³å‡ºå¾ªç¯</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">path </span><span class="token operator">===</span><span class="token plain"> originalPath</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword control-flow">break</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          path </span><span class="token operator">=</span><span class="token plain"> path</span><span class="token punctuation">.</span><span class="token property-access">parentPath</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword control-flow">while</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">        </span><span class="token comment">// éœ€è¦å¤„ç† undefined ä»¥é˜²æ­¢ undefined ä½œä¸ºå˜é‡åè¢«èµ‹å€¼</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token comment">// é€šè¿‡ path è·å–åˆ°å½“å‰ä½œç”¨åŸŸï¼Œå¹¶æ„å»ºä¸€ä¸ª undefined èŠ‚ç‚¹</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword">const</span><span class="token plain"> relUndefined </span><span class="token operator">=</span><span class="token plain"> path</span><span class="token punctuation">.</span><span class="token property-access">scope</span><span class="token punctuation">.</span><span class="token method function property-access">buildUndefinedNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">        path</span><span class="token punctuation">.</span><span class="token method function property-access">replaceWith</span><span class="token punctuation">(</span><span class="token plain">template</span><span class="token punctuation">.</span><span class="token property-access">expression</span><span class="token punctuation">.</span><span class="token property-access">ast</span><span class="token template-string template-punctuation string">`</span><span class="token template-string string"></span></div><div class="token-line"><span class="token template-string string">          </span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">object</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string string"> == null ? </span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">relUndefined</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string string"> : </span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">memberExpr</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string string"></span></div><div class="token-line"><span class="token template-string string">        </span><span class="token template-string template-punctuation string">`</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span></div></pre></div><p>ä»ä¸Šä¾‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡º path éå†æ˜¯è‡ªåº•å‘ä¸Šçš„ï¼Œè¿™ä¹Ÿè¯´æ˜äº†å¯¹è±¡é“¾å¼è°ƒç”¨çš„å‘å‰æ¨æ–­è¿™ä¸€ç‰¹æ€§ã€‚é€šè¿‡ä»¥ä¸Šå¼€å‘çš„ç®€å• Babel æ’ä»¶ï¼ŒBabel ä¾¿èƒ½æ”¯æŒå¯é€‰é“¾è¿™ä¸€è¯­æ³•ï¼Œè¿™æ—¶ä½ åªéœ€è¦åœ¨ä½¿ç”¨ Babel çš„åœ°æ–¹å¼•å…¥è¯¥æ’ä»¶å³å¯ï¼Œä»¥ webpack ä¸­ babel-loader ä¸ºä¾‹ï¼Œé…ç½® Babel æ’ä»¶æ–¹å¼å¦‚ä¸‹ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment">// .babelrc</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token string">&quot;plugins&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token string">&quot;myPlugin&quot;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token string">&quot;babel-plugin-myPlugin&quot;</span><span class="token plain"> </span><span class="token comment">// equivalent</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">]</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p>Babel èƒ½åšçš„äº‹æƒ…è¿˜æœ‰å¾ˆå¤šï¼Œæˆ‘ä»¬åªéœ€è¦é€šè¿‡å®šä¹‰ Pluginã€Preset å³å¯å€ŸåŠ© Babel å®Œæˆä»£ç è½¬æ¢ã€è¯­æ³•å…¼å®¹ã€æ‹“å±•è¯­è¨€ç‰¹æ€§ç­‰åŠŸèƒ½ã€‚å¦‚æœä½ æ„çŠ¹æœªå°½ï¼Œå¯ä»¥æŸ¥çœ‹ Taro 1.x æºç ï¼Œæ ¸å¿ƒå®ç°é€»è¾‘ä¾¿æ˜¯å€ŸåŠ© Babel ä»¥å®Œæˆå¤šç«¯åº”ç”¨ç¼–è¯‘ã€‚</p><p>æœ€åï¼Œæ„Ÿè°¢ NicolÃ² å¤§ä½¬åˆ†äº«ï¼Œæ–‡ä¸­å›¾ç‰‡ä¸éƒ¨åˆ†è§‚ç‚¹å€Ÿé‰´è‡ªè¿™ä½å‰è¾ˆã€‚</p></div><div class="__dumi-default-layout-footer-meta"><span data-updated-text="æœ€åæ›´æ–°æ—¶é—´ï¼š">7/3/2021 05:06:26</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script src="/enhanfe/umi.js"></script>
  </body>
</html>
