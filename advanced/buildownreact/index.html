<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link
      rel="shortcut icon"
      type="image/x-icon"
      href="https://walker-markdown.oss-cn-shenzhen.aliyuncs.com/uPic/enhanfe.png"
    />
    <link rel="stylesheet" href="/enhanfe/umi.css" />
    <script>
      window.routerBase = "/enhanfe/";
    </script>
    <script>
      //! umi version: 3.5.15
    </script>
    <script>
      !(function () {
        var e = localStorage.getItem("dumi:prefers-color"),
          t = window.matchMedia("(prefers-color-scheme: dark)").matches,
          r = ["light", "dark", "auto"];
        document.documentElement.setAttribute(
          "data-prefers-color",
          e === r[2] ? (t ? r[1] : r[0]) : r.includes(e) ? e : r[0]
        );
      })();
    </script>
    <title>React åŸç†æµ…æ</title>
  </head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-route="/advanced/buildownreact" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" style="background-image:url(&#x27;https://walker-markdown.oss-cn-shenzhen.aliyuncs.com/uPic/enhanfe.png&#x27;)" href="/enhanfe//">Enhanfe</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><span><a href="/enhanfe//basic">ğŸ’Š åŸºç¡€</a></span><span><a aria-current="page" class="active" href="/enhanfe//advanced">ğŸ”¥ è¿›é˜¶</a></span><span><a href="/enhanfe//algorithms">ğŸ¦ æ•°æ®ç»“æ„ä¸ç®—æ³•</a></span><span><a target="_blank" rel="noopener noreferrer" href="https://github.com/HeyiMaster/enhanfe">â­ï¸Â Â GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></span><div class="__dumi-default-navbar-tool"><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "></div></div></div></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;https://walker-markdown.oss-cn-shenzhen.aliyuncs.com/uPic/enhanfe.png&#x27;)" href="/enhanfe//"></a><h1>Enhanfe</h1><p></p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li><a href="/enhanfe//basic">ğŸ’Š åŸºç¡€</a></li><li><a aria-current="page" class="active" href="/enhanfe//advanced">ğŸ”¥ è¿›é˜¶</a></li><li><a href="/enhanfe//algorithms">ğŸ¦ æ•°æ®ç»“æ„ä¸ç®—æ³•</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://github.com/HeyiMaster/enhanfe">â­ï¸Â Â GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "><button title="Dark theme" class="__dumi-default-dark-moon "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3854" width="22" height="22"><path d="M991.816611 674.909091a69.166545 69.166545 0 0 0-51.665455-23.272727 70.795636 70.795636 0 0 0-27.438545 5.585454A415.674182 415.674182 0 0 1 754.993338 698.181818c-209.594182 0-393.472-184.785455-393.472-395.636363 0-52.363636 38.539636-119.621818 69.515637-173.614546 4.887273-8.610909 9.634909-16.756364 14.103272-24.901818A69.818182 69.818182 0 0 0 384.631156 0a70.842182 70.842182 0 0 0-27.438545 5.585455C161.678429 90.298182 14.362065 307.898182 14.362065 512c0 282.298182 238.824727 512 532.38691 512a522.286545 522.286545 0 0 0 453.957818-268.334545A69.818182 69.818182 0 0 0 991.816611 674.909091zM546.679156 954.181818c-248.785455 0-462.941091-192-462.941091-442.181818 0-186.647273 140.637091-372.829091 300.939637-442.181818-36.817455 65.629091-92.578909 151.970909-92.578909 232.727273 0 250.181818 214.109091 465.454545 462.917818 465.454545a488.331636 488.331636 0 0 0 185.181091-46.545455 453.003636 453.003636 0 0 1-393.565091 232.727273z m103.656728-669.323636l-14.266182 83.781818a34.909091 34.909091 0 0 0 50.362182 36.770909l74.775272-39.563636 74.752 39.563636a36.142545 36.142545 0 0 0 16.174546 3.956364 34.909091 34.909091 0 0 0 34.210909-40.727273l-14.289455-83.781818 60.509091-59.345455a35.025455 35.025455 0 0 0-19.223272-59.578182l-83.61891-12.101818-37.376-76.101818a34.56 34.56 0 0 0-62.254545 0l-37.376 76.101818-83.618909 12.101818a34.909091 34.909091 0 0 0-19.246546 59.578182z m70.423272-64.698182a34.280727 34.280727 0 0 0 26.135273-19.083636l14.312727-29.090909 14.336 29.090909a34.257455 34.257455 0 0 0 26.135273 19.083636l32.046546 4.887273-23.272728 22.574545a35.234909 35.234909 0 0 0-10.007272 30.952727l5.46909 32.116364-28.625454-15.127273a34.490182 34.490182 0 0 0-32.302546 0l-28.695272 15.127273 5.469091-32.116364a35.141818 35.141818 0 0 0-9.984-30.952727l-23.272728-22.574545z" p-id="3855"></path></svg></button><button title="Light theme" class="__dumi-default-dark-sun "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4026" width="22" height="22"><path d="M915.2 476.16h-43.968c-24.704 0-44.736 16-44.736 35.84s20.032 35.904 44.736 35.904H915.2c24.768 0 44.8-16.064 44.8-35.904s-20.032-35.84-44.8-35.84zM512 265.6c-136.704 0-246.464 109.824-246.464 246.4 0 136.704 109.76 246.464 246.464 246.464S758.4 648.704 758.4 512c0-136.576-109.696-246.4-246.4-246.4z m0 425.6c-99.008 0-179.2-80.128-179.2-179.2 0-98.944 80.192-179.2 179.2-179.2S691.2 413.056 691.2 512c0 99.072-80.192 179.2-179.2 179.2zM197.44 512c0-19.84-19.136-35.84-43.904-35.84H108.8c-24.768 0-44.8 16-44.8 35.84s20.032 35.904 44.8 35.904h44.736c24.768 0 43.904-16.064 43.904-35.904zM512 198.464c19.776 0 35.84-20.032 35.84-44.8v-44.8C547.84 84.032 531.84 64 512 64s-35.904 20.032-35.904 44.8v44.8c0 24.768 16.128 44.864 35.904 44.864z m0 627.136c-19.776 0-35.904 20.032-35.904 44.8v44.736C476.096 940.032 492.16 960 512 960s35.84-20.032 35.84-44.8v-44.736c0-24.768-16.064-44.864-35.84-44.864z m329.92-592.832c17.472-17.536 20.288-43.072 6.4-57.024-14.016-14.016-39.488-11.2-57.024 6.336-4.736 4.864-26.496 26.496-31.36 31.36-17.472 17.472-20.288 43.008-6.336 57.024 13.952 14.016 39.488 11.2 57.024-6.336 4.8-4.864 26.496-26.56 31.296-31.36zM213.376 759.936c-4.864 4.8-26.56 26.624-31.36 31.36-17.472 17.472-20.288 42.944-6.4 56.96 14.016 13.952 39.552 11.2 57.024-6.336 4.8-4.736 26.56-26.496 31.36-31.36 17.472-17.472 20.288-43.008 6.336-56.96-14.016-13.952-39.552-11.072-56.96 6.336z m19.328-577.92c-17.536-17.536-43.008-20.352-57.024-6.336-14.08 14.016-11.136 39.488 6.336 57.024 4.864 4.864 26.496 26.56 31.36 31.424 17.536 17.408 43.008 20.288 56.96 6.336 14.016-14.016 11.264-39.488-6.336-57.024-4.736-4.864-26.496-26.56-31.296-31.424z m527.168 628.608c4.864 4.864 26.624 26.624 31.36 31.424 17.536 17.408 43.072 20.224 57.088 6.336 13.952-14.016 11.072-39.552-6.4-57.024-4.864-4.8-26.56-26.496-31.36-31.36-17.472-17.408-43.072-20.288-57.024-6.336-13.952 14.016-11.008 39.488 6.336 56.96z" p-id="4027"></path></svg></button><button title="Default to system" class="__dumi-default-dark-auto "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="11002" width="22" height="22"><path d="M127.658667 492.885333c0-51.882667 10.24-101.717333 30.378666-149.162666s47.786667-88.064 81.92-122.538667 75.093333-61.781333 122.538667-81.92 96.938667-30.378667 149.162667-30.378667 101.717333 10.24 149.162666 30.378667 88.405333 47.786667 122.88 81.92 61.781333 75.093333 81.92 122.538667 30.378667 96.938667 30.378667 149.162666-10.24 101.717333-30.378667 149.162667-47.786667 88.405333-81.92 122.88-75.093333 61.781333-122.88 81.92-97.28 30.378667-149.162666 30.378667-101.717333-10.24-149.162667-30.378667-88.064-47.786667-122.538667-81.92-61.781333-75.093333-81.92-122.88-30.378667-96.938667-30.378666-149.162667z m329.045333 0c0 130.048 13.994667 244.394667 41.984 343.381334h12.970667c46.762667 0 91.136-9.216 133.461333-27.306667s78.848-42.666667 109.568-73.386667 54.954667-67.242667 73.386667-109.568 27.306667-86.698667 27.306666-133.461333c0-46.421333-9.216-90.794667-27.306666-133.12s-42.666667-78.848-73.386667-109.568-67.242667-54.954667-109.568-73.386667-86.698667-27.306667-133.461333-27.306666h-11.605334c-28.672 123.562667-43.349333 237.909333-43.349333 343.722666z" p-id="11003"></path></svg></button></div></div></div><ul class="__dumi-default-menu-list"><li><a href="/enhanfe//advanced/webpack">Tapable ä¸ Webpack æµ…æ</a></li><li><a href="/enhanfe//advanced/babel">Babel æµ…æ</a></li><li><a href="/enhanfe//advanced/scaffold">å‰ç«¯é¡¹ç›®è„šæ‰‹æ¶å¼€å‘å®è·µ</a></li><li><a href="/enhanfe//advanced/redux">Redux åŸç†æµ…æ</a></li><li><a aria-current="page" class="active" href="/enhanfe//advanced/buildownreact">React åŸç†æµ…æ</a></li><li><a href="/enhanfe//advanced/eventloop">äº‹ä»¶ç³»ç»Ÿæµ…æ</a></li><li><a href="/enhanfe//advanced/async">å¼‚æ­¥å¤„ç†æµ…æ</a></li></ul></div></div><ul role="slug-list" class="__dumi-default-layout-toc"><li title="React å¸¦æ¥äº†ä»€ä¹ˆ" data-depth="2"><a href="/enhanfe//advanced/buildownreact#react-å¸¦æ¥äº†ä»€ä¹ˆ"><span>React å¸¦æ¥äº†ä»€ä¹ˆ</span></a></li><li title="åˆæ¢ React åŸç†" data-depth="2"><a href="/enhanfe//advanced/buildownreact#åˆæ¢-react-åŸç†"><span>åˆæ¢ React åŸç†</span></a></li><li title="React.createElement" data-depth="2"><a href="/enhanfe//advanced/buildownreact#reactcreateelement"><span>React.createElement</span></a></li><li title="ReactDOM.render" data-depth="2"><a href="/enhanfe//advanced/buildownreact#reactdomrender"><span>ReactDOM.render</span></a></li><li title="Scheduler" data-depth="2"><a href="/enhanfe//advanced/buildownreact#scheduler"><span>Scheduler</span></a></li><li title="Fiber æ¶æ„" data-depth="2"><a href="/enhanfe//advanced/buildownreact#fiber-æ¶æ„"><span>Fiber æ¶æ„</span></a></li><li title="Render Commit &amp; Reconciliation" data-depth="2"><a href="/enhanfe//advanced/buildownreact#render-commit--reconciliation"><span>Render Commit &amp; Reconciliation</span></a></li><li title="å‡½æ•°ç»„ä»¶" data-depth="2"><a href="/enhanfe//advanced/buildownreact#å‡½æ•°ç»„ä»¶"><span>å‡½æ•°ç»„ä»¶</span></a></li><li title="ä½¿ç”¨" data-depth="2"><a href="/enhanfe//advanced/buildownreact#ä½¿ç”¨"><span>ä½¿ç”¨</span></a></li></ul><div class="__dumi-default-layout-content"><div class="markdown"><h2 id="react-å¸¦æ¥äº†ä»€ä¹ˆ"><a aria-hidden="true" tabindex="-1" href="/enhanfe//advanced/buildownreact#react-å¸¦æ¥äº†ä»€ä¹ˆ"><span class="icon icon-link"></span></a>React å¸¦æ¥äº†ä»€ä¹ˆ</h2><p>React ç°å·²æˆä¸ºå‰ç«¯ä¸»æµå¼€å‘æ¡†æ¶ä¹‹ä¸€ï¼Œåœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬å¸¸é€‰ç”¨åŸç”Ÿ JS æˆ–è€… JQuery è¿›è¡Œå¼€å‘ï¼Œåœ¨ä¹‹åçš„å‘å±•ä¸­ï¼Œä¸ºä»€ä¹ˆä¼šè¯ç”Ÿè¯¸å¦‚ Reactã€Vueã€Angular çš„æ¡†æ¶å‘¢ï¼ŸåŸå› æœ‰ä¸‹ï¼š</p><ol><li>å‰ç«¯åº”ç”¨æ—¥è¶‹å¤æ‚</li><li>æ¨¡å—ã€ä¾èµ–ç®¡ç†éœ€è¦</li><li>æ€§èƒ½ä¼˜åŒ–</li><li>å›¢é˜Ÿæ•ˆèƒ½ã€è§„èŒƒç­‰</li></ol><p>æœ€åˆæˆ‘ä»¬å®Œæˆå‰ç«¯å¼€å‘ä¸­èŠ‚ç‚¹æ·»åŠ çš„åŠŸèƒ½ï¼Œéœ€è¦ç›´æ¥æ“ä½œ DOMï¼ŒåŸç”Ÿ JavaScript ä»£ç å¦‚ä¸‹ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> divDom </span><span class="token operator">=</span><span class="token plain"> </span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">createElement</span><span class="token punctuation">(</span><span class="token string">&#x27;div&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">divDom</span><span class="token punctuation">.</span><span class="token property-access">textContent</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string">&#x27;Hello World!&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">.</span><span class="token method function property-access">appendChild</span><span class="token punctuation">(</span><span class="token plain">divDom</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>JQuery ç‰ˆæœ¬ä»£ç å¦‚ä¸‹ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> $div </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&#x27;&lt;div&gt;&lt;/div&gt;&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$div</span><span class="token punctuation">.</span><span class="token method function property-access">text</span><span class="token punctuation">(</span><span class="token string">&#x27;Hello World&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token function">$</span><span class="token punctuation">(</span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">append</span><span class="token punctuation">(</span><span class="token plain">$div</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>ä»¥ä¸Šæ˜¯æ“ä½œ DOM çš„ä¸€ä¸ªç®€å•ä¾‹å­ï¼Œå¦‚æœåœºæ™¯æ›´å¤æ‚ï¼Œæˆ‘ä»¬é€šè¿‡è¿™ç§æ–¹å¼å¼€å‘åº”ç”¨æˆæœ¬æ˜¯å¾ˆé«˜çš„ï¼Œæ­¤æ—¶ï¼Œè¯¸å¦‚ React çš„æ¡†æ¶åº”è¿è€Œç”Ÿï¼Œä»¥ä¸Šä»£ç æˆ‘ä»¬ä½¿ç”¨å¼€å‘å¦‚ä¸‹ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> </span><span class="token maybe-class-name">App</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">div</span><span class="token operator">&gt;</span><span class="token maybe-class-name">Hello</span><span class="token plain"> </span><span class="token maybe-class-name">World</span><span class="token operator">!</span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token plain">div</span><span class="token operator">&gt;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token maybe-class-name">ReactDOM</span><span class="token punctuation">.</span><span class="token method function property-access">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span><span class="token maybe-class-name">App</span><span class="token plain"> </span><span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">&#x27;app&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>render æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œç»„ä»¶å°†ä¼šè¢«æŒ‚è½½åˆ° DOM èŠ‚ç‚¹ä¸Šï¼Œåœ¨ React ä¸­ï¼ŒApp ç»„ä»¶å’Œ DOM ä¹‹é—´æ˜¯æœ‰èƒ½åœ¨è”ç³»çš„ã€‚</p><h2 id="åˆæ¢-react-åŸç†"><a aria-hidden="true" tabindex="-1" href="/enhanfe//advanced/buildownreact#åˆæ¢-react-åŸç†"><span class="icon icon-link"></span></a>åˆæ¢ React åŸç†</h2><p>ä¸Šä¾‹ä¸­æˆ‘ä»¬è¿˜å‘ç°æœ‰æ›´æœ‰è¶£çš„åœ°æ–¹ï¼ŒJavaScript ä»£ç ä¸­å¯ä»¥ç›´æ¥ä¹¦å†™ HTML ä»£ç ç‰‡æ®µï¼Œè¿™ä¸€ç‰¹æ€§æˆ‘ä»¬ç§°ä¹‹ä¸º JSXã€‚ä½†ï¼Œå¦‚æœä½ äº†è§£è¿‡ React æ—©æœŸçš„é¡¹ç›®ï¼Œä½ ä¹Ÿè®¸è¿˜è®°å¾—ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token maybe-class-name">React</span><span class="token punctuation">.</span><span class="token method function property-access">createClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>ä¹‹ç±»çš„å‡½æ•°ï¼Œä¸ºä»€ä¹ˆæ–°ç‰ˆæœ¬çš„ React ä¸­å·²ä¸è§å…¶è¸ªå½±ï¼Ÿé‚£æ˜¯å› ä¸ºæ–°ç‰ˆ React åº”ç”¨å¤§å¤šéœ€è¦ç¼–è¯‘ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨ babel æ¥ç¼–è¯‘å‰ç«¯ä»£ç ï¼Œè¿™ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬æ‰€ä¹¦å†™çš„ JSXï¼Œå…¶å®æ˜¯é¢å‘äºå¼€å‘è€…çš„ï¼Œæœ€ç»ˆ JSX ä¼šè¢« babel è¿›è¡Œè½¬æ¢ï¼Œæˆ‘ä»¬ä»¥ä¸‹ä¸ºä¾‹ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-html"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token tag punctuation">&lt;</span><span class="token tag">div</span><span class="token tag"> </span><span class="token tag attr-name">title</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">header</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag punctuation">&gt;</span><span class="token plain">hello</span><span class="token tag punctuation">&lt;/</span><span class="token tag">div</span><span class="token tag punctuation">&gt;</span></div></pre></div><p>è¿™é‡ŒæŠ›å‡ºä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœä½ éœ€è¦ç”¨ JavaScript è®¾è®¡ä¸€ç§ç»“æ„å»å­˜å‚¨è¿™ä¸ªèŠ‚ç‚¹ï¼Œä½ ä¼šæ€ä¹ˆåšï¼Ÿå¸¦ç€è¿™ä¸ªé—®é¢˜ï¼Œç»“åˆæˆ‘ä»¬è¯´åˆ°çš„ babel è½¬åŒ– JSX ä»£ç ï¼ŒcreateElement ç™»åœºã€‚</p><blockquote><p>Tipï¼šjsx ä»£ç ä½¿ç”¨ babel-preset-react è¿›è¡Œå¤„ç†</p></blockquote><p>ä¸Šä¾‹ç»è¿‡è½¬æ¢åï¼Œç”Ÿæˆå¦‚ä¸‹ä»£ç ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token maybe-class-name">React</span><span class="token punctuation">.</span><span class="token method function property-access">createElement</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token string">&#x27;div&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    title</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;header&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token string">&#x27;hello&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>åˆ°è¿™é‡Œæ‰çœŸæ­£è§¦åŠ React æ¡†æ¶å†…å®¹ï¼Œæˆ‘ä»¬æŒ‰å›¾ç´¢éª¥ï¼Œä»è¿™ä¸ª api ç€æ‰‹ï¼Œä¸€ç¥ React è®¾è®¡æ€æƒ³ã€‚</p><p><code>React.createElement</code> æ–¹æ³•è°ƒç”¨è¿”å›çš„å‚æ•°æ­£æ˜¯æˆ‘ä»¬å‰é¢æŠ›å‡ºé—®é¢˜çš„ç­”æ¡ˆï¼Œè¿™ä¸€æ®µç®€çŸ­ JSX éœ€è¦ç”¨æ•°æ®æ¥è¿›è¡Œæè¿°ï¼Œæ€æ ·æè¿°å‘¢ï¼Ÿæˆ‘ä»¬å‘ç°ï¼Œæ¯ä¸ª JSX éƒ½èƒ½å¤ŸæŠ½è±¡ä¸ºä¸€ä¸ªå¯¹è±¡ï¼ŒJSX çš„åµŒå¥—å¯ä»¥ä½¿ç”¨ Tree æè¿°ã€‚æˆ‘ä»¬å…ˆæ¥çœ‹æœ€ç®€å•ç»“æ„è°ƒç”¨ <code>React.createElement</code> æ–¹æ³•åçš„è¿”å›ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> element </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  type</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;div&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  props</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    title</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;header&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    children</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;hello&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span></div></pre></div><p>æ—¢ç„¶æœ‰äº†è¿™äº›æè¿°ä¿¡æ¯ï¼Œæˆ‘ä»¬æƒ³æ¸²æŸ“åˆ° DOM ä¸­å°±å¾ˆå®¹æ˜“äº†ï¼Œæ€ä¹ˆåšå‘¢ï¼Ÿæˆ‘ä»¬é€šè¿‡èŠ‚ç‚¹æè¿°ä¿¡æ¯ï¼Œå°†è¯¥èŠ‚ç‚¹æŒ‚è½½åˆ° DOM ä¸Šï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> element </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  type</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;div&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  props</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    title</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;header&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    children</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;hello&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> type</span><span class="token punctuation">,</span><span class="token plain"> props </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> element</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> dom </span><span class="token operator">=</span><span class="token plain"> </span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">createElement</span><span class="token punctuation">(</span><span class="token plain">type</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">dom</span><span class="token punctuation">.</span><span class="token method function property-access">setAttribute</span><span class="token punctuation">(</span><span class="token plain">props</span><span class="token punctuation">.</span><span class="token property-access">title</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> text </span><span class="token operator">=</span><span class="token plain"> </span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">createTextNode</span><span class="token punctuation">(</span><span class="token plain">props</span><span class="token punctuation">.</span><span class="token property-access">children</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">dom</span><span class="token punctuation">.</span><span class="token method function property-access">appendChild</span><span class="token punctuation">(</span><span class="token plain">text</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">&#x27;app&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">appendChild</span><span class="token punctuation">(</span><span class="token plain">dom</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>ä»¥ä¸Šæ¨¡æ‹Ÿäº† React æ¡†æ¶æœ€æ ¸å¿ƒçš„å†…å®¹ï¼Œæ¦‚æ‹¬èµ·æ¥åŒ…æ‹¬ï¼š</p><ol><li>React.createElement æ„å»ºèŠ‚ç‚¹ä¿¡æ¯</li><li>æ ¹æ®æ„å»ºèŠ‚ç‚¹ä¿¡æ¯ï¼Œåœ¨æŸæ—¶åˆ»å°†ç»“ç‚¹æŒ‚è½½åˆ° DOM ä¸Š</li></ol><h2 id="reactcreateelement"><a aria-hidden="true" tabindex="-1" href="/enhanfe//advanced/buildownreact#reactcreateelement"><span class="icon icon-link"></span></a>React.createElement</h2><p>å‰é¢æˆ‘ä»¬çœ‹åˆ°ï¼ŒJSX ç»è¿‡ babel è½¬æ¢åï¼Œè¿˜ç”ŸæˆåŒ…å« <code>React.createElement</code> ç‰‡æ®µçš„ä»£ç ï¼Œè¿™å°èŠ‚æˆ‘ä»¬æ·±å…¥ç ”ç©¶è¯¥ api çš„å®ç°ã€‚ é¦–å…ˆæˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼Œåœ¨å¼€å‘ä¸­é€šå¸¸èŠ‚ç‚¹ä¿¡æ¯ç•¥å¾®å¤æ‚ï¼Œå‡è®¾ç°åœ¨æœ‰è¿™æ ·ä¸€æ®µ JSXï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-html"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token tag punctuation">&lt;</span><span class="token tag">div</span><span class="token tag"> </span><span class="token tag attr-name">title</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">header</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token tag punctuation">&lt;</span><span class="token tag">p</span><span class="token tag"> </span><span class="token tag attr-name">title</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">name</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag punctuation">&gt;</span><span class="token plain">name</span><span class="token tag punctuation">&lt;/</span><span class="token tag">p</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token tag punctuation">&lt;/</span><span class="token tag">div</span><span class="token tag punctuation">&gt;</span></div></pre></div><p>é¦–å…ˆç»è¿‡ babel è½¬åŒ–åï¼Œä¼šç”Ÿæˆå¦‚ä¸‹ä»£ç ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token maybe-class-name">React</span><span class="token punctuation">.</span><span class="token method function property-access">createElement</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token string">&#x27;div&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    title</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;header&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token maybe-class-name">React</span><span class="token punctuation">.</span><span class="token method function property-access">createElement</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token string">&#x27;p&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      title</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;name&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token string">&#x27;name&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>å‘ç°è§„å¾‹äº†å—ï¼Ÿ<code>createElement</code> æ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°è¡¨ç¤ºå½“å‰ JSX èŠ‚ç‚¹çš„ç±»å‹ï¼Œç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºå½“å‰ JSX èŠ‚ç‚¹å±æ€§ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºåµŒå¥—å†…å®¹ï¼Œä¸è¿‡æœ‰æ—¶ï¼Œä¸æ­¢ä¸‰ä¸ªå‚æ•°ï¼Œå‰ä¸¤ä¸ªå‚æ•°æ˜¯å›ºå®šçš„ï¼Œä»¥åçš„å‚æ•°ä¸ºåŠ¨æ€å‚æ•°ï¼Œä¸ªæ•°æœªå®šï¼Œè¿™ç‚¹æˆ‘ä»¬ç¨åä»‹ç»ã€‚ æœ€ç»ˆ <code>React.createElement</code> å‡½æ•°è°ƒç”¨åï¼Œå¦‚ä¸Šç»“æ„ä¼šç”¨ä»¥ä¸‹ç»“æ„æè¿°ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> element </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  type</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;div&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  props</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    title</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;header&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    children</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        type</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;div&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        props</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          title</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;name&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          children</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;hello&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span></div></pre></div><p>æ ¹æ®è¿™ä¸ªåˆ†æï¼Œæˆ‘ä»¬å†æ¥ä¸ªå¤æ‚äº›çš„ JSX ç»“æ„ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-html"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token tag punctuation">&lt;</span><span class="token tag">div</span><span class="token tag"> </span><span class="token tag attr-name">title</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">header</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token tag punctuation">&lt;</span><span class="token tag">p</span><span class="token tag"> </span><span class="token tag attr-name">title</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">n1</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag punctuation">&gt;</span><span class="token plain">n1 text</span><span class="token tag punctuation">&lt;/</span><span class="token tag">p</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token tag punctuation">&lt;</span><span class="token tag">p</span><span class="token tag"> </span><span class="token tag attr-name">title</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">n2</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag punctuation">&gt;</span><span class="token plain">n2 text</span><span class="token tag punctuation">&lt;/</span><span class="token tag">p</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token tag punctuation">&lt;/</span><span class="token tag">div</span><span class="token tag punctuation">&gt;</span></div></pre></div><p>ç»è¿‡ JSX è½¬åŒ–åï¼Œä¼šç”Ÿæˆå¦‚ä¸‹ä»£ç ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token maybe-class-name">React</span><span class="token punctuation">.</span><span class="token method function property-access">createElement</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token string">&#x27;div&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    title</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;header&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token maybe-class-name">React</span><span class="token punctuation">.</span><span class="token method function property-access">createElement</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token string">&#x27;p&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      title</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;n1&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token string">&#x27;n1 text&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token maybe-class-name">React</span><span class="token punctuation">.</span><span class="token method function property-access">createElement</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token string">&#x27;p&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      title</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;n2&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token string">&#x27;n2 text&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>è§„å¾‹ä¼¼ä¹å·²æ‰¾åˆ°ï¼Œæ ¹æ®æ€»ç»“çš„è¿™äº›å†…å®¹ï¼Œæˆ‘ä»¬è¿›è¡Œåˆæ­¥å°è¯•ï¼Œå°è£… <code>createElement</code> å‡½æ•°ã€‚å°è£…è¯¥å‡½æ•°æœ‰å‡ ä¸ªè¦ç‚¹ï¼Œåˆ†åˆ«ä¸ºï¼š</p><ol><li>ä¼ å…¥å‚æ•°ä¸ºåŠ¨æ€å‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°è¡¨ç¤ºèŠ‚ç‚¹ç±»å‹ï¼Œç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºèŠ‚ç‚¹å±æ€§ï¼Œç¬¬ä¸‰ä¸ªä»¥åå‚æ•°è¡¨ç¤ºåµŒå¥—å­å…ƒç´ </li><li>æ–¹æ³•è¿”å›å€¼ä¸ºå¯¹è±¡</li></ol><p>å¥½äº†ï¼Œæ¥è¯•è¯•å§ï¼</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token parameter">type</span><span class="token parameter punctuation">,</span><span class="token parameter"> props</span><span class="token parameter punctuation">,</span><span class="token parameter"> </span><span class="token parameter operator">...</span><span class="token parameter">children</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    type</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    props</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token spread operator">...</span><span class="token plain">props</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      children</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p>è¿™é‡Œ children ä¸­çš„å…ƒç´ å¯èƒ½æœ‰ä¸åŒç±»å‹çš„å€¼ï¼Œæˆ‘ä»¬åˆ’åˆ†ä¸º object å’Œ string ç±»å‹ï¼Œåœ¨å¤„ç†æ—¶ï¼Œéœ€è¦æ ¹æ®ä¸åŒç±»å‹åŒºåˆ«å¤„ç†ã€‚è¿›è¡Œä¼˜åŒ–åå¦‚ä¸‹ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token parameter">type</span><span class="token parameter punctuation">,</span><span class="token parameter"> props</span><span class="token parameter punctuation">,</span><span class="token parameter"> </span><span class="token parameter operator">...</span><span class="token parameter">children</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    type</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    props</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token spread operator">...</span><span class="token plain">props</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      children</span><span class="token operator">:</span><span class="token plain"> children</span><span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">child</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword">typeof</span><span class="token plain"> child </span><span class="token operator">===</span><span class="token plain"> </span><span class="token string">&#x27;object&#x27;</span><span class="token plain"> </span><span class="token operator">?</span><span class="token plain"> child </span><span class="token operator">:</span><span class="token plain"> </span><span class="token function">createTextElement</span><span class="token punctuation">(</span><span class="token plain">child</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">createTextElement</span><span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    type</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;TEXT_ELEMENT&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    props</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      children</span><span class="token operator">:</span><span class="token plain"> text</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      text</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p>ä¸è¿‡ï¼Œæˆ‘ä»¬è¿™é‡Œå¤„ç†è¿˜æ˜¯æœ‰æ¼æ´çš„ï¼Œä¾‹å¦‚å¸ƒå°”ç±»å‹å€¼ null ä¾ç„¶ä¼šåˆ›å»ºèŠ‚ç‚¹å¹¶æŒ‚è½½ï¼Œè¿™ä¸ React è®¾è®¡æ˜¯ä¸ä¸€è‡´çš„ï¼Œæˆ‘ä»¬è¿™é‡Œå…ˆå¿½ç•¥ã€‚</p><p>å¤„ç†å®Œæ•´æ­¥éª¤å¦‚ä¸‹ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> </span><span class="token maybe-class-name">App</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token operator">&lt;</span><span class="token plain">div title</span><span class="token operator">=</span><span class="token string">&quot;header&quot;</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token operator">&lt;</span><span class="token plain">p title</span><span class="token operator">=</span><span class="token string">&quot;n1&quot;</span><span class="token operator">&gt;</span><span class="token plain">n1 text</span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token plain">p</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token plain">div</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>babel è½¬æ¢ä¸ºå¦‚ä¸‹ä»£ç ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> </span><span class="token maybe-class-name">App</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token maybe-class-name">React</span><span class="token punctuation">.</span><span class="token method function property-access">createElement</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token string">&#x27;div&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    title</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;header&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token maybe-class-name">React</span><span class="token punctuation">.</span><span class="token method function property-access">createElement</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token string">&#x27;p&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      title</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;n1&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token string">&#x27;n1 text&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>è¯¥å‡½æ•°è°ƒç”¨ä¹‹åï¼Œè¿”å›å¦‚ä¸‹å¯¹è±¡ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> element </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  type</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;div&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  props</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    title</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;header&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    children</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      type</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;p&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      props</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        title</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;n1&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        children</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;n1 text&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span></div></pre></div><blockquote><p>Tipï¼šå½“ä¸€ä¸ªå…ƒç´ ä¸­åµŒå¥—ä¸€ä¸ªä»¥ä¸ŠèŠ‚ç‚¹æ—¶ï¼Œchildren ä¸ºæ•°ç»„ï¼›å½“åªæœ‰å•ä¸ªå…ƒç´ ä½¿ï¼Œchildren ä¸ºå¯¹è±¡ï¼›åªæœ‰æ–‡å­—å†…å®¹æ—¶ï¼Œchildren ä¸ºå­—ç¬¦ä¸²ã€‚æœ¬ä¾‹ä»¥å•ä¸ªå­å…ƒç´ è¿›è¡Œåˆ†æã€‚</p></blockquote><p>é€šè¿‡è¯¥æ–¹æ³•ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†èŠ‚ç‚¹æŒ‚è½½åˆ° DOM ä¸Šäº†ï¼Œè¯¥æ“ä½œåœ¨ ReactDOM.render å‡½æ•°ä¸­è¿›è¡Œã€‚</p><h2 id="reactdomrender"><a aria-hidden="true" tabindex="-1" href="/enhanfe//advanced/buildownreact#reactdomrender"><span class="icon icon-link"></span></a>ReactDOM.render</h2><p>render å‡½æ•°è´Ÿè´£æ ¹æ®è½¬åŒ–åçš„èŠ‚ç‚¹ä¿¡æ¯ï¼Œåˆ›å»ºå¯¹åº”èŠ‚ç‚¹ï¼Œç„¶åæŒ‚è½½ DOMï¼ŒèŠ‚ç‚¹ç±»å‹æ¥è‡ªäºèŠ‚ç‚¹ä¿¡æ¯çš„ type å­—æ®µã€‚è¿™æ ·æˆ‘ä»¬å¯ä»¥åˆ†æå‡ºæœ€ç®€å•çš„å‡½æ•°ä½“ç»“æ„ï¼Œå¦‚ä¸‹ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">element</span><span class="token parameter punctuation">,</span><span class="token parameter"> rootDom</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> dom </span><span class="token operator">=</span><span class="token plain"> </span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">createElement</span><span class="token punctuation">(</span><span class="token plain">element</span><span class="token punctuation">.</span><span class="token property-access">type</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  rootDom</span><span class="token punctuation">.</span><span class="token method function property-access">appendChild</span><span class="token punctuation">(</span><span class="token plain">dom</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p>åœ¨æ­¤åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬è¿˜éœ€è¦æ”¯æŒèŠ‚ç‚¹çš„åµŒå¥—ï¼Œæˆ‘ä»¬å†å®¡è§†ä¸€ä¸‹èŠ‚ç‚¹ä¿¡æ¯ï¼Œå‘ç°èŠ‚ç‚¹ä¸­çš„ children å±æ€§æ„æˆè‡ªé¡¶å‘ä¸‹çš„æ ‘ç»“æ„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å½“å‰èŠ‚ç‚¹å¯è§†ä¸ºå†…å±‚åµŒå¥—èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ï¼Œæ‰€ä»¥è¿™é‡Œå¯ä»¥ä½¿ç”¨é€’å½’å®ç° DOM ç»‘å®šï¼Œä¿®æ”¹åçš„ render å¦‚ä¸‹ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">element</span><span class="token parameter punctuation">,</span><span class="token parameter"> rootDom</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> dom </span><span class="token operator">=</span><span class="token plain"> </span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">createElement</span><span class="token punctuation">(</span><span class="token plain">element</span><span class="token punctuation">.</span><span class="token property-access">type</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> children </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> element</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  children</span><span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token parameter">child</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token function">render</span><span class="token punctuation">(</span><span class="token plain">child</span><span class="token punctuation">,</span><span class="token plain"> dom</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  rootDom</span><span class="token punctuation">.</span><span class="token method function property-access">appendChild</span><span class="token punctuation">(</span><span class="token plain">dom</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p>æ­¤æ—¶ï¼Œç¨‹åºå·²åˆå…·é›å½¢ï¼Œä½†ä»»æ— æ³•è¿è¡Œï¼Œå› ä¸º children ç±»å‹å­˜åœ¨å¯¹è±¡å’Œå­—ç¬¦ä¸²ï¼Œæ‰€ä»¥éœ€è¦åˆ¤æ–­ type ä»¥ä½¿ç”¨ä¸åŒæ–¹å¼åˆ›å»º DOM èŠ‚ç‚¹ï¼Œå¹¶åœ¨åˆé€‚æ—¶æœºé€’å½’è°ƒç”¨ renderï¼Œä¿®æ”¹åä»£ç å¦‚ä¸‹ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">element</span><span class="token parameter punctuation">,</span><span class="token parameter"> rootDom</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> dom </span><span class="token operator">=</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    element</span><span class="token punctuation">.</span><span class="token property-access">type</span><span class="token plain"> </span><span class="token operator">===</span><span class="token plain"> </span><span class="token string">&#x27;TEXT_ELEMENT&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token operator">?</span><span class="token plain"> </span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">createTextNode</span><span class="token punctuation">(</span><span class="token plain">element</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">.</span><span class="token property-access">text</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token operator">:</span><span class="token plain"> </span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">createElement</span><span class="token punctuation">(</span><span class="token plain">element</span><span class="token punctuation">.</span><span class="token property-access">type</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> props</span><span class="token operator">:</span><span class="token plain"> elProps </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> element</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">/**</span></div><div class="token-line"><span class="token comment">   * Assign all the values in props to the DOM as properties</span></div><div class="token-line"><span class="token comment">   * å°† props ä¸­çš„æ‰€æœ‰å€¼ï¼Œä½œä¸ºå±æ€§èµ‹å€¼ç»™ DOM</span></div><div class="token-line"><span class="token comment">   * */</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token known-class-name class-name">Object</span><span class="token punctuation">.</span><span class="token method function property-access">keys</span><span class="token punctuation">(</span><span class="token plain">elProps</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">name </span><span class="token operator">!==</span><span class="token plain"> </span><span class="token string">&#x27;children&#x27;</span><span class="token plain"> </span><span class="token operator">&amp;&amp;</span><span class="token plain"> element</span><span class="token punctuation">.</span><span class="token property-access">type</span><span class="token plain"> </span><span class="token operator">!==</span><span class="token plain"> </span><span class="token string">&#x27;TEXT_ELEMENT&#x27;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      dom</span><span class="token punctuation">.</span><span class="token method function property-access">setAttribute</span><span class="token punctuation">(</span><span class="token plain">name</span><span class="token punctuation">,</span><span class="token plain"> elProps</span><span class="token punctuation">[</span><span class="token plain">name</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> children </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> elProps</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token known-class-name class-name">Array</span><span class="token punctuation">.</span><span class="token method function property-access">isArray</span><span class="token punctuation">(</span><span class="token plain">children</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    children</span><span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token parameter">child</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token function">render</span><span class="token punctuation">(</span><span class="token plain">child</span><span class="token punctuation">,</span><span class="token plain"> dom</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  rootDom</span><span class="token punctuation">.</span><span class="token method function property-access">appendChild</span><span class="token punctuation">(</span><span class="token plain">dom</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><blockquote><p>æˆ‘ä»¬è¿™é‡Œå¿½ç•¥äº† children ä¸ºæ•°ç»„çš„æƒ…å†µã€‚</p></blockquote><p>å®Œæ•´ä»£ç å±•ç¤ºå¦‚ä¸‹ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token parameter">type</span><span class="token parameter punctuation">,</span><span class="token parameter"> props</span><span class="token parameter punctuation">,</span><span class="token parameter"> </span><span class="token parameter operator">...</span><span class="token parameter">children</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    type</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    props</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token spread operator">...</span><span class="token plain">props</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      children</span><span class="token operator">:</span><span class="token plain"> children</span><span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">child</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword">typeof</span><span class="token plain"> child </span><span class="token operator">===</span><span class="token plain"> </span><span class="token string">&#x27;object&#x27;</span><span class="token plain"> </span><span class="token operator">?</span><span class="token plain"> child </span><span class="token operator">:</span><span class="token plain"> </span><span class="token function">createTextElement</span><span class="token punctuation">(</span><span class="token plain">child</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">createTextElement</span><span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    type</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;TEXT_ELEMENT&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    props</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      children</span><span class="token operator">:</span><span class="token plain"> text</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      text</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">element</span><span class="token parameter punctuation">,</span><span class="token parameter"> rootDom</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> dom </span><span class="token operator">=</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    element</span><span class="token punctuation">.</span><span class="token property-access">type</span><span class="token plain"> </span><span class="token operator">===</span><span class="token plain"> </span><span class="token string">&#x27;TEXT_ELEMENT&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token operator">?</span><span class="token plain"> </span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">createTextNode</span><span class="token punctuation">(</span><span class="token plain">element</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">.</span><span class="token property-access">text</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token operator">:</span><span class="token plain"> </span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">createElement</span><span class="token punctuation">(</span><span class="token plain">element</span><span class="token punctuation">.</span><span class="token property-access">type</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> props</span><span class="token operator">:</span><span class="token plain"> elProps </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> element</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">/**</span></div><div class="token-line"><span class="token comment">   * Assign all the values in props to the DOM as properties</span></div><div class="token-line"><span class="token comment">   * å°† props ä¸­çš„æ‰€æœ‰å€¼ï¼Œä½œä¸ºå±æ€§èµ‹å€¼ç»™ DOM</span></div><div class="token-line"><span class="token comment">   * */</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token known-class-name class-name">Object</span><span class="token punctuation">.</span><span class="token method function property-access">keys</span><span class="token punctuation">(</span><span class="token plain">elProps</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">name </span><span class="token operator">!==</span><span class="token plain"> </span><span class="token string">&#x27;children&#x27;</span><span class="token plain"> </span><span class="token operator">&amp;&amp;</span><span class="token plain"> element</span><span class="token punctuation">.</span><span class="token property-access">type</span><span class="token plain"> </span><span class="token operator">!==</span><span class="token plain"> </span><span class="token string">&#x27;TEXT_ELEMENT&#x27;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      dom</span><span class="token punctuation">.</span><span class="token method function property-access">setAttribute</span><span class="token punctuation">(</span><span class="token plain">name</span><span class="token punctuation">,</span><span class="token plain"> elProps</span><span class="token punctuation">[</span><span class="token plain">name</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> children </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> elProps</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token known-class-name class-name">Array</span><span class="token punctuation">.</span><span class="token method function property-access">isArray</span><span class="token punctuation">(</span><span class="token plain">children</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    children</span><span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token parameter">child</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token function">render</span><span class="token punctuation">(</span><span class="token plain">child</span><span class="token punctuation">,</span><span class="token plain"> dom</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  rootDom</span><span class="token punctuation">.</span><span class="token method function property-access">appendChild</span><span class="token punctuation">(</span><span class="token plain">dom</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> </span><span class="token maybe-class-name">HeReact</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  createElement</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  render</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment">/** @jsx HeReact.createElement */</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> element </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token operator">&lt;</span><span class="token plain">div title</span><span class="token operator">=</span><span class="token string">&quot;header&quot;</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token operator">&lt;</span><span class="token plain">p title</span><span class="token operator">=</span><span class="token string">&quot;n1&quot;</span><span class="token operator">&gt;</span><span class="token plain">n1 text</span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token plain">p</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token plain">div</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token maybe-class-name">HeReact</span><span class="token punctuation">.</span><span class="token method function property-access">render</span><span class="token punctuation">(</span><span class="token plain">element</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">&#x27;app&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>ä»¥ä¸Š @jsx æ³¨é‡Šä»£ç ï¼Œä½¿ç”¨ @babel/plugin-transform-react-jsx å³å¯å®Œæˆè½¬åŒ–ã€‚ç®€å•æç¤ºå¦‚ä¸‹ï¼š</p><ol><li>ä½¿ç”¨ CLI æ–¹å¼å®‰è£… babelï¼š<code>npm install --save-dev @babel/core @babel/cli</code></li><li>å®‰è£…å¹¶é…ç½® transform-react-jsx æ’ä»¶ï¼š<code>npm install --save-dev @babel/plugin-transform-react-jsx</code>ï¼Œ.babelrc ä¸­é…ç½® <code>{<!-- --> &quot;plugins&quot;: [&quot;@babel/plugin-transform-react-jsx&quot;] <!-- -->}</code></li><li>è½¬æ¢ä»£ç ï¼š<code>npx babel index.js --out-file index.prod.js</code></li></ol><h2 id="scheduler"><a aria-hidden="true" tabindex="-1" href="/enhanfe//advanced/buildownreact#scheduler"><span class="icon icon-link"></span></a>Scheduler</h2><p>æˆ‘ä»¬å¯¹è®¡ç®—æœºç³»ç»Ÿä¸­çš„ CPU è°ƒåº¦å¯èƒ½å¹¶ä¸é™Œç”Ÿï¼Œæˆ‘ä»¬æœŸæœ› CPU èƒ½å¤Ÿæœ€å¤§èƒ½åŠ›æ‰§è¡Œä»»åŠ¡ï¼Œè¿™å°±éœ€è¦åè°ƒèµ„æºä»è€Œå……åˆ†åˆ©ç”¨ã€‚åœ¨ React ä¸­ï¼Œæˆ‘ä»¬ä¹ŸæœŸæœ›å®ç°è¿™æ ·ä¸€ä¸ªè°ƒåº¦ç³»ç»Ÿï¼Œåœ¨åˆé€‚æ—¶æœºå»æ›´æ–°è§†å›¾ã€‚</p><p>é€šå¸¸ï¼Œéœ€è¦è§¦å‘è§†å›¾æ›´æ–°çš„æ“ä½œæœ‰ä»¥ä¸‹å‡ ç§ï¼š</p><ol><li>ç”¨æˆ·è¾“å…¥</li><li>åŠ¨ç”»</li><li>æ•°æ®æ›´æ–°</li></ol><p>ä»¥ä¸Šä¸‰ç§ä¸ºè§†å›¾æ›´æ–°è¿‡ç¨‹ä¸­çš„ä¼˜å…ˆçº§é¡ºåºï¼Œæˆ‘ä»¬æœŸæœ›æŒ‰ç…§è¿™ä¸ªé¡ºåºæ‰§è¡Œè§†å›¾æ›´æ–°ï¼Œå› æ­¤éœ€è¦å®šä¹‰æ›´æ–°ä¼˜å…ˆçº§è§„åˆ™ã€‚è¿™ä¸ªè¿‡ç¨‹æˆ‘ä»¬ç§°ä¸ºè°ƒåº¦ï¼ˆscheduleï¼‰ï¼Œè¿™æ˜¯åœ¨ React 16 ä¸­é¢å¤–åŠ å…¥çš„ã€‚</p><p>åœ¨ React 15 ä¸­ï¼ŒReact æ¶æ„å¯å½’çº³ä¸ºï¼š</p><ol><li>Reconcilerï¼ˆåè°ƒå™¨ï¼‰â€”â€” æ ‡è®°å˜åŒ–ç»„ä»¶</li><li>Rendererï¼ˆæ¸²æŸ“å™¨ï¼‰â€”â€” å°†å˜åŒ–ç»„ä»¶å¤„ç†å¹¶æ¸²æŸ“åˆ°é¡µé¢ä¸Š</li></ol><p>è€Œåœ¨ React 16 ä¸­ï¼Œä¸ºäº†ä¼˜åŒ–æ€§èƒ½ï¼Œæ›´å¤§ç¨‹åº¦ä½¿ç”¨èµ„æºï¼Œè°ƒæ•´æ¶æ„å¦‚ä¸‹ï¼š</p><ol><li>Schedulerï¼ˆè°ƒåº¦å™¨ï¼‰â€”â€” è°ƒåº¦ä»»åŠ¡çš„ä¼˜å…ˆçº§ï¼Œé«˜ä¼˜ä»»åŠ¡ä¼˜å…ˆè¿›å…¥ Reconciler</li><li>Reconcilerï¼ˆåè°ƒå™¨ï¼‰â€”â€” æ ‡è®°å˜åŒ–çš„ç»„ä»¶</li><li>Rendererï¼ˆæ¸²æŸ“å™¨ï¼‰â€”â€” å°†å˜åŒ–çš„ç»„ä»¶æ¸²æŸ“åˆ°é¡µé¢ä¸Š</li></ol><p>åœ¨ React 15 ä¸­ä½¿ç”¨ <code>Stack Reconcilationï¼ˆæ ˆè°ƒå’Œå™¨ï¼‰</code> æœ€å¤§çš„ç¼ºé™·æ˜¯è°ƒå’Œè¿‡ç¨‹ä¸å¯ä¸­æ–­ï¼Œä»è€Œå¯¼è‡´çº¿ç¨‹é˜»å¡ï¼Œé€ æˆåŠ¨ç”»å¡é¡¿ã€ç”¨æˆ·è¾“å…¥åé¦ˆè¿Ÿé’ç­‰é—®é¢˜ã€‚åœ¨æµè§ˆå™¨ä¸­çš„ js æ²¡æœ‰è¿›ç¨‹çš„æ¦‚å¿µï¼Œæˆ‘ä»¬åªæœ‰ä»ä¾§é¢å®ŒæˆæŠ¢å èµ„æºè¿™ä¸€æ“ä½œã€‚</p><p>React 16 ä¸­ï¼Œè°ƒåº¦ç›¸å…³å†…å®¹å•ç‹¬å‘å¸ƒä¸º Scheduler åŒ…ï¼Œåœ¨æ—©æœŸï¼Œè°ƒåº¦æ—¶é—´åˆ†ç‰‡ä½¿ç”¨è®¡ç®— <strong>expirationTime</strong> å®ç°ï¼Œä½†è¿™ç§æ–¹å¼çš„ç¼ºé™·æ—¥ç›Šæ˜æ˜¾ï¼Œå› æ­¤é‡æ„ä½¿ç”¨äº† <strong>lane</strong> æ¨¡å‹æ›¿æ¢äº† expirationTime çš„æ–¹å¼ã€‚</p><p>ç”±äºè°ƒåº¦å®ç°ç•¥å¾®å¤æ‚ï¼Œå¹¶ä¸”æ—©æœŸ React å›¢é˜Ÿè€ƒè™‘äº†ä½¿ç”¨è¾ƒä¸ºç®€å•çš„åšæ³•ï¼ˆrequestIdleCallbackï¼‰å®ç°ï¼Œæˆ‘ä»¬å°†ä»¥è¿™ç§è¾ƒä¸ºç®€å•çš„æ–¹å¼å®ç°ã€‚</p><blockquote><p>è€ƒè™‘æ–¹æ¡ˆæ™®é€‚æ€§ä¸å¥å£®æ€§ï¼Œæˆ‘ä»¬å°†ä»¥ä¸Šæåˆ°çš„è°ƒåº¦æ–¹æ¡ˆè¿›è¡Œæ’åºï¼šlane &gt; expirationTime &gt; requestIdleCallback</p></blockquote><p>requestIdleCallback æ–¹æ³•å’Œæˆ‘ä»¬å¸¸è§çš„ setTimeout æˆ–è€… requestAnimationFrame ç±»ä¼¼ï¼Œä¸åŒçš„æ˜¯ï¼ŒrequestIdleCallback æ–¹æ³•å¯ä»¥åœ¨æµè§ˆå™¨ä¸»çº¿ç¨‹ç©ºé—²æ—¶è°ƒç”¨ï¼Œä»¥æ­¤å®ç°èµ„æºæŠ¢å ã€‚</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">workLoop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// ...</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">requestIdleCallback</span><span class="token punctuation">(</span><span class="token plain">workLoop</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">â€‹</span></div><div class="token-line"><span class="token plain"></span><span class="token function">requestIdleCallback</span><span class="token punctuation">(</span><span class="token plain">workLoop</span><span class="token punctuation">)</span></div></pre></div><p>å½“æµè§ˆå™¨ä¸»çº¿ç¨‹ç©ºé—²æ—¶é—´ï¼Œåˆ™ä¼šå°è¯•è°ƒç”¨ workLoop æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¸­å®Œæˆ React ç»„ä»¶æ›´æ–°ä¼˜å…ˆçº§çš„è¯„åˆ¤ï¼Œå¹¶ä¸”åœ¨éœ€è¦çš„æ—¶ï¼Œæš‚åœå½“å‰æ›´æ–°ä»¥æ‰§è¡Œæ›´ç´§æ€¥çš„ä»»åŠ¡ï¼Œç´§æ€¥ä»»åŠ¡æ‰§è¡Œå®Œåï¼Œä¼šå›åˆ°ä¸­æ–­ç‚¹ç»§ç»­æ‰§è¡Œä¹‹å‰æš‚åœä»»åŠ¡ã€‚</p><p>æˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ªé“¾è¡¨ï¼Œç”¨äºå­˜å‚¨éœ€è¦æ‰§è¡Œçš„ä»»åŠ¡ï¼Œæˆ‘ä»¬å°†è¯¥é“¾è¡¨å®šä¹‰ä¸º nextUnitOfWorkï¼Œåˆå§‹å€¼ä¸ºç©ºã€‚å½“æµè§ˆå™¨ç©ºé—²ï¼Œåˆ™ä¼šæ£€æŸ¥é“¾è¡¨æ˜¯å¦æœ‰ï¼Œæœ‰åˆ™éœ€è¦æ‰§è¡Œå¤„ç†å¹¶æ›´æ–°è§†å›¾ï¼Œæ”¹è¿›åä»£ç å¦‚ä¸‹ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">let</span><span class="token plain"> nextUnitOfWork </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword null nil">null</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">workLoop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword control-flow">while</span><span class="token punctuation">(</span><span class="token plain">nextUnitOfWork</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    nextUnitOfWork </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">performUnitOfWork</span><span class="token punctuation">(</span><span class="token plain">nextUnitOfWork</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">requestIdleCallback</span><span class="token punctuation">(</span><span class="token plain">workLoop</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">â€‹</span></div><div class="token-line"><span class="token plain"></span><span class="token function">requestIdleCallback</span><span class="token punctuation">(</span><span class="token plain">workLoop</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">performUnitOfWork</span><span class="token punctuation">(</span><span class="token parameter">nextUnitOfWork</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">//...</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p>ä½†æˆ‘ä»¬å‘ç°ï¼Œè¿™é‡Œ performUnitOfWork æ˜¯æ— æ³•ä¸­æ–­çš„ï¼Œæ€ä¹ˆæ”¹è¿›å‘¢ï¼Ÿå…¶å®å¾ˆç®€å•ï¼ŒåŠ ä¸€ä¸ªéœ€è¦ä¸­æ–­çš„æ ‡è¯†ï¼Œå®šä¹‰ä¸€ä¸ªåˆ¤æ–­æ˜¯å¦éœ€è¦ä¸­æ–­çš„æ–¹æ³•ï¼Œæ‰§è¡Œè¯¥æ–¹æ³•æ¥åšæ£€æµ‹ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment">// shouldYield</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">shouldYield</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// ...</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword control-flow">while</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">nextUnitOfWork</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token function">shouldYield</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">break</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  nextUnitOfWork </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">performUnitOfWork</span><span class="token punctuation">(</span><span class="token plain">nextUnitOfWork</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p>è¿™æ ·å°±èƒ½å®ç°ä¸­æ–­åŠŸèƒ½äº†ï¼Œåœ¨ React ä¸­ä½¿ç”¨ expirationTime æœºåˆ¶å®ç°ä¼˜å…ˆçº§ï¼Œå¹¶ä¸”ï¼Œå¾ˆå¤šé¢è¯•ä¸­ä¼šè€ƒå¯Ÿï¼ŒReact ä¸­ setState æ˜¯å¼‚æ­¥çš„å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</p><p>å…¶å®å°±æ˜¯å› ä¸º React ä¸­ expirationTime çš„è®¡ç®—æœºåˆ¶ï¼Œåœ¨ä¸€å®šèŒƒå›´ç±»è§¦å‘çš„æ›´æ–°ä»»åŠ¡ä¼šåˆå¹¶å¤„ç†ã€‚</p><p>ä¸ºäº†å®ç°ä»»åŠ¡åˆ‡ç‰‡ï¼ŒReact å¼•å…¥äº† Fiberã€‚</p><h2 id="fiber-æ¶æ„"><a aria-hidden="true" tabindex="-1" href="/enhanfe//advanced/buildownreact#fiber-æ¶æ„"><span class="icon icon-link"></span></a>Fiber æ¶æ„</h2><p>Fiber æ˜¯ä¸€ä¸ªæ•°æ®ç»“æ„ç”¨æ¥æè¿°ä»»åŠ¡ä¸èŠ‚ç‚¹ä¹‹é—´çš„å…³ç³»ï¼ŒFiber è¿˜æ˜¯ä¸€ç§æ¶æ„æ–¹æ¡ˆç”¨äºå®ç° React 16 çš„ Reconcilerã€‚</p><p>æˆ‘ä»¬å…ˆä»¥<strong>æ•°æ®ç»“æ„</strong>è§’åº¦åˆ†æ Fiberã€‚Fiber åƒä¸€æ£µæ ‘ï¼Œæ¯ä¸ªèŠ‚ç‚¹å‡å­˜å‚¨äº†ä¸ç›¸é‚»èŠ‚ç‚¹ä¹‹é—´çš„å…³ç³»ã€‚é€šå¸¸ä¸€ä¸ª Fiber èŠ‚ç‚¹éœ€è¦å­˜å‚¨è¿™äº›å…³ç³»ï¼š</p><ul><li>parent</li><li>child</li><li>sibling</li></ul><p>æœ‰äº†è¿™æ ·çš„æ•°æ®ç»“æ„ï¼Œä¸‹ä¸€ä¸ªæ‰§è¡Œå•å…ƒçš„æœå¯»ä¼šå˜å¾—æ›´ä¸ºç®€å• æ¯”å¦‚æˆ‘ä»¬ç°åœ¨æœ‰è¿™æ ·çš„é¡µé¢ç»“æ„ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-html"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token tag punctuation">&lt;</span><span class="token tag">div</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token tag punctuation">&lt;</span><span class="token tag">p</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token tag punctuation">&lt;</span><span class="token tag">span</span><span class="token tag punctuation">&gt;</span><span class="token tag punctuation">&lt;/</span><span class="token tag">span</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token tag punctuation">&lt;</span><span class="token tag">a</span><span class="token tag punctuation">&gt;</span><span class="token tag punctuation">&lt;/</span><span class="token tag">a</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token tag punctuation">&lt;/</span><span class="token tag">p</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token tag punctuation">&lt;/</span><span class="token tag">div</span><span class="token tag punctuation">&gt;</span></div></pre></div><p>å½“æˆ‘ä»¬ä» div å¼€å§‹æ—¶ï¼Œä¼šå°è¯•è®¿é—® div çš„å­èŠ‚ç‚¹ï¼Œä»¥æ­¤æ¥åˆ°äº† pï¼Œåœ¨ p èŠ‚ç‚¹å°è¯•è®¿é—®å­èŠ‚ç‚¹ï¼Œæ¥åˆ°äº† spanï¼Œ æ­¤æ—¶ span å·²ç„¶æ²¡æœ‰äº†å­å…ƒç´ ï¼Œåªå¾—è®¿é—®å…„å¼ŸèŠ‚ç‚¹ï¼Œäºæ˜¯æ¥åˆ°äº† aã€‚æ­¤æ—¶ a æ²¡æœ‰å­å…ƒç´ ï¼Œä¹Ÿæ²¡æœ‰å…„å¼Ÿå…ƒç´ ï¼Œåˆ™åªèƒ½å¾€ä¸Šåˆ°è¾¾çˆ¶èŠ‚ç‚¹ pï¼Œp å·²éå†å®Œæ‰€æœ‰åä»£ä¸”æ²¡æœ‰å…„å¼Ÿå…ƒç´ ï¼Œåˆ™ç»§ç»­é€šè¿‡ parent æ‰¾åˆ° divï¼Œæˆ‘ä»¬è¿™é‡Œçš„ div æ˜¯ root èŠ‚ç‚¹ï¼Œä¸å†ç½‘ä¸Šæœå¯»ï¼Œè‡³æ­¤å®Œæˆ æ‰€æœ‰ performUnitOfWork å·¥ä½œã€‚</p><p>è¿™é‡Œæˆ‘ä»¬éœ€è¦æ¸…æ¥šä¸€ç‚¹ï¼Œç»è¿‡ä»¥ä¸Šæ­¥éª¤åï¼Œæ‰ä¼šè¿›åˆ° renderï¼Œè¿›è¡Œé¡µé¢æ¸²æŸ“ï¼Œå°±åƒæˆ‘ä»¬å‰é¢æåˆ°çš„ React 16 æ¶æ„ï¼šScheduler -&gt; Reconciler -&gt; Rendererã€‚é¦–å…ˆè°ƒæ•´ render ä¸­çš„ä»£ç ï¼Œè¿˜è®°å¾—ä¹‹å‰çš„ nextUnitOfWork å—ï¼Ÿåœ¨åˆå§‹åŒ–çš„æ—¶å€™ï¼Œä¹Ÿå°±æ˜¯åœ¨æˆ‘ä»¬è°ƒç”¨ render å‡½æ•°çš„æ—¶å€™ï¼Œé¦–æ¬¡å°† nextUnitOfWork è®¾ç½®ä¸ºå¦‚ä¸‹ç»“æ„ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">element</span><span class="token parameter punctuation">,</span><span class="token parameter"> dom</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  nextUnitOfWork </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    dom</span><span class="token operator">:</span><span class="token plain"> container</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    props</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      children</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain">element</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p>è¿™é‡Œå¯ä»¥çœ‹åˆ°çš„å¯¹è±¡ï¼Œå°±æ˜¯ç®€åŒ–åçš„ Fiberï¼Œå…¶ä¸­åŒ…å«äº†å½“å‰ unitOfWork å¯¹åº”çš„ domï¼Œä»¥åŠ props ç­‰ä¿¡æ¯ï¼Œå½“ç„¶ React ä¸­çš„ Fiber ç»“æ„æ¯”è¿™æ›´å¤æ‚ï¼Œæˆ‘ä»¬é€æ­¥å®Œå–„ã€‚</p><h2 id="render-commit--reconciliation"><a aria-hidden="true" tabindex="-1" href="/enhanfe//advanced/buildownreact#render-commit--reconciliation"><span class="icon icon-link"></span></a>Render Commit &amp; Reconciliation</h2><p>æœ‰äº† Fiber ç»“æ„ï¼Œæˆ‘ä»¬æ¥æ”¹å†™ performUnitOfWork æ–¹æ³•ã€‚é€šå¸¸ï¼Œæˆ‘ä»¬éœ€è¦å°†ç»„ä»¶è¿›è¡Œåˆ†ç±»ï¼Œæ¯”å¦‚å±äºæµè§ˆå™¨çš„<strong>å®¿ä¸»ç»„ä»¶</strong>ï¼ˆdivã€pï¼‰æ›´æ–°ï¼Œå†æ¯”å¦‚æˆ‘ä»¬è‡ªå®šä¹‰çš„å‡½æ•°ç»„ä»¶ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡ Fiber çš„ type å±æ€§åŒºåˆ†ï¼Œæœ¬ä¾‹ä»¥è¿™ä¸¤ç§ç»„ä»¶çš„æ›´æ–°ä¸ºä¾‹ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">performUnitOfWork</span><span class="token punctuation">(</span><span class="token parameter">fiber</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">/**</span></div><div class="token-line"><span class="token comment">   * Determines whether it is a functional component or a browser native tag component</span></div><div class="token-line"><span class="token comment">   * åˆ¤æ–­æ˜¯å‡½æ•°ç»„ä»¶ï¼Œè¿˜æ˜¯æµè§ˆå™¨åŸç”Ÿæ ‡ç­¾ç»„ä»¶</span></div><div class="token-line"><span class="token comment">   * */</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> isFunctionComponent </span><span class="token operator">=</span><span class="token plain"> fiber</span><span class="token punctuation">.</span><span class="token property-access">type</span><span class="token plain"> </span><span class="token keyword">instanceof</span><span class="token plain"> </span><span class="token class-name">Function</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">/**</span></div><div class="token-line"><span class="token comment">   * Depending on the type, different update methods are called</span></div><div class="token-line"><span class="token comment">   * æ ¹æ®ä¸åŒç±»å‹ï¼Œè°ƒç”¨ä¸åŒæ›´æ–°æ–¹æ³•</span></div><div class="token-line"><span class="token comment">   * */</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">isFunctionComponent</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">updateFunctionComponent</span><span class="token punctuation">(</span><span class="token plain">fiber</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword control-flow">else</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">updateHostComponent</span><span class="token punctuation">(</span><span class="token plain">fiber</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">/**</span></div><div class="token-line"><span class="token comment">   * Return to the next unitOfWork</span></div><div class="token-line"><span class="token comment">   * è¿”å›ä¸‹ä¸€ä¸ª unitOfWork</span></div><div class="token-line"><span class="token comment">   * */</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">fiber</span><span class="token punctuation">.</span><span class="token property-access">child</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">return</span><span class="token plain"> fiber</span><span class="token punctuation">.</span><span class="token property-access">child</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">/**</span></div><div class="token-line"><span class="token comment">   * If there is no point of its own, you need to follow the lookup we analyzed earlier up to the root level</span></div><div class="token-line"><span class="token comment">   * å¦‚æœæ²¡æœ‰è‡ªå·±ç‚¹ï¼Œåˆ™éœ€è¦æŒ‰ç…§æˆ‘ä»¬å‰é¢åˆ†æçš„æŸ¥æ‰¾é€çº§å¾€ä¸Šç›´åˆ° root</span></div><div class="token-line"><span class="token comment">   * */</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">let</span><span class="token plain"> nextFiber </span><span class="token operator">=</span><span class="token plain"> fiber</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword control-flow">while</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">nextFiber</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">nextFiber</span><span class="token punctuation">.</span><span class="token property-access">sibling</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword control-flow">return</span><span class="token plain"> nextFiber</span><span class="token punctuation">.</span><span class="token property-access">sibling</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    nextFiber </span><span class="token operator">=</span><span class="token plain"> nextFiber</span><span class="token punctuation">.</span><span class="token property-access">parent</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">updateFunctionComponent</span><span class="token punctuation">(</span><span class="token parameter">fiber</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">/*TODO*/</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">updateHostComponent</span><span class="token punctuation">(</span><span class="token parameter">fiber</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">/*TODO*/</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p>ç°åœ¨å›åˆ° render å‡½æ•°å®šä¹‰ï¼Œæˆ‘ä»¬éœ€è¦ä»‹ç»å¦ä¸€ä¸ª React æ ¸å¿ƒæ€æƒ³ï¼š<strong>åŒç¼“å­˜</strong>ã€‚é€šå¸¸ï¼Œæˆ‘ä»¬ä¸ºäº†æå‡è®¡ç®—æ€§èƒ½ï¼Œä¼šå°†è®¡ç®—çš„è¿‡ç¨‹å†å†…å­˜ä¸­è¿›è¡Œï¼Œè®¡ç®—å¾—åˆ°ç»“æœåï¼Œä¸€æ¬¡æ€§å°†ç»“æœæ¸²æŸ“åˆ°é¡µé¢ï¼Œè¿™æ ·çš„æœºåˆ¶æˆ‘ä»¬ç§°ä¸ºåŒç¼“å­˜ã€‚å‰é¢æˆ‘ä»¬æåˆ°ï¼ŒReact åº”ç”¨åœ¨è°ƒåº¦è¿‡ç¨‹ï¼Œå€ŸåŠ© nextUnitOfWork è¿›è¡Œ workLoop éå†ï¼Œä¸æ­¤åŒæ—¶è¿˜æœ‰å¦å¤–ä¸€ä¸ªå˜é‡ï¼Œç”¨äºå¤‡ä»½ nextUnitOfWork ï¼Œæˆ‘ä»¬ä¸”å°†è¿™ä¸ªå˜é‡å®šä¹‰ä¸º wipRootï¼Œä¸ä¹‹å½¢æˆåŒç¼“å­˜æœºåˆ¶çš„å˜é‡æˆ‘ä»¬å®šä¹‰ä¸º currentRootï¼Œé‚£ä¹ˆåœ¨åº”ç”¨åˆæ¬¡æ¸²æŸ“æ—¶ï¼Œä¸ºè¯¥å˜é‡èµ‹å€¼ã€‚æˆ‘ä»¬çœ‹æ”¹è¿›åçš„ render å‡½æ•°ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">element</span><span class="token parameter punctuation">,</span><span class="token parameter"> dom</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  wipRoot </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    dom</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    props</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      children</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain">element</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  nextUnitOfWork </span><span class="token operator">=</span><span class="token plain"> wipRoot</span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">â€‹</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">let</span><span class="token plain"> nextUnitOfWork </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword null nil">null</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">let</span><span class="token plain"> wipRoot </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword null nil">null</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">let</span><span class="token plain"> currentRoot </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword null nil">null</span><span class="token punctuation">;</span></div></pre></div><p>æˆ‘ä»¬å·²ç»æ¸…æ¥šï¼Œå½“ nextUnitOfWork ä¸ºç©ºæ—¶ï¼Œè¡¨ç¤ºå·²å°†è§¦å‘æ›´æ–°åéœ€è¦æ›´æ–°çš„èŠ‚ç‚¹éå†å®Œæˆï¼Œè¿™æ˜¯å°±éœ€è¦å°† reconcile çš„ç»“æœæ¸²æŸ“åˆ°é¡µé¢ã€‚æ¸²æŸ“çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬å•ç‹¬å®šä¹‰åœ¨ <code>commitRoot</code> å‡½æ•°ä¸­ã€‚commitRoot å‡½æ•°å…¶å®å¾ˆç®€å•ï¼Œè°ƒç”¨ commitWork ç”¨äºå°†æ¯ä¸ªèŠ‚ç‚¹å•å…ƒæ¸²æŸ“è‡³é¡µé¢è¿™ä¸ªå‡½æ•°åœ¨ workLoop ä¸­è°ƒç”¨ï¼Œå‰ææ¡ä»¶æ­£æ˜¯ nextUnitOfWork ä¸ºç©ºå¹¶ä¸” wipRoot å­˜åœ¨ã€‚ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">commitRoot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// TODO</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">workLoop</span><span class="token punctuation">(</span><span class="token parameter">deadline</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// ...</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token plain">nextUnitOfWork </span><span class="token operator">&amp;&amp;</span><span class="token plain"> wipRoot</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">commitRoot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// ...</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p>æ¥ä¸‹æ¥ï¼Œå¤„ç† commitRootï¼Œè¯¥å‡½æ•°æ˜¯æäº¤æ›´æ–°çš„å…¥å£ï¼Œå„èŠ‚ç‚¹æ›´æ–°æˆ‘ä»¬å®šä¹‰ commitWork å®ç°ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">commitRoot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">commitWork</span><span class="token punctuation">(</span><span class="token plain">wipRoot</span><span class="token punctuation">.</span><span class="token property-access">child</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  wipRoot </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword null nil">null</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">â€‹</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">commitWork</span><span class="token punctuation">(</span><span class="token parameter">fiber</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token plain">fiber</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">return</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> domParent </span><span class="token operator">=</span><span class="token plain"> fiber</span><span class="token punctuation">.</span><span class="token property-access">parent</span><span class="token punctuation">.</span><span class="token property-access">dom</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  domParent</span><span class="token punctuation">.</span><span class="token method function property-access">appendChild</span><span class="token punctuation">(</span><span class="token plain">fiber</span><span class="token punctuation">.</span><span class="token property-access">dom</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">/**</span></div><div class="token-line"><span class="token comment">   * Recursively traverse the nodes that need to be updated</span></div><div class="token-line"><span class="token comment">   * é€’å½’éå†éœ€è¦æ›´æ–°çš„èŠ‚ç‚¹</span></div><div class="token-line"><span class="token comment">   * */</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">commitWork</span><span class="token punctuation">(</span><span class="token plain">fiber</span><span class="token punctuation">.</span><span class="token property-access">child</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">commitWork</span><span class="token punctuation">(</span><span class="token plain">fiber</span><span class="token punctuation">.</span><span class="token property-access">sibling</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p>ä»‹ç»äº†æ•´ä½“å†…å®¹ï¼Œæˆ‘ä»¬å›åˆ°è°ƒå’Œè¿‡ç¨‹ã€‚è°ƒå’Œå…¶å®å°±æ˜¯ä¸ºæ¯ä¸ªèŠ‚ç‚¹ Fiber æ‰“æ ‡ç­¾ï¼Œå“ªä¸ªæ›´æ”¹äº†ï¼Ÿå“ªä¸ªåˆ é™¤äº†ï¼Ÿå“ªä¸ªæ›¿æ¢äº†ï¼Ÿè¿™äº›æƒ…å†µå‡ä¼šåœ¨éå†åˆ°æ¯ä¸ªèŠ‚ç‚¹æ—¶ï¼Œæ ‡è®°åˆ° Fiber çš„ effectTag ä¸Šï¼Œæœ€ååœ¨ commitWork ä¸­ä¼šæ ¹æ®è¿™äº› effectTag è¿›è¡Œæ¸²æŸ“å¤„ç†ã€‚æˆ‘ä»¬å…ˆæ¥çœ‹æ™®é€šå®¿ä¸»ç»„ä»¶çš„æ›´æ–° reconcile å¤„ç†ã€‚æ™®é€šå®¿ä¸»ç»„ä»¶çš„ reconcile å¤„ç†å…¥å£ä¸º updateHostComponentï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">updateHostComponent</span><span class="token punctuation">(</span><span class="token parameter">fiber</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token plain">fiber</span><span class="token punctuation">.</span><span class="token property-access">dom</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    fiber</span><span class="token punctuation">.</span><span class="token property-access">dom</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">createDom</span><span class="token punctuation">(</span><span class="token plain">fiber</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">reconcileChildren</span><span class="token punctuation">(</span><span class="token plain">fiber</span><span class="token punctuation">,</span><span class="token plain"> fiber</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">.</span><span class="token property-access">children</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">reconcileChildren</span><span class="token punctuation">(</span><span class="token parameter">wipFiber</span><span class="token parameter punctuation">,</span><span class="token parameter"> elements</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token punctuation">}</span></div></pre></div><p>å¯¹äºå­èŠ‚ç‚¹çš„éå†ï¼Œæˆ‘ä»¬é€šè¿‡ Fiber ä¸Šçš„ç¼“å­˜ä¿¡æ¯è·å–ï¼Œä¹Ÿå°±æ˜¯ alternateï¼Œè·å–åˆ°ä»¥åï¼Œéå†æ‰€æœ‰å­èŠ‚ç‚¹ï¼Œå®Œæˆæ¯”å¯¹ã€‚reconcileChildren å‡½æ•°ä¸­å®šä¹‰ç±»å‹å¯¹æ¯”è§„åˆ™ï¼Œä»¥åŠç”Ÿæˆæ–°çš„ Fiberã€‚</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">reconcileChildren</span><span class="token punctuation">(</span><span class="token parameter">wipFiber</span><span class="token parameter punctuation">,</span><span class="token parameter"> elements</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">let</span><span class="token plain"> index </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">let</span><span class="token plain"> oldFiber </span><span class="token operator">=</span><span class="token plain"> wipFiber</span><span class="token punctuation">.</span><span class="token property-access">alternate</span><span class="token plain"> </span><span class="token operator">&amp;&amp;</span><span class="token plain"> wipFiber</span><span class="token punctuation">.</span><span class="token property-access">alternate</span><span class="token punctuation">.</span><span class="token property-access">child</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">let</span><span class="token plain"> prevSibling </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword null nil">null</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword control-flow">while</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">index </span><span class="token operator">&lt;</span><span class="token plain"> elements</span><span class="token punctuation">.</span><span class="token property-access">length</span><span class="token plain"> </span><span class="token operator">||</span><span class="token plain"> oldFiber </span><span class="token operator">!=</span><span class="token plain"> </span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> element </span><span class="token operator">=</span><span class="token plain"> elements</span><span class="token punctuation">[</span><span class="token plain">index</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">let</span><span class="token plain"> newFiber </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword null nil">null</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> sameType </span><span class="token operator">=</span><span class="token plain"> oldFiber </span><span class="token operator">&amp;&amp;</span><span class="token plain"> element </span><span class="token operator">&amp;&amp;</span><span class="token plain"> element</span><span class="token punctuation">.</span><span class="token property-access">type</span><span class="token plain"> </span><span class="token operator">==</span><span class="token plain"> oldFiber</span><span class="token punctuation">.</span><span class="token property-access">type</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">sameType</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      newFiber </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        type</span><span class="token operator">:</span><span class="token plain"> oldFiber</span><span class="token punctuation">.</span><span class="token property-access">type</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        props</span><span class="token operator">:</span><span class="token plain"> element</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        dom</span><span class="token operator">:</span><span class="token plain"> oldFiber</span><span class="token punctuation">.</span><span class="token property-access">dom</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        parent</span><span class="token operator">:</span><span class="token plain"> wipFiber</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        alternate</span><span class="token operator">:</span><span class="token plain"> oldFiber</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        effectTag</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;UPDATE&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">element </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token operator">!</span><span class="token plain">sameType</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      newFiber </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        type</span><span class="token operator">:</span><span class="token plain"> element</span><span class="token punctuation">.</span><span class="token property-access">type</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        props</span><span class="token operator">:</span><span class="token plain"> element</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        dom</span><span class="token operator">:</span><span class="token plain"> </span><span class="token keyword null nil">null</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        parent</span><span class="token operator">:</span><span class="token plain"> wipFiber</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        alternate</span><span class="token operator">:</span><span class="token plain"> </span><span class="token keyword null nil">null</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        effectTag</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;PLACEMENT&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">oldFiber </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token operator">!</span><span class="token plain">sameType</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      oldFiber</span><span class="token punctuation">.</span><span class="token property-access">effectTag</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string">&#x27;DELETION&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      deletions</span><span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="token plain">oldFiber</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">oldFiber</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      oldFiber </span><span class="token operator">=</span><span class="token plain"> oldFiber</span><span class="token punctuation">.</span><span class="token property-access">sibling</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">index </span><span class="token operator">===</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      wipFiber</span><span class="token punctuation">.</span><span class="token property-access">child</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> newFiber</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword control-flow">else</span><span class="token plain"> </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">element</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      prevSibling</span><span class="token punctuation">.</span><span class="token property-access">sibling</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> newFiber</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    prevSibling </span><span class="token operator">=</span><span class="token plain"> newFiber</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    index</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p>æ˜ å…¥çœ¼å¸˜çš„æ˜¯ index è¿™ä¸ªå˜é‡ï¼Œæˆ‘ä»¬çŸ¥é“ React åœ¨éå†ç”Ÿæˆå­ç»„ä»¶æ—¶ï¼Œéƒ½éœ€è¦æŒ‡å®š key ä»¥æé«˜æ¯”å¯¹æ€§èƒ½ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ index æ¥æ¨¡æ‹Ÿè¿™ä¸ªè¿‡ç¨‹ã€‚ è¿™é‡Œå¯ä»¥æ¸…æ™°çœ‹åˆ°ï¼Œåœ¨å¯¹æ¯”äº† child åï¼Œä¼šæ ¹æ®å¯¹æ¯”ç»“æœï¼Œç”Ÿæˆå¯¹åº”æ–°çš„ Fiberï¼Œæ¯ä¸ª Fiber ä¸­éƒ½ç»™å®šäº†éœ€è¦å¯¹èŠ‚ç‚¹åšå‡ºä»€ä¹ˆå¤„ç†ï¼š</p><ul><li>UPDATEï¼šè¯´æ˜èŠ‚ç‚¹å¯å¤ç”¨ï¼ŒFiber ä¸­çš„ alternate å¯ä»¥æŒ‡å‘ä¸Šä¸€æ¬¡èŠ‚ç‚¹æ‰€å¯¹åº” Fiber</li><li>PLACEMENTï¼šè¯´æ˜èŠ‚ç‚¹ä¸å¯å¤ç”¨ï¼Œéœ€å°†èŠ‚ç‚¹æ·»åŠ åˆ° DOM ä¸­</li><li>DELETIONï¼šè¡¨ç¤ºèŠ‚ç‚¹åˆ é™¤ï¼Œåˆ™å°†è¯¥èŠ‚ç‚¹ Fiber æ”¾å…¥æœ¬æ¬¡æ›´æ–° deletions æ•°ç»„ä¸­</li></ul><p>è¿™äº›æµç¨‹éƒ½å®Œæˆä»¥åï¼Œè¡¨ç¤º reconcile å®Œæˆï¼Œè¿™æ˜¯ nextUnitOfWork ä¸ºç©ºï¼Œåˆ™è¿›å…¥ commit é˜¶æ®µï¼Œä» commitRoot æ–¹æ³•è¿›å…¥ï¼Œé€’å½’è°ƒç”¨ commitWork æ–¹æ³•ä»¥æ›´æ–° reconcile å¯¹æ¯”å‡ºæ‰€æœ‰éœ€è¦æ›´æ–°çš„èŠ‚ç‚¹ã€‚</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">commitWork</span><span class="token punctuation">(</span><span class="token parameter">fiber</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token plain">fiber</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">return</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">let</span><span class="token plain"> domParentFiber </span><span class="token operator">=</span><span class="token plain"> fiber</span><span class="token punctuation">.</span><span class="token property-access">parent</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword control-flow">while</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token plain">domParentFiber</span><span class="token punctuation">.</span><span class="token property-access">dom</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    domParentFiber </span><span class="token operator">=</span><span class="token plain"> domParentFiber</span><span class="token punctuation">.</span><span class="token property-access">parent</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> domParent </span><span class="token operator">=</span><span class="token plain"> domParentFiber</span><span class="token punctuation">.</span><span class="token property-access">dom</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">fiber</span><span class="token punctuation">.</span><span class="token property-access">effectTag</span><span class="token plain"> </span><span class="token operator">===</span><span class="token plain"> </span><span class="token string">&#x27;PLACEMENT&#x27;</span><span class="token plain"> </span><span class="token operator">&amp;&amp;</span><span class="token plain"> fiber</span><span class="token punctuation">.</span><span class="token property-access">dom</span><span class="token plain"> </span><span class="token operator">!=</span><span class="token plain"> </span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    domParent</span><span class="token punctuation">.</span><span class="token method function property-access">appendChild</span><span class="token punctuation">(</span><span class="token plain">fiber</span><span class="token punctuation">.</span><span class="token property-access">dom</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword control-flow">else</span><span class="token plain"> </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">fiber</span><span class="token punctuation">.</span><span class="token property-access">effectTag</span><span class="token plain"> </span><span class="token operator">===</span><span class="token plain"> </span><span class="token string">&#x27;UPDATE&#x27;</span><span class="token plain"> </span><span class="token operator">&amp;&amp;</span><span class="token plain"> fiber</span><span class="token punctuation">.</span><span class="token property-access">dom</span><span class="token plain"> </span><span class="token operator">!=</span><span class="token plain"> </span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">updateDom</span><span class="token punctuation">(</span><span class="token plain">fiber</span><span class="token punctuation">.</span><span class="token property-access">dom</span><span class="token punctuation">,</span><span class="token plain"> fiber</span><span class="token punctuation">.</span><span class="token property-access">alternate</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">,</span><span class="token plain"> fiber</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword control-flow">else</span><span class="token plain"> </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">fiber</span><span class="token punctuation">.</span><span class="token property-access">effectTag</span><span class="token plain"> </span><span class="token operator">===</span><span class="token plain"> </span><span class="token string">&#x27;DELETION&#x27;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">commitDeletion</span><span class="token punctuation">(</span><span class="token plain">fiber</span><span class="token punctuation">,</span><span class="token plain"> domParent</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token function">commitWork</span><span class="token punctuation">(</span><span class="token plain">fiber</span><span class="token punctuation">.</span><span class="token property-access">child</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">commitWork</span><span class="token punctuation">(</span><span class="token plain">fiber</span><span class="token punctuation">.</span><span class="token property-access">sibling</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">commitDeletion</span><span class="token punctuation">(</span><span class="token parameter">fiber</span><span class="token parameter punctuation">,</span><span class="token parameter"> domParent</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">fiber</span><span class="token punctuation">.</span><span class="token property-access">dom</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    domParent</span><span class="token punctuation">.</span><span class="token method function property-access">removeChild</span><span class="token punctuation">(</span><span class="token plain">fiber</span><span class="token punctuation">.</span><span class="token property-access">dom</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword control-flow">else</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">commitDeletion</span><span class="token punctuation">(</span><span class="token plain">fiber</span><span class="token punctuation">.</span><span class="token property-access">child</span><span class="token punctuation">,</span><span class="token plain"> domParent</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">updateDom</span><span class="token punctuation">(</span><span class="token parameter">dom</span><span class="token parameter punctuation">,</span><span class="token parameter"> prevProps</span><span class="token parameter punctuation">,</span><span class="token parameter"> nextProps</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// TODO</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p>å¯ä»¥çœ‹åˆ°ï¼ŒcommitWork åŸç†å…¶å®ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯å°† fiber éå†ï¼Œæ ¹æ® reconcile é˜¶æ®µå¯¹æ¯”å‡ºçš„å·®å¼‚ï¼Œæ ¹æ®ä¸åŒ effectTag å€¼æ‰§è¡Œå¯¹åº”æ“ä½œï¼š</p><ul><li>PLACEMENTï¼šappendChild</li><li>UPDATEï¼šæˆ‘ä»¬å®šä¹‰æ›´æ–°è§„åˆ™ï¼Œå…¶ä¸­éœ€è¦æ›´æ–°çš„åŒ…æ‹¬ï¼Œpropsã€äº‹ä»¶ç­‰</li><li>DELETIONï¼šå°† deletions æ•°ç»„ä¸­ Fiber å¯¹åº” dom åˆ é™¤</li></ul><p>updateDom ä¸­å®šä¹‰æ›´æ–°è§„åˆ™ï¼Œè¿™é‡Œéœ€è¦å®šä¹‰ä¸€äº›å˜é‡ç”¨äºæ›´æ–°ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> </span><span class="token function-variable function">isEvent</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token parameter">key</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> key</span><span class="token punctuation">.</span><span class="token method function property-access">startsWith</span><span class="token punctuation">(</span><span class="token string">&#x27;on&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> </span><span class="token function-variable function">isProperty</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token parameter">key</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> key </span><span class="token operator">!==</span><span class="token plain"> </span><span class="token string">&#x27;children&#x27;</span><span class="token plain"> </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token operator">!</span><span class="token function">isEvent</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> </span><span class="token function-variable function">isNew</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">prev</span><span class="token parameter punctuation">,</span><span class="token parameter"> next</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token parameter">key</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> prev</span><span class="token punctuation">[</span><span class="token plain">key</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">!==</span><span class="token plain"> next</span><span class="token punctuation">[</span><span class="token plain">key</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> </span><span class="token function-variable function">isGone</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">prev</span><span class="token parameter punctuation">,</span><span class="token parameter"> next</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token parameter">key</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token plain">key </span><span class="token keyword">in</span><span class="token plain"> next</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">updateDom</span><span class="token punctuation">(</span><span class="token parameter">dom</span><span class="token parameter punctuation">,</span><span class="token parameter"> prevProps</span><span class="token parameter punctuation">,</span><span class="token parameter"> nextProps</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">/**</span></div><div class="token-line"><span class="token comment">   * åˆ é™¤æ—§çš„äº‹ä»¶å¤„ç†</span></div><div class="token-line"><span class="token comment">   * */</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token known-class-name class-name">Object</span><span class="token punctuation">.</span><span class="token method function property-access">keys</span><span class="token punctuation">(</span><span class="token plain">prevProps</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token method function property-access">filter</span><span class="token punctuation">(</span><span class="token plain">isEvent</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token method function property-access">filter</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token plain">key </span><span class="token keyword">in</span><span class="token plain"> nextProps</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">||</span><span class="token plain"> </span><span class="token function">isNew</span><span class="token punctuation">(</span><span class="token plain">prevProps</span><span class="token punctuation">,</span><span class="token plain"> nextProps</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">const</span><span class="token plain"> eventType </span><span class="token operator">=</span><span class="token plain"> name</span><span class="token punctuation">.</span><span class="token method function property-access">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">substring</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      dom</span><span class="token punctuation">.</span><span class="token method function property-access">removeEventListener</span><span class="token punctuation">(</span><span class="token plain">eventType</span><span class="token punctuation">,</span><span class="token plain"> prevProps</span><span class="token punctuation">[</span><span class="token plain">name</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">/**</span></div><div class="token-line"><span class="token comment">   * Delete old props</span></div><div class="token-line"><span class="token comment">   * åˆ é™¤æ—§ props</span></div><div class="token-line"><span class="token comment">   * */</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token known-class-name class-name">Object</span><span class="token punctuation">.</span><span class="token method function property-access">keys</span><span class="token punctuation">(</span><span class="token plain">prevProps</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token method function property-access">filter</span><span class="token punctuation">(</span><span class="token plain">isProperty</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token method function property-access">filter</span><span class="token punctuation">(</span><span class="token function">isGone</span><span class="token punctuation">(</span><span class="token plain">prevProps</span><span class="token punctuation">,</span><span class="token plain"> nextProps</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      dom</span><span class="token punctuation">[</span><span class="token plain">name</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string">&#x27;&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">/**</span></div><div class="token-line"><span class="token comment">   * Set up a new props</span></div><div class="token-line"><span class="token comment">   * è®¾ç½®æ–°çš„ props</span></div><div class="token-line"><span class="token comment">   * */</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token known-class-name class-name">Object</span><span class="token punctuation">.</span><span class="token method function property-access">keys</span><span class="token punctuation">(</span><span class="token plain">nextProps</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token method function property-access">filter</span><span class="token punctuation">(</span><span class="token plain">isProperty</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token method function property-access">filter</span><span class="token punctuation">(</span><span class="token function">isNew</span><span class="token punctuation">(</span><span class="token plain">prevProps</span><span class="token punctuation">,</span><span class="token plain"> nextProps</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      dom</span><span class="token punctuation">[</span><span class="token plain">name</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> nextProps</span><span class="token punctuation">[</span><span class="token plain">name</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">/**</span></div><div class="token-line"><span class="token comment">   * Add a new event handler</span></div><div class="token-line"><span class="token comment">   * æ·»åŠ æ–°çš„äº‹ä»¶å¤„ç†å‡½æ•°</span></div><div class="token-line"><span class="token comment">   * */</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token known-class-name class-name">Object</span><span class="token punctuation">.</span><span class="token method function property-access">keys</span><span class="token punctuation">(</span><span class="token plain">nextProps</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token method function property-access">filter</span><span class="token punctuation">(</span><span class="token plain">isEvent</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token method function property-access">filter</span><span class="token punctuation">(</span><span class="token function">isNew</span><span class="token punctuation">(</span><span class="token plain">prevProps</span><span class="token punctuation">,</span><span class="token plain"> nextProps</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">const</span><span class="token plain"> eventType </span><span class="token operator">=</span><span class="token plain"> name</span><span class="token punctuation">.</span><span class="token method function property-access">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">substring</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      dom</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token plain">eventType</span><span class="token punctuation">,</span><span class="token plain"> nextProps</span><span class="token punctuation">[</span><span class="token plain">name</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬çš„é¡¹ç›®å·²å…·å¤‡äº†åŸºç¡€çš„ React åŠŸèƒ½ï¼Œæ¥ä¸‹æ¥ä¸ºäº†ç®€å•ä¸²è”ç»„ä»¶ä»¥åŠçŠ¶æ€çš„æ›´æ–°å¤„ç†ï¼Œè¿›ä¸€æ­¥å°è£…å‡½æ•°ç»„ä»¶å¤„ç†ä»¥åŠ useState Hookã€‚</p><h2 id="å‡½æ•°ç»„ä»¶"><a aria-hidden="true" tabindex="-1" href="/enhanfe//advanced/buildownreact#å‡½æ•°ç»„ä»¶"><span class="icon icon-link"></span></a>å‡½æ•°ç»„ä»¶</h2><p>å®šä¹‰å‡½æ•°ç»„ä»¶çš„æ›´æ–°å¤„ç†å‡½æ•° updateFunctionComponentï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">let</span><span class="token plain"> hookIndex </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword null nil">null</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">updateFunctionComponent</span><span class="token punctuation">(</span><span class="token parameter">fiber</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  wipFiber </span><span class="token operator">=</span><span class="token plain"> fiber</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  hookIndex </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  wipFiber</span><span class="token punctuation">.</span><span class="token property-access">hooks</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> children </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain">fiber</span><span class="token punctuation">.</span><span class="token method function property-access">type</span><span class="token punctuation">(</span><span class="token plain">fiber</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">reconcileChildren</span><span class="token punctuation">(</span><span class="token plain">fiber</span><span class="token punctuation">,</span><span class="token plain"> children</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p>å‡½æ•°ç»„ä»¶çš„çŠ¶æ€ä½¿ç”¨ hooks è¿›è¡Œå­˜å‚¨ï¼Œæˆ‘ä»¬å°†è¿™äº›çŠ¶æ€æ”¾åœ¨ fiber çš„ hooks æ•°ç»„ä¸Šã€‚hook å­˜å‚¨çŠ¶æ€çš„æ€æƒ³å’Œ redux å¾ˆç›¸è¿‘ï¼Œå½“ setState è°ƒç”¨åï¼Œä¼šå°†æœ¬æ¬¡ä»»åŠ¡æ”¾åˆ° nextUnitOfWork ä¸Šï¼Œé€šè¿‡ workLoopï¼Œåœ¨ç©ºé—²æ—¶æœºæ‰§è¡Œã€‚é¦–å…ˆæˆ‘ä»¬ä¼šé€šè¿‡ Fiber çš„ alternate è·å–åˆ°ä¸Šæ¬¡å†…å®¹ï¼Œå¦‚æœå­˜åœ¨åˆ™è·å–å¯¹åº” Hookã€‚æ¯æ¬¡è°ƒç”¨ Hook ä¼šå°†å¤„ç†å‡½æ•°å­˜æ”¾è‡³å¯¹åº” Fiber ä¸­ hooks å¯¹åº” queue ä¸­ï¼Œæ¯è°ƒç”¨ä¸€æ¬¡ä¼šæ›´æ–° hookIndexã€‚ä»£ç ç‰‡æ®µç¤ºä¾‹å¦‚ä¸‹ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token parameter">initial</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> oldHook </span><span class="token operator">=</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    wipFiber</span><span class="token punctuation">.</span><span class="token property-access">alternate</span><span class="token plain"> </span><span class="token operator">&amp;&amp;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    wipFiber</span><span class="token punctuation">.</span><span class="token property-access">alternate</span><span class="token punctuation">.</span><span class="token property-access">hooks</span><span class="token plain"> </span><span class="token operator">&amp;&amp;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    wipFiber</span><span class="token punctuation">.</span><span class="token property-access">alternate</span><span class="token punctuation">.</span><span class="token property-access">hooks</span><span class="token punctuation">[</span><span class="token plain">hookIndex</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> hook </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    state</span><span class="token operator">:</span><span class="token plain"> oldHook </span><span class="token operator">?</span><span class="token plain"> oldHook</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token plain"> </span><span class="token operator">:</span><span class="token plain"> initial</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    queue</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> actions </span><span class="token operator">=</span><span class="token plain"> oldHook </span><span class="token operator">?</span><span class="token plain"> oldHook</span><span class="token punctuation">.</span><span class="token property-access">queue</span><span class="token plain"> </span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  actions</span><span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token parameter">action</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    hook</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">action</span><span class="token punctuation">(</span><span class="token plain">hook</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> </span><span class="token function-variable function">setState</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token parameter">action</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    hook</span><span class="token punctuation">.</span><span class="token property-access">queue</span><span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="token plain">action</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    wipRoot </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      dom</span><span class="token operator">:</span><span class="token plain"> currentRoot</span><span class="token punctuation">.</span><span class="token property-access">dom</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      props</span><span class="token operator">:</span><span class="token plain"> currentRoot</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      alternate</span><span class="token operator">:</span><span class="token plain"> currentRoot</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    nextUnitOfWork </span><span class="token operator">=</span><span class="token plain"> wipRoot</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    deletions </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  wipFiber</span><span class="token punctuation">.</span><span class="token property-access">hooks</span><span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="token plain">hook</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  hookIndex</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain">hook</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token punctuation">,</span><span class="token plain"> setState</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><h2 id="ä½¿ç”¨"><a aria-hidden="true" tabindex="-1" href="/enhanfe//advanced/buildownreact#ä½¿ç”¨"><span class="icon icon-link"></span></a>ä½¿ç”¨</h2><p>åˆ°è¿™é‡Œï¼ŒReact è¶…çº§ä½“éªŒç‰ˆå°±èƒ½è·‘èµ·æ¥äº†ï¼Œå…ˆè´´å‡ºå®Œæ•´ä»£ç ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token parameter">type</span><span class="token parameter punctuation">,</span><span class="token parameter"> props</span><span class="token parameter punctuation">,</span><span class="token parameter"> </span><span class="token parameter operator">...</span><span class="token parameter">children</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    type</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    props</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token spread operator">...</span><span class="token plain">props</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      children</span><span class="token operator">:</span><span class="token plain"> children</span><span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">child</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword">typeof</span><span class="token plain"> child </span><span class="token operator">===</span><span class="token plain"> </span><span class="token string">&#x27;object&#x27;</span><span class="token plain"> </span><span class="token operator">?</span><span class="token plain"> child </span><span class="token operator">:</span><span class="token plain"> </span><span class="token function">createTextElement</span><span class="token punctuation">(</span><span class="token plain">child</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">createTextElement</span><span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    type</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;TEXT_ELEMENT&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    props</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      nodeValue</span><span class="token operator">:</span><span class="token plain"> text</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      children</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">createDom</span><span class="token punctuation">(</span><span class="token parameter">fiber</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> dom </span><span class="token operator">=</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    fiber</span><span class="token punctuation">.</span><span class="token property-access">type</span><span class="token plain"> </span><span class="token operator">==</span><span class="token plain"> </span><span class="token string">&#x27;TEXT_ELEMENT&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token operator">?</span><span class="token plain"> </span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">createTextNode</span><span class="token punctuation">(</span><span class="token string">&#x27;&#x27;</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token operator">:</span><span class="token plain"> </span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">createElement</span><span class="token punctuation">(</span><span class="token plain">fiber</span><span class="token punctuation">.</span><span class="token property-access">type</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token function">updateDom</span><span class="token punctuation">(</span><span class="token plain">dom</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"> fiber</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword control-flow">return</span><span class="token plain"> dom</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> </span><span class="token function-variable function">isEvent</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token parameter">key</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> key</span><span class="token punctuation">.</span><span class="token method function property-access">startsWith</span><span class="token punctuation">(</span><span class="token string">&#x27;on&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> </span><span class="token function-variable function">isProperty</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token parameter">key</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> key </span><span class="token operator">!==</span><span class="token plain"> </span><span class="token string">&#x27;children&#x27;</span><span class="token plain"> </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token operator">!</span><span class="token function">isEvent</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> </span><span class="token function-variable function">isNew</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">prev</span><span class="token parameter punctuation">,</span><span class="token parameter"> next</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token parameter">key</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> prev</span><span class="token punctuation">[</span><span class="token plain">key</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">!==</span><span class="token plain"> next</span><span class="token punctuation">[</span><span class="token plain">key</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> </span><span class="token function-variable function">isGone</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">prev</span><span class="token parameter punctuation">,</span><span class="token parameter"> next</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token parameter">key</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token plain">key </span><span class="token keyword">in</span><span class="token plain"> next</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">updateDom</span><span class="token punctuation">(</span><span class="token parameter">dom</span><span class="token parameter punctuation">,</span><span class="token parameter"> prevProps</span><span class="token parameter punctuation">,</span><span class="token parameter"> nextProps</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">//Remove old or changed event listeners</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token known-class-name class-name">Object</span><span class="token punctuation">.</span><span class="token method function property-access">keys</span><span class="token punctuation">(</span><span class="token plain">prevProps</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token method function property-access">filter</span><span class="token punctuation">(</span><span class="token plain">isEvent</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token method function property-access">filter</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token plain">key </span><span class="token keyword">in</span><span class="token plain"> nextProps</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">||</span><span class="token plain"> </span><span class="token function">isNew</span><span class="token punctuation">(</span><span class="token plain">prevProps</span><span class="token punctuation">,</span><span class="token plain"> nextProps</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">const</span><span class="token plain"> eventType </span><span class="token operator">=</span><span class="token plain"> name</span><span class="token punctuation">.</span><span class="token method function property-access">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">substring</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      dom</span><span class="token punctuation">.</span><span class="token method function property-access">removeEventListener</span><span class="token punctuation">(</span><span class="token plain">eventType</span><span class="token punctuation">,</span><span class="token plain"> prevProps</span><span class="token punctuation">[</span><span class="token plain">name</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// Remove old properties</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token known-class-name class-name">Object</span><span class="token punctuation">.</span><span class="token method function property-access">keys</span><span class="token punctuation">(</span><span class="token plain">prevProps</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token method function property-access">filter</span><span class="token punctuation">(</span><span class="token plain">isProperty</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token method function property-access">filter</span><span class="token punctuation">(</span><span class="token function">isGone</span><span class="token punctuation">(</span><span class="token plain">prevProps</span><span class="token punctuation">,</span><span class="token plain"> nextProps</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      dom</span><span class="token punctuation">[</span><span class="token plain">name</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string">&#x27;&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// Set new or changed properties</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token known-class-name class-name">Object</span><span class="token punctuation">.</span><span class="token method function property-access">keys</span><span class="token punctuation">(</span><span class="token plain">nextProps</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token method function property-access">filter</span><span class="token punctuation">(</span><span class="token plain">isProperty</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token method function property-access">filter</span><span class="token punctuation">(</span><span class="token function">isNew</span><span class="token punctuation">(</span><span class="token plain">prevProps</span><span class="token punctuation">,</span><span class="token plain"> nextProps</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      dom</span><span class="token punctuation">[</span><span class="token plain">name</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> nextProps</span><span class="token punctuation">[</span><span class="token plain">name</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// Add event listeners</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token known-class-name class-name">Object</span><span class="token punctuation">.</span><span class="token method function property-access">keys</span><span class="token punctuation">(</span><span class="token plain">nextProps</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token method function property-access">filter</span><span class="token punctuation">(</span><span class="token plain">isEvent</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token method function property-access">filter</span><span class="token punctuation">(</span><span class="token function">isNew</span><span class="token punctuation">(</span><span class="token plain">prevProps</span><span class="token punctuation">,</span><span class="token plain"> nextProps</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">const</span><span class="token plain"> eventType </span><span class="token operator">=</span><span class="token plain"> name</span><span class="token punctuation">.</span><span class="token method function property-access">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">substring</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      dom</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token plain">eventType</span><span class="token punctuation">,</span><span class="token plain"> nextProps</span><span class="token punctuation">[</span><span class="token plain">name</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">commitRoot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  deletions</span><span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token plain">commitWork</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">commitWork</span><span class="token punctuation">(</span><span class="token plain">wipRoot</span><span class="token punctuation">.</span><span class="token property-access">child</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  currentRoot </span><span class="token operator">=</span><span class="token plain"> wipRoot</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  wipRoot </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword null nil">null</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">commitWork</span><span class="token punctuation">(</span><span class="token parameter">fiber</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token plain">fiber</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">return</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">let</span><span class="token plain"> domParentFiber </span><span class="token operator">=</span><span class="token plain"> fiber</span><span class="token punctuation">.</span><span class="token property-access">parent</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword control-flow">while</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token plain">domParentFiber</span><span class="token punctuation">.</span><span class="token property-access">dom</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    domParentFiber </span><span class="token operator">=</span><span class="token plain"> domParentFiber</span><span class="token punctuation">.</span><span class="token property-access">parent</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> domParent </span><span class="token operator">=</span><span class="token plain"> domParentFiber</span><span class="token punctuation">.</span><span class="token property-access">dom</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">fiber</span><span class="token punctuation">.</span><span class="token property-access">effectTag</span><span class="token plain"> </span><span class="token operator">===</span><span class="token plain"> </span><span class="token string">&#x27;PLACEMENT&#x27;</span><span class="token plain"> </span><span class="token operator">&amp;&amp;</span><span class="token plain"> fiber</span><span class="token punctuation">.</span><span class="token property-access">dom</span><span class="token plain"> </span><span class="token operator">!=</span><span class="token plain"> </span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    domParent</span><span class="token punctuation">.</span><span class="token method function property-access">appendChild</span><span class="token punctuation">(</span><span class="token plain">fiber</span><span class="token punctuation">.</span><span class="token property-access">dom</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword control-flow">else</span><span class="token plain"> </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">fiber</span><span class="token punctuation">.</span><span class="token property-access">effectTag</span><span class="token plain"> </span><span class="token operator">===</span><span class="token plain"> </span><span class="token string">&#x27;UPDATE&#x27;</span><span class="token plain"> </span><span class="token operator">&amp;&amp;</span><span class="token plain"> fiber</span><span class="token punctuation">.</span><span class="token property-access">dom</span><span class="token plain"> </span><span class="token operator">!=</span><span class="token plain"> </span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">updateDom</span><span class="token punctuation">(</span><span class="token plain">fiber</span><span class="token punctuation">.</span><span class="token property-access">dom</span><span class="token punctuation">,</span><span class="token plain"> fiber</span><span class="token punctuation">.</span><span class="token property-access">alternate</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">,</span><span class="token plain"> fiber</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword control-flow">else</span><span class="token plain"> </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">fiber</span><span class="token punctuation">.</span><span class="token property-access">effectTag</span><span class="token plain"> </span><span class="token operator">===</span><span class="token plain"> </span><span class="token string">&#x27;DELETION&#x27;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">commitDeletion</span><span class="token punctuation">(</span><span class="token plain">fiber</span><span class="token punctuation">,</span><span class="token plain"> domParent</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token function">commitWork</span><span class="token punctuation">(</span><span class="token plain">fiber</span><span class="token punctuation">.</span><span class="token property-access">child</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">commitWork</span><span class="token punctuation">(</span><span class="token plain">fiber</span><span class="token punctuation">.</span><span class="token property-access">sibling</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">commitDeletion</span><span class="token punctuation">(</span><span class="token parameter">fiber</span><span class="token parameter punctuation">,</span><span class="token parameter"> domParent</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">fiber</span><span class="token punctuation">.</span><span class="token property-access">dom</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    domParent</span><span class="token punctuation">.</span><span class="token method function property-access">removeChild</span><span class="token punctuation">(</span><span class="token plain">fiber</span><span class="token punctuation">.</span><span class="token property-access">dom</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword control-flow">else</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">commitDeletion</span><span class="token punctuation">(</span><span class="token plain">fiber</span><span class="token punctuation">.</span><span class="token property-access">child</span><span class="token punctuation">,</span><span class="token plain"> domParent</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">element</span><span class="token parameter punctuation">,</span><span class="token parameter"> container</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  wipRoot </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    dom</span><span class="token operator">:</span><span class="token plain"> container</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    props</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      children</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain">element</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    alternate</span><span class="token operator">:</span><span class="token plain"> currentRoot</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  deletions </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  nextUnitOfWork </span><span class="token operator">=</span><span class="token plain"> wipRoot</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">let</span><span class="token plain"> nextUnitOfWork </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword null nil">null</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">let</span><span class="token plain"> currentRoot </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword null nil">null</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">let</span><span class="token plain"> wipRoot </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword null nil">null</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">let</span><span class="token plain"> deletions </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword null nil">null</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">workLoop</span><span class="token punctuation">(</span><span class="token parameter">deadline</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">let</span><span class="token plain"> shouldYield </span><span class="token operator">=</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword control-flow">while</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">nextUnitOfWork </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token operator">!</span><span class="token plain">shouldYield</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    nextUnitOfWork </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">performUnitOfWork</span><span class="token punctuation">(</span><span class="token plain">nextUnitOfWork</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    shouldYield </span><span class="token operator">=</span><span class="token plain"> deadline</span><span class="token punctuation">.</span><span class="token method function property-access">timeRemaining</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token plain">nextUnitOfWork </span><span class="token operator">&amp;&amp;</span><span class="token plain"> wipRoot</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">commitRoot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token function">requestIdleCallback</span><span class="token punctuation">(</span><span class="token plain">workLoop</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token function">requestIdleCallback</span><span class="token punctuation">(</span><span class="token plain">workLoop</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">performUnitOfWork</span><span class="token punctuation">(</span><span class="token parameter">fiber</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> isFunctionComponent </span><span class="token operator">=</span><span class="token plain"> fiber</span><span class="token punctuation">.</span><span class="token property-access">type</span><span class="token plain"> </span><span class="token keyword">instanceof</span><span class="token plain"> </span><span class="token class-name">Function</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">isFunctionComponent</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">updateFunctionComponent</span><span class="token punctuation">(</span><span class="token plain">fiber</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword control-flow">else</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">updateHostComponent</span><span class="token punctuation">(</span><span class="token plain">fiber</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">fiber</span><span class="token punctuation">.</span><span class="token property-access">child</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">return</span><span class="token plain"> fiber</span><span class="token punctuation">.</span><span class="token property-access">child</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">let</span><span class="token plain"> nextFiber </span><span class="token operator">=</span><span class="token plain"> fiber</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword control-flow">while</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">nextFiber</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">nextFiber</span><span class="token punctuation">.</span><span class="token property-access">sibling</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword control-flow">return</span><span class="token plain"> nextFiber</span><span class="token punctuation">.</span><span class="token property-access">sibling</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    nextFiber </span><span class="token operator">=</span><span class="token plain"> nextFiber</span><span class="token punctuation">.</span><span class="token property-access">parent</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">let</span><span class="token plain"> wipFiber </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword null nil">null</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">let</span><span class="token plain"> hookIndex </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword null nil">null</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">updateFunctionComponent</span><span class="token punctuation">(</span><span class="token parameter">fiber</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  wipFiber </span><span class="token operator">=</span><span class="token plain"> fiber</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  hookIndex </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  wipFiber</span><span class="token punctuation">.</span><span class="token property-access">hooks</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> children </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain">fiber</span><span class="token punctuation">.</span><span class="token method function property-access">type</span><span class="token punctuation">(</span><span class="token plain">fiber</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">reconcileChildren</span><span class="token punctuation">(</span><span class="token plain">fiber</span><span class="token punctuation">,</span><span class="token plain"> children</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token parameter">initial</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> oldHook </span><span class="token operator">=</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    wipFiber</span><span class="token punctuation">.</span><span class="token property-access">alternate</span><span class="token plain"> </span><span class="token operator">&amp;&amp;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    wipFiber</span><span class="token punctuation">.</span><span class="token property-access">alternate</span><span class="token punctuation">.</span><span class="token property-access">hooks</span><span class="token plain"> </span><span class="token operator">&amp;&amp;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    wipFiber</span><span class="token punctuation">.</span><span class="token property-access">alternate</span><span class="token punctuation">.</span><span class="token property-access">hooks</span><span class="token punctuation">[</span><span class="token plain">hookIndex</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> hook </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    state</span><span class="token operator">:</span><span class="token plain"> oldHook </span><span class="token operator">?</span><span class="token plain"> oldHook</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token plain"> </span><span class="token operator">:</span><span class="token plain"> initial</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    queue</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> actions </span><span class="token operator">=</span><span class="token plain"> oldHook </span><span class="token operator">?</span><span class="token plain"> oldHook</span><span class="token punctuation">.</span><span class="token property-access">queue</span><span class="token plain"> </span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  actions</span><span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token parameter">action</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    hook</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">action</span><span class="token punctuation">(</span><span class="token plain">hook</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> </span><span class="token function-variable function">setState</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token parameter">action</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    hook</span><span class="token punctuation">.</span><span class="token property-access">queue</span><span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="token plain">action</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    wipRoot </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      dom</span><span class="token operator">:</span><span class="token plain"> currentRoot</span><span class="token punctuation">.</span><span class="token property-access">dom</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      props</span><span class="token operator">:</span><span class="token plain"> currentRoot</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      alternate</span><span class="token operator">:</span><span class="token plain"> currentRoot</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    nextUnitOfWork </span><span class="token operator">=</span><span class="token plain"> wipRoot</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    deletions </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  wipFiber</span><span class="token punctuation">.</span><span class="token property-access">hooks</span><span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="token plain">hook</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  hookIndex</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain">hook</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token punctuation">,</span><span class="token plain"> setState</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">updateHostComponent</span><span class="token punctuation">(</span><span class="token parameter">fiber</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token plain">fiber</span><span class="token punctuation">.</span><span class="token property-access">dom</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    fiber</span><span class="token punctuation">.</span><span class="token property-access">dom</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">createDom</span><span class="token punctuation">(</span><span class="token plain">fiber</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">reconcileChildren</span><span class="token punctuation">(</span><span class="token plain">fiber</span><span class="token punctuation">,</span><span class="token plain"> fiber</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">.</span><span class="token property-access">children</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">reconcileChildren</span><span class="token punctuation">(</span><span class="token parameter">wipFiber</span><span class="token parameter punctuation">,</span><span class="token parameter"> elements</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">let</span><span class="token plain"> index </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">let</span><span class="token plain"> oldFiber </span><span class="token operator">=</span><span class="token plain"> wipFiber</span><span class="token punctuation">.</span><span class="token property-access">alternate</span><span class="token plain"> </span><span class="token operator">&amp;&amp;</span><span class="token plain"> wipFiber</span><span class="token punctuation">.</span><span class="token property-access">alternate</span><span class="token punctuation">.</span><span class="token property-access">child</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">let</span><span class="token plain"> prevSibling </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword null nil">null</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword control-flow">while</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">index </span><span class="token operator">&lt;</span><span class="token plain"> elements</span><span class="token punctuation">.</span><span class="token property-access">length</span><span class="token plain"> </span><span class="token operator">||</span><span class="token plain"> oldFiber </span><span class="token operator">!=</span><span class="token plain"> </span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> element </span><span class="token operator">=</span><span class="token plain"> elements</span><span class="token punctuation">[</span><span class="token plain">index</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">let</span><span class="token plain"> newFiber </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword null nil">null</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> sameType </span><span class="token operator">=</span><span class="token plain"> oldFiber </span><span class="token operator">&amp;&amp;</span><span class="token plain"> element </span><span class="token operator">&amp;&amp;</span><span class="token plain"> element</span><span class="token punctuation">.</span><span class="token property-access">type</span><span class="token plain"> </span><span class="token operator">==</span><span class="token plain"> oldFiber</span><span class="token punctuation">.</span><span class="token property-access">type</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">sameType</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      newFiber </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        type</span><span class="token operator">:</span><span class="token plain"> oldFiber</span><span class="token punctuation">.</span><span class="token property-access">type</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        props</span><span class="token operator">:</span><span class="token plain"> element</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        dom</span><span class="token operator">:</span><span class="token plain"> oldFiber</span><span class="token punctuation">.</span><span class="token property-access">dom</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        parent</span><span class="token operator">:</span><span class="token plain"> wipFiber</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        alternate</span><span class="token operator">:</span><span class="token plain"> oldFiber</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        effectTag</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;UPDATE&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">element </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token operator">!</span><span class="token plain">sameType</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      newFiber </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        type</span><span class="token operator">:</span><span class="token plain"> element</span><span class="token punctuation">.</span><span class="token property-access">type</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        props</span><span class="token operator">:</span><span class="token plain"> element</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        dom</span><span class="token operator">:</span><span class="token plain"> </span><span class="token keyword null nil">null</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        parent</span><span class="token operator">:</span><span class="token plain"> wipFiber</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        alternate</span><span class="token operator">:</span><span class="token plain"> </span><span class="token keyword null nil">null</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        effectTag</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;PLACEMENT&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">oldFiber </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token operator">!</span><span class="token plain">sameType</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      oldFiber</span><span class="token punctuation">.</span><span class="token property-access">effectTag</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string">&#x27;DELETION&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      deletions</span><span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="token plain">oldFiber</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">oldFiber</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      oldFiber </span><span class="token operator">=</span><span class="token plain"> oldFiber</span><span class="token punctuation">.</span><span class="token property-access">sibling</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">index </span><span class="token operator">===</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      wipFiber</span><span class="token punctuation">.</span><span class="token property-access">child</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> newFiber</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword control-flow">else</span><span class="token plain"> </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">element</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      prevSibling</span><span class="token punctuation">.</span><span class="token property-access">sibling</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> newFiber</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    prevSibling </span><span class="token operator">=</span><span class="token plain"> newFiber</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    index</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> </span><span class="token maybe-class-name">Didact</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  createElement</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  render</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  useState</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span></div></pre></div><p>ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment">/** @jsx Didact.createElement */</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function maybe-class-name">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain">state</span><span class="token punctuation">,</span><span class="token plain"> setState</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token maybe-class-name">Didact</span><span class="token punctuation">.</span><span class="token method function property-access">useState</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token operator">&lt;</span><span class="token plain">h1 onClick</span><span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token parameter">c</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> c </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain"> style</span><span class="token operator">=</span><span class="token string">&quot;user-select: none&quot;</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token maybe-class-name">Count</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain">state</span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token plain">h1</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> element </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token maybe-class-name">Counter</span><span class="token plain"> </span><span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> container </span><span class="token operator">=</span><span class="token plain"> </span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">&#x27;root&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token maybe-class-name">Didact</span><span class="token punctuation">.</span><span class="token method function property-access">render</span><span class="token punctuation">(</span><span class="token plain">element</span><span class="token punctuation">,</span><span class="token plain"> container</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>è¿™æ ·åœ¨æ¯æ¬¡ç‚¹å‡»ï¼Œé¡µé¢éƒ½ä¼šæ›´æ–°æ¸²æŸ“ã€‚</p><p>æœ¬æ–‡ä»£ç åŠä¸»è¦æ€è·¯æ¥è‡ªäºï¼š<a target="_blank" rel="noopener noreferrer" href="https://pomb.us/build-your-own-react/">build your own react<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div><div class="__dumi-default-layout-footer-meta"><span data-updated-text="æœ€åæ›´æ–°æ—¶é—´ï¼š">8/4/2021 08:35:11</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script src="/enhanfe/umi.js"></script>
  </body>
</html>
